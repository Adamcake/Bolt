var $n=Object.defineProperty;var Sn=(n,e,t)=>e in n?$n(n,e,{enumerable:!0,configurable:!0,writable:!0,value:t}):n[e]=t;var We=(n,e,t)=>(Sn(n,typeof e!="symbol"?e+"":e,t),t);(function(){const e=document.createElement("link").relList;if(e&&e.supports&&e.supports("modulepreload"))return;for(const o of document.querySelectorAll('link[rel="modulepreload"]'))l(o);new MutationObserver(o=>{for(const r of o)if(r.type==="childList")for(const i of r.addedNodes)i.tagName==="LINK"&&i.rel==="modulepreload"&&l(i)}).observe(document,{childList:!0,subtree:!0});function t(o){const r={};return o.integrity&&(r.integrity=o.integrity),o.referrerPolicy&&(r.referrerPolicy=o.referrerPolicy),o.crossOrigin==="use-credentials"?r.credentials="include":o.crossOrigin==="anonymous"?r.credentials="omit":r.credentials="same-origin",r}function l(o){if(o.ep)return;o.ep=!0;const r=t(o);fetch(o.href,r)}})();var kt=(n=>(n[n.SECOND=1e3]="SECOND",n[n.MINUTE=6e4]="MINUTE",n[n.HALF_HOUR=18e5]="HALF_HOUR",n[n.HOUR=36e5]="HOUR",n[n.DAY=864e5]="DAY",n[n.WEEK=6048e5]="WEEK",n[n.MONTH=2592e6]="MONTH",n))(kt||{});class Be{static set(e,t,l,o){const r=new Date;r.setTime(r.getTime()+l*o);const i=`expires=${r.toUTCString()}`;document.cookie=`${e}=${t};${i};path=/`}static get(e){const t=`${e}=`,l=document.cookie.split(";");for(let o=0;o<l.length;o++){let r=l[o];for(;r.charAt(0)===" ";)r=r.substring(1,r.length);if(r.indexOf(t)===0)return r.substring(t.length,r.length)}return null}static remove(e){document.cookie=`${e}=; Max-Age=-99999999;`}}function ye(n){return{ok:!0,value:n}}function K(n){return{ok:!1,error:n}}var le=(n=>(n.rs3="rs3",n.osrs="osrs",n))(le||{}),Te=(n=>(n.official="Official",n.runelite="RuneLite",n.hdos="HDOS",n))(Te||{});const Ct={rs3:["Official"],osrs:["Official","RuneLite","HDOS"]};class et{static parseTokenResponse(e){try{const t=JSON.parse(e),l=t.id_token.split(".");if(l.length!==3){const i=`Malformed id_token: ${l.length} sections, expected 3`;return K(i)}const o=JSON.parse(atob(l[0]));if(o.typ!=="JWT"){const i=`Bad id_token header: typ ${o.typ}, expected JWT`;return K(i)}const r=JSON.parse(atob(l[1]));return ye({access_token:t.access_token,id_token:t.id_token,refresh_token:t.refresh_token,sub:r.sub,expiry:Date.now()+t.expires_in*1e3})}catch{return K("Unable to parse token response")}}static parseSessionResponse(e){try{const t=JSON.parse(e);return t.sessionId?ye(t.sessionId):K("sessionId does not exist on parsed object")}catch{return K("Unable to parse session response")}}static decodeBolt(e){const t={};for(const l in e){const o=l,r=e[o];typeof r=="string"?t[o]=atob(r):Array.isArray(r)&&r.every(i=>typeof i=="string")?t[o]=r.map(i=>atob(i)):t[o]=r}return t}}var ze=(n=>(n.Windows="windows",n.Linux="linux",n.MacOS="mac",n))(ze||{});const P={env:et.decodeBolt(s()),platform:null,rs3DebInstalledHash:null,rs3ExeInstalledHash:null,rs3AppInstalledHash:null,osrsExeInstalledHash:null,osrsAppInstalledHash:null,runeLiteInstalledId:null,hdosInstalledVersion:null,isFlathub:!1,hasLibArchive:!1,hasBoltPlugins:!1,pluginConfig:{}};class pt{static async makeLoginUrl(e){const t=new TextEncoder().encode(e.pkceCodeVerifier),l=await crypto.subtle.digest("SHA-256",t);let o="";const r=new Uint8Array(l);for(let a=0;a<r.byteLength;a++)o+=String.fromCharCode(r[a]);const i=btoa(o).replace(/\+/g,"-").replace(/\//g,"_").replace(/=+$/,"");return e.origin.concat("/oauth2/auth?").concat(new URLSearchParams({auth_method:e.authMethod,login_type:e.loginType,flow:e.flow,response_type:"code",client_id:e.clientid,redirect_uri:e.redirect,code_challenge:i,code_challenge_method:"S256",prompt:"login",scope:"openid offline gamesso.token.create user.profile.read",state:e.pkceState}).toString())}static makeRandomVerifier(){const e="ABCDEFGHIJKLMNOPQRSTUVWXYZabcdefghijklmnopqrstuvwxyz0123456789-._~",t=new Uint32Array(43);return crypto.getRandomValues(t),Array.from(t,function(l){return e[l%e.length]}).join("")}static makeRandomState(){const t="ABCDEFGHIJKLMNOPQRSTUVWXYZabcdefghijklmnopqrstuvwxyz",l=t.length-1,o=crypto.getRandomValues(new Uint8Array(12));return Array.from(o).map(r=>Math.round(r*(l-0)/255+0)).map(r=>t[r]).join("")}}const qe=class qe{static async openLoginWindow(e,t,l){if(qe.pendingLoginWindow!==null)return qe.pendingLoginWindow.window.focus();const o=pt.makeRandomState(),r=pt.makeRandomVerifier(),i=new TextEncoder().encode(r),a=await crypto.subtle.digest("SHA-256",i);let c="";const u=new Uint8Array(a);for(let _=0;_<u.byteLength;_++)c+=String.fromCharCode(u[_]);const f=btoa(c).replace(/\+/g,"-").replace(/\//g,"_").replace(/=+$/,""),d=new URLSearchParams({auth_method:"",login_type:"",flow:"launcher",response_type:"code",client_id:l,redirect_uri:t,code_challenge:f,code_challenge_method:"S256",prompt:"login",scope:"openid offline gamesso.token.create user.profile.read",state:o}),g=`${e}/oauth2/auth?${d.toString()}`;Be.set("auth_verifier",r,10,kt.MINUTE),qe.pendingLoginWindow=window.open(g,"","width=480,height=720")}static navigateToAuthConsent(e,t,l){const o=pt.makeRandomState(),r=new URLSearchParams({id_token_hint:t,nonce:l,prompt:"consent",redirect_uri:"http://localhost",response_type:"id_token code",state:o,client_id:"1fddee4e-b100-4f4e-b2b0-097f9088f9d2",scope:"openid offline"}),i=`${e}/oauth2/auth?${r.toString()}`;Be.set("auth_nonce",l,10,kt.MINUTE),window.location.href=i}static async refreshOAuthToken(e){return new Promise(t=>{if(e.expiry-Date.now()<3e4){const l=new URLSearchParams({grant_type:"refresh_token",client_id:P.env.clientid,refresh_token:e.refresh_token}),o=new XMLHttpRequest;o.onreadystatechange=()=>{if(o.readyState==4)if(o.status==200){const i=et.parseTokenResponse(o.response);i.ok?t(ye(i.value)):t(K(0))}else t(K(o.status))},o.onerror=()=>{t(K(0))};const r=P.env.origin.concat("/oauth2/token");o.open("POST",r,!0),o.setRequestHeader("Content-Type","application/x-www-form-urlencoded"),o.setRequestHeader("Accept","application/json"),o.send(l)}else t(ye(e))})}static async getOAuthToken(e,t,l,o,r){const i=`${e}/oauth2/token`;return new Promise(a=>{const c=new XMLHttpRequest;c.onreadystatechange=()=>{if(c.readyState==4)if(c.status==200){const f=et.parseTokenResponse(c.response);return f.ok?a(ye(f.value)):a(K(f.error))}else return a(K(`Error: from ${i}: ${c.status}: ${c.response}`))},c.open("POST",i,!0),c.setRequestHeader("Content-Type","application/x-www-form-urlencoded"),c.setRequestHeader("Accept","application/json");const u=new URLSearchParams({grant_type:"authorization_code",client_id:t,code:r,code_verifier:l,redirect_uri:o});c.send(u)})}static revokeOauthCreds(e){const t=`${P.env.origin}/oauth2/revoke`;return new Promise(l=>{const o=new XMLHttpRequest;o.open("POST",t,!0),o.onreadystatechange=()=>{o.readyState==4&&l(o.status)},o.setRequestHeader("Content-Type","application/x-www-form-urlencoded");const r=new URLSearchParams({token:e,client_id:P.env.clientid});o.send(r)})}static async getSessionId(e,t){const l=`${e}/sessions`;return new Promise(o=>{const r=new XMLHttpRequest;r.onreadystatechange=()=>{if(r.readyState==4)if(r.status==200){const a=et.parseSessionResponse(r.response);return a.ok?o(ye(a.value)):o(K(a.error))}else K(`Error: from ${l}: ${r.status}: ${r.response}`)},r.open("POST",l,!0),r.setRequestHeader("Content-Type","application/json"),r.setRequestHeader("Accept","application/json");const i={idToken:t};r.send(JSON.stringify(i))})}static validateIdToken(e,t){const l=e.split(".");if(l.length!==3)return K(`Malformed id_token: ${l.length} sections, expected 3`);const o=JSON.parse(atob(l[0]));return o.typ!=="JWT"?K(`Bad id_token header: typ ${o.typ}, expected JWT`):JSON.parse(atob(l[1])).nonce!==t?K("Incorrect nonce in id_token"):ye(void 0)}};We(qe,"pendingLoginWindow",null);let we=qe;class nt{static async buildSession(e,t){const l=await nt.getUser(e.sub,e.access_token);if(!l.ok)return K(`Failed to fetch user. Status: ${l.error}`);const o=await nt.getUserAccounts(t);return o.ok?ye({user:l.value,accounts:o.value,tokens:e,session_id:t}):K(`Failed to fetch game accounts. Status: ${o.error}`)}static getUser(e,t){return new Promise(l=>{const o=`${P.env.api}/users/${e}/displayName`,r=new XMLHttpRequest;r.onreadystatechange=()=>{if(r.readyState==4)if(r.status==200){const i=JSON.parse(r.response);l(ye(i))}else l(K(r.status))},r.open("GET",o,!0),r.setRequestHeader("Authorization","Bearer ".concat(t)),r.send()})}static getUserAccounts(e){const t=`${P.env.auth_api}/accounts`;return new Promise(l=>{const o=new XMLHttpRequest;o.onreadystatechange=async()=>{if(o.readyState==4)if(o.status==200){const r=JSON.parse(o.response);l(ye(r))}else l(K(o.status))},o.open("GET",t,!0),o.setRequestHeader("Accept","application/json"),o.setRequestHeader("Authorization","Bearer ".concat(e)),o.send()})}}function A(){}function Cn(n,e){for(const t in e)n[t]=e[t];return n}function Ln(n){return!!n&&(typeof n=="object"||typeof n=="function")&&typeof n.then=="function"}function on(n){return n()}function Lt(){return Object.create(null)}function Q(n){n.forEach(on)}function lt(n){return typeof n=="function"}function fe(n,e){return n!=n?e==e:n!==e||n&&typeof n=="object"||typeof n=="function"}let Qe;function wt(n,e){return n===e?!0:(Qe||(Qe=document.createElement("a")),Qe.href=e,n===Qe.href)}function Rn(n){return Object.keys(n).length===0}function rn(n,...e){if(n==null){for(const l of e)l(void 0);return A}const t=n.subscribe(...e);return t.unsubscribe?()=>t.unsubscribe():t}function ke(n){let e;return rn(n,t=>e=t)(),e}function he(n,e,t){n.$$.on_destroy.push(rn(e,t))}function ot(n,e,t,l){if(n){const o=an(n,e,t,l);return n[0](o)}}function an(n,e,t,l){return n[1]&&l?Cn(t.ctx.slice(),n[1](l(e))):t.ctx}function rt(n,e,t,l){if(n[2]&&l){const o=n[2](l(t));if(e.dirty===void 0)return o;if(typeof o=="object"){const r=[],i=Math.max(e.dirty.length,o.length);for(let a=0;a<i;a+=1)r[a]=e.dirty[a]|o[a];return r}return e.dirty|o}return e.dirty}function it(n,e,t,l,o,r){if(o){const i=an(e,t,l,r);n.p(i,o)}}function at(n){if(n.ctx.length>32){const e=[],t=n.ctx.length/32;for(let l=0;l<t;l++)e[l]=-1;return e}return-1}function $e(n,e,t){return n.set(t),e}function Pn(n){return n&&lt(n.destroy)?n.destroy:A}function v(n,e){n.appendChild(e)}function w(n,e,t){n.insertBefore(e,t||null)}function k(n){n.parentNode&&n.parentNode.removeChild(n)}function Ee(n,e){for(let t=0;t<n.length;t+=1)n[t]&&n[t].d(e)}function m(n){return document.createElement(n)}function G(n){return document.createTextNode(n)}function R(){return G(" ")}function Se(){return G("")}function M(n,e,t,l){return n.addEventListener(e,t,l),()=>n.removeEventListener(e,t,l)}function Tn(n){return function(e){e.target===this&&n.call(this,e)}}function h(n,e,t){t==null?n.removeAttribute(e):n.getAttribute(e)!==t&&n.setAttribute(e,t)}function Un(n){return Array.from(n.childNodes)}function ce(n,e){e=""+e,n.data!==e&&(n.data=e)}function ue(n,e){n.value=e??""}function Ie(n,e,t){for(let l=0;l<n.options.length;l+=1){const o=n.options[l];if(o.__value===e){o.selected=!0;return}}(!t||e!==void 0)&&(n.selectedIndex=-1)}function $t(n){const e=n.querySelector(":checked");return e&&e.__value}function oe(n,e,t){n.classList.toggle(e,!!t)}function In(n,e,{bubbles:t=!1,cancelable:l=!1}={}){return new CustomEvent(n,{detail:e,bubbles:t,cancelable:l})}let Ve;function Le(n){Ve=n}function ct(){if(!Ve)throw new Error("Function called outside component initialization");return Ve}function cn(n){ct().$$.on_mount.push(n)}function Hn(n){ct().$$.on_destroy.push(n)}function On(){const n=ct();return(e,t,{cancelable:l=!1}={})=>{const o=n.$$.callbacks[e];if(o){const r=In(e,t,{cancelable:l});return o.slice().forEach(i=>{i.call(n,r)}),!r.defaultPrevented}return!0}}const De=[],ve=[];let Ge=[];const Rt=[],En=Promise.resolve();let yt=!1;function Nn(){yt||(yt=!0,En.then(St))}function Fe(n){Ge.push(n)}const _t=new Set;let Ne=0;function St(){if(Ne!==0)return;const n=Ve;do{try{for(;Ne<De.length;){const e=De[Ne];Ne++,Le(e),xn(e.$$)}}catch(e){throw De.length=0,Ne=0,e}for(Le(null),De.length=0,Ne=0;ve.length;)ve.pop()();for(let e=0;e<Ge.length;e+=1){const t=Ge[e];_t.has(t)||(_t.add(t),t())}Ge.length=0}while(De.length);for(;Rt.length;)Rt.pop()();yt=!1,_t.clear(),Le(n)}function xn(n){if(n.fragment!==null){n.update(),Q(n.before_update);const e=n.dirty;n.dirty=[-1],n.fragment&&n.fragment.p(n.ctx,e),n.after_update.forEach(Fe)}}function Mn(n){const e=[],t=[];Ge.forEach(l=>n.indexOf(l)===-1?e.push(l):t.push(l)),t.forEach(l=>l()),Ge=e}const tt=new Set;let Oe;function Ye(){Oe={r:0,c:[],p:Oe}}function Ze(){Oe.r||Q(Oe.c),Oe=Oe.p}function q(n,e){n&&n.i&&(tt.delete(n),n.i(e))}function J(n,e,t,l){if(n&&n.o){if(tt.has(n))return;tt.add(n),Oe.c.push(()=>{tt.delete(n),l&&(t&&n.d(1),l())}),n.o(e)}else l&&l()}function st(n,e){const t=e.token={};function l(o,r,i,a){if(e.token!==t)return;e.resolved=a;let c=e.ctx;i!==void 0&&(c=c.slice(),c[i]=a);const u=o&&(e.current=o)(c);let f=!1;e.block&&(e.blocks?e.blocks.forEach((d,g)=>{g!==r&&d&&(Ye(),J(d,1,1,()=>{e.blocks[g]===d&&(e.blocks[g]=null)}),Ze())}):e.block.d(1),u.c(),q(u,1),u.m(e.mount(),e.anchor),f=!0),e.block=u,e.blocks&&(e.blocks[r]=u),f&&St()}if(Ln(n)){const o=ct();if(n.then(r=>{Le(o),l(e.then,1,e.value,r),Le(null)},r=>{if(Le(o),l(e.catch,2,e.error,r),Le(null),!e.hasCatch)throw r}),e.current!==e.pending)return l(e.pending,0),!0}else{if(e.current!==e.then)return l(e.then,1,e.value,n),!0;e.resolved=n}}function un(n,e,t){const l=e.slice(),{resolved:o}=n;n.current===n.then&&(l[n.value]=o),n.current===n.catch&&(l[n.error]=o),n.block.p(l,t)}function de(n){return(n==null?void 0:n.length)!==void 0?n:Array.from(n)}function jn(n,e){n.d(1),e.delete(n.key)}function An(n,e,t,l,o,r,i,a,c,u,f,d){let g=n.length,_=r.length,p=g;const y={};for(;p--;)y[n[p].key]=p;const b=[],L=new Map,C=new Map,B=[];for(p=_;p--;){const $=d(o,r,p),S=t($);let O=i.get(S);O?l&&B.push(()=>O.p($,e)):(O=u(S,$),O.c()),L.set(S,b[p]=O),S in y&&C.set(S,Math.abs(p-y[S]))}const N=new Set,I=new Set;function T($){q($,1),$.m(a,f),i.set($.key,$),f=$.first,_--}for(;g&&_;){const $=b[_-1],S=n[g-1],O=$.key,H=S.key;$===S?(f=$.first,g--,_--):L.has(H)?!i.has(O)||N.has(O)?T($):I.has(H)?g--:C.get(O)>C.get(H)?(I.add(O),T($)):(N.add(H),g--):(c(S,i),g--)}for(;g--;){const $=n[g];L.has($.key)||c($,i)}for(;_;)T(b[_-1]);return Q(B),b}function re(n){n&&n.c()}function ee(n,e,t){const{fragment:l,after_update:o}=n.$$;l&&l.m(e,t),Fe(()=>{const r=n.$$.on_mount.map(on).filter(lt);n.$$.on_destroy?n.$$.on_destroy.push(...r):Q(r),n.$$.on_mount=[]}),o.forEach(Fe)}function te(n,e){const t=n.$$;t.fragment!==null&&(Mn(t.after_update),Q(t.on_destroy),t.fragment&&t.fragment.d(e),t.on_destroy=t.fragment=null,t.ctx=[])}function Dn(n,e){n.$$.dirty[0]===-1&&(De.push(n),Nn(),n.$$.dirty.fill(0)),n.$$.dirty[e/31|0]|=1<<e%31}function pe(n,e,t,l,o,r,i=null,a=[-1]){const c=Ve;Le(n);const u=n.$$={fragment:null,ctx:[],props:r,update:A,not_equal:o,bound:Lt(),on_mount:[],on_destroy:[],on_disconnect:[],before_update:[],after_update:[],context:new Map(e.context||(c?c.$$.context:[])),callbacks:Lt(),dirty:a,skip_bound:!1,root:e.target||c.$$.root};i&&i(u.root);let f=!1;if(u.ctx=t?t(n,e.props||{},(d,g,..._)=>{const p=_.length?_[0]:g;return u.ctx&&o(u.ctx[d],u.ctx[d]=p)&&(!u.skip_bound&&u.bound[d]&&u.bound[d](p),f&&Dn(n,d)),g}):[],u.update(),f=!0,Q(u.before_update),u.fragment=l?l(u.ctx):!1,e.target){if(e.hydrate){const d=Un(e.target);u.fragment&&u.fragment.l(d),d.forEach(k)}else u.fragment&&u.fragment.c();e.intro&&q(n.$$.fragment),ee(n,e.target,e.anchor),St()}Le(c)}class _e{constructor(){We(this,"$$");We(this,"$$set")}$destroy(){te(this,1),this.$destroy=A}$on(e,t){if(!lt(t))return A;const l=this.$$.callbacks[e]||(this.$$.callbacks[e]=[]);return l.push(t),()=>{const o=l.indexOf(t);o!==-1&&l.splice(o,1)}}$set(e){this.$$set&&!Rn(e)&&(this.$$.skip_bound=!0,this.$$set(e),this.$$.skip_bound=!1)}}const Bn="4",xe=[];function Ue(n,e=A){let t;const l=new Set;function o(a){if(fe(n,a)&&(n=a,t)){const c=!xe.length;for(const u of l)u[1](),xe.push(u,n);if(c){for(let u=0;u<xe.length;u+=2)xe[u][0](xe[u+1]);xe.length=0}}}function r(a){o(a(n))}function i(a,c=A){const u=[a,c];return l.add(u),l.size===1&&(t=e(o,r)||A),a(n),()=>{l.delete(u),l.size===0&&t&&(t(),t=null)}}return{set:o,update:r,subscribe:i}}var Xe=(n=>(n.info="info",n.warn="warn",n.error="error",n))(Xe||{});class qn{constructor(){We(this,"logs",Ue([]))}_addLog(e,t){this.logs.update(l=>(l.unshift({date:new Date,severity:e,content:t}),l))}info(e){this._addLog("info",e)}warn(e){this._addLog("warn",e)}error(e){this._addLog("error",e)}updateLogAtIndex(e,t){this.logs.update(l=>(l[e]&&(l[e].content=t),l))}}const E=new qn;function Gn(n,e){let t=!1;return n.subscribe(l=>{t?e(l):t=!0})}const Fn={use_dark_theme:!0,rs_plugin_loader:!1,close_after_launch:!1,check_announcements:!0,flatpak_rich_presence:!1,runelite_use_custom_jar:!1,use_custom_rs_config_uri:!1,selected:{game:le.osrs,client:Te.runelite,user_id:null},userDetails:{}};function Jn(){const e=new URLSearchParams(window.location.search).get("config");function t(o){return typeof o=="object"&&typeof o.use_dark_theme=="boolean"&&typeof o.rs_plugin_loader=="boolean"&&typeof o.close_after_launch=="boolean"&&typeof o.check_announcements=="boolean"&&typeof o.flatpak_rich_presence=="boolean"&&typeof o.runelite_use_custom_jar=="boolean"&&typeof o.selected=="object"&&Object.values(le).includes(o.selected.game)&&Object.values(Te).includes(o.selected.client)&&(typeof o.selected.user_id=="string"||o.selected.user_id===null)&&typeof o.userDetails=="object"}const{config:l}=x;if(e)try{const o=JSON.parse(e);typeof o.check_announcements>"u"&&(o.check_announcements=!0,x.configHasPendingChanges=!0),typeof o.close_after_launch>"u"&&(o.close_after_launch=!1,x.configHasPendingChanges=!0),t(o)?l.set(o):(E.error("The config saved on disk is not the correct format. It has been restored to default."),x.configHasPendingChanges=!0)}catch{E.error("Unable to parse config, restoring to default"),x.configHasPendingChanges=!0}else x.configHasPendingChanges=!0;Gn(x.config,()=>{x.configHasPendingChanges=!0})}const x={initialized:Ue(!1),configHasPendingChanges:!1,pluginConfigHasPendingChanges:!1,config:Ue(Fn),sessions:Ue([])};let gt=!1,ht=!1;class V{static async login(e,t){const l=await nt.buildSession(e,t);if(!l.ok)return K(l.error);const o=l.value,i=ke(x.sessions).findIndex(a=>a.user.userId===e.sub);return i!==-1?x.sessions.update(a=>(a[i]=o,a)):(x.sessions.update(a=>(a.push(o),a)),x.config.update(a=>(a.selected.user_id=o.user.userId,a))),ye(o)}static async logout(e){const{sessions:t,config:l}=x;return t.update(o=>{const r=o.findIndex(i=>i.user.userId===e);return r>-1&&(we.revokeOauthCreds(o[r].tokens.access_token),o.splice(r,1)),o}),l.update(o=>(typeof o.userDetails[e]<"u"&&delete o.userDetails[e],o.selected.user_id===e&&(o.selected.user_id=null),o)),ke(t)}static postJSON(e,t,l=null){const o=JSON.stringify(t);return fetch(e,{method:"POST",body:o,headers:{"Content-Type":"application/json"}}).then(i=>{i.ok||i.text().then(a=>E.error(`${e} error: ${i.status}: ${a}`)),l&&l(i)})}static saveConfig(e=!0){if(gt||e&&!x.configHasPendingChanges)return;gt=!0;const t=ke(x.config);return this.postJSON("/save-config",t,()=>gt=!1),t}static savePluginConfig(e=!0){ht||e&&!x.pluginConfigHasPendingChanges||(ht=!0,this.postJSON("/save-plugin-config",P.pluginConfig,()=>ht=!1))}static async saveCredentials(){return this.postJSON("/save-credentials",ke(x.sessions))}static async openFilePicker(){const e=await fetch("/jar-file-picker");return e.status===200?e.text():null}static findSession(e){return ke(x.sessions).find(l=>l.user.userId===e)}static findAccount(e,t){return e.find(l=>l.accountId==t)}}const vt=Ue([]),mt=Ue(null);typeof window<"u"&&(window.__svelte||(window.__svelte={v:new Set})).v.add(Bn);function Wn(n){let e,t;const l=n[4].default,o=ot(l,n,n[3],null);return{c(){e=m("main"),o&&o.c(),h(e,"class","fixed top-0 h-screen w-screen bg-slate-100 text-xs text-slate-900 duration-200 sm:text-sm md:text-base dark:bg-slate-900 dark:text-slate-50"),oe(e,"dark",n[0])},m(r,i){w(r,e,i),o&&o.m(e,null),t=!0},p(r,[i]){o&&o.p&&(!t||i&8)&&it(o,l,r,r[3],t?rt(l,r[3],i,null):at(r[3]),null),(!t||i&1)&&oe(e,"dark",r[0])},i(r){t||(q(o,r),t=!0)},o(r){J(o,r),t=!1},d(r){r&&k(e),o&&o.d(r)}}}function Xn(n,e,t){let l,o,{$$slots:r={},$$scope:i}=e;const{config:a}=x;return he(n,a,c=>t(2,o=c)),n.$$set=c=>{"$$scope"in c&&t(3,i=c.$$scope)},n.$$.update=()=>{n.$$.dirty&4&&t(0,l=o.use_dark_theme)},[l,a,o,i,r]}class fn extends _e{constructor(e){super(),pe(this,e,Xn,Wn,fe,{})}}function zn(n){let e;return{c(){e=m("div"),e.innerHTML='<img class="h-60 w-60 animate-spin" src="svgs/circle-notch-solid.svg" alt="loading"/>',h(e,"class","flex h-full items-center justify-center")},m(t,l){w(t,e,l)},p:A,d(t){t&&k(e)}}}function Vn(n){let e,t;return e=new fn({props:{$$slots:{default:[zn]},$$scope:{ctx:n}}}),{c(){re(e.$$.fragment)},m(l,o){ee(e,l,o),t=!0},p(l,[o]){const r={};o&32&&(r.$$scope={dirty:o,ctx:l}),e.$set(r)},i(l){t||(q(e.$$.fragment,l),t=!0)},o(l){J(e.$$.fragment,l),t=!1},d(l){te(e,l)}}}function Yn(n){const e=window.opener;P.env==null&&o("BoltEnv is not defined. Please close and re-open Bolt to try again.");async function t(i){const a=Be.get("auth_verifier");if(!a)return o("Verifier token has expired. Please try signing in again."),null;const{clientid:c,redirect:u}=P.env,f=await we.getOAuthToken(P.env.origin,c,a,u,i);return f.ok?f.value:(o(`Fetching OAuth token failed. ${f.error}`),null)}async function l(i){const a=Be.get("auth_nonce"),c=we.validateIdToken(i,a??"");if(!c.ok)return o(c.error),null;const u=await we.getSessionId(P.env.auth_api,i);return u.ok?u.value:(o(`Unable to retreive session id. ${u.error}`),null)}function o(i){r({type:"authFailed",reason:i}),fetch("/close")}function r(i){e.postMessage(i,window.location.origin)}return cn(async()=>{const i=new URLSearchParams(window.location.search),a=i.get("code"),c=i.get("state"),u=i.get("id_token");if(u==null&&a&&c){const f=await t(a);if(!f)return o("tokens object is null.");r({type:"authTokenUpdate",tokens:f});const d=crypto.randomUUID();we.navigateToAuthConsent(P.env.origin,f.id_token,d)}else if(u&&a&&c){const f=await l(u);if(!f)return o("sessionId is null");r({type:"authSessionUpdate",sessionId:f}),fetch("/close")}else o("Authentication server did not response with the appropriate parameters. Please try again later.")}),Hn(()=>{Be.remove("auth_verifier"),Be.remove("auth_nonce")}),[]}class Zn extends _e{constructor(e){super(),pe(this,e,Yn,Vn,fe,{})}}function Pt(n){let e,t,l;return{c(){e=m("button"),e.innerHTML='<img src="svgs/xmark-solid.svg" class="h-5 w-5" alt="Close"/>',h(e,"class","absolute right-3 top-3 rounded-full bg-rose-500 p-[2px] shadow-lg duration-200 hover:rotate-90 hover:opacity-75")},m(o,r){w(o,e,r),t||(l=M(e,"click",n[2]),t=!0)},p:A,d(o){o&&k(e),t=!1,l()}}}function Tt(n){let e;const t=n[7].default,l=ot(t,n,n[6],null);return{c(){l&&l.c()},m(o,r){l&&l.m(o,r),e=!0},p(o,r){l&&l.p&&(!e||r&64)&&it(l,t,o,o[6],e?rt(t,o[6],r,null):at(o[6]),null)},i(o){e||(q(l,o),e=!0)},o(o){J(l,o),e=!1},d(o){l&&l.d(o)}}}function Kn(n){let e,t,l,o,r,i,a=n[1]&&Pt(n),c=n[4]&&Tt(n);return{c(){e=m("dialog"),a&&a.c(),t=R(),c&&c.c(),h(e,"class",l=n[0]+" backdrop max-h-[90%] max-w-[90%] overflow-auto rounded-xl text-inherit focus-visible:outline-none svelte-csux1e"),oe(e,"backdrop:cursor-pointer",n[1])},m(u,f){w(u,e,f),a&&a.m(e,null),v(e,t),c&&c.m(e,null),n[8](e),o=!0,r||(i=[M(e,"keydown",n[9]),M(e,"mousedown",Tn(n[10]))],r=!0)},p(u,[f]){u[1]?a?a.p(u,f):(a=Pt(u),a.c(),a.m(e,t)):a&&(a.d(1),a=null),u[4]?c?(c.p(u,f),f&16&&q(c,1)):(c=Tt(u),c.c(),q(c,1),c.m(e,null)):c&&(Ye(),J(c,1,1,()=>{c=null}),Ze()),(!o||f&1&&l!==(l=u[0]+" backdrop max-h-[90%] max-w-[90%] overflow-auto rounded-xl text-inherit focus-visible:outline-none svelte-csux1e"))&&h(e,"class",l),(!o||f&3)&&oe(e,"backdrop:cursor-pointer",u[1])},i(u){o||(q(c),o=!0)},o(u){J(c),o=!1},d(u){u&&k(e),a&&a.d(),c&&c.d(),n[8](null),r=!1,Q(i)}}}function Qn(n,e,t){let{$$slots:l={},$$scope:o}=e,{class:r=""}=e,{canSelfClose:i=!0}=e,a,c=!1;const u=On();function f(){a.showModal(),t(4,c=!0)}function d(){u("close"),a.close(),t(4,c=!1)}function g(y){ve[y?"unshift":"push"](()=>{a=y,t(3,a)})}const _=y=>{y.key==="Escape"&&(y.preventDefault(),i&&d())},p=()=>{i&&d()};return n.$$set=y=>{"class"in y&&t(0,r=y.class),"canSelfClose"in y&&t(1,i=y.canSelfClose),"$$scope"in y&&t(6,o=y.$$scope)},[r,i,d,a,c,f,o,l,g,_,p]}class ut extends _e{constructor(e){super(),pe(this,e,Qn,Kn,fe,{class:0,canSelfClose:1,open:5,close:2})}get open(){return this.$$.ctx[5]}get close(){return this.$$.ctx[2]}}function es(n){let e,t,l,o,r,i,a;return{c(){e=m("p"),e.textContent=`${atob("Qm9sdCBpcyBhbiB1bm9mZmljaWFsIHRoaXJkLXBhcnR5IGxhdW5jaGVyLiBJdCdzIGZyZWUgYW5kIG9wZW4tc291cmNlIHNvZnR3YXJlIGxpY2Vuc2VkIHVuZGVyIEFHUEwgMy4wLg==")}`,t=R(),l=m("p"),l.textContent=`${atob("SmFnZXggaXMgbm90IHJlc3BvbnNpYmxlIGZvciBhbnkgcHJvYmxlbXMgb3IgZGFtYWdlIGNhdXNlZCBieSB1c2luZyB0aGlzIHByb2R1Y3Qu")}`,o=R(),r=m("button"),r.textContent="I Understand",h(e,"class","p-2"),h(l,"class","p-2"),h(r,"class","m-5 rounded-lg border-2 border-blue-500 p-2 duration-200 hover:opacity-75")},m(c,u){w(c,e,u),w(c,t,u),w(c,l,u),w(c,o,u),w(c,r,u),i||(a=M(r,"click",n[2]),i=!0)},p:A,d(c){c&&(k(e),k(t),k(l),k(o),k(r)),i=!1,a()}}}function ts(n){let e,t,l={canSelfClose:!1,class:"w-1/2 text-center",$$slots:{default:[es]},$$scope:{ctx:n}};return e=new ut({props:l}),n[3](e),{c(){re(e.$$.fragment)},m(o,r){ee(e,o,r),t=!0},p(o,[r]){const i={};r&33&&(i.$$scope={dirty:r,ctx:o}),e.$set(i)},i(o){t||(q(e.$$.fragment,o),t=!0)},o(o){J(e.$$.fragment,o),t=!1},d(o){n[3](null),te(e,o)}}}function ns(n,e,t){let l;const{sessions:o}=x;he(n,o,c=>t(4,l=c));let r;cn(()=>{l.length==0&&r.open()});const i=()=>r.close();function a(c){ve[c?"unshift":"push"](()=>{r=c,t(0,r)})}return[r,o,i,a]}class ss extends _e{constructor(e){super(),pe(this,e,ns,ts,fe,{})}}function ls(n,e,t){V.saveConfig();const l=(a,c)=>{const u=new XMLHttpRequest,f={},d=ke(x.config);a&&(f.hash=a),n&&(f.jx_session_id=n),e&&(f.jx_character_id=e),t&&(f.jx_display_name=t),d.rs_plugin_loader&&(f.plugin_loader="1"),d.use_custom_rs_config_uri&&d.rs_config_uri?f.config_uri=d.rs_config_uri:f.config_uri=P.env.default_config_uri,u.open("POST","/launch-rs3-deb?".concat(new URLSearchParams(f).toString()),!0),u.onreadystatechange=()=>{u.readyState==4&&(E.info(`Game launch status: '${u.responseText.trim()}'`),u.status==200&&(a&&(P.rs3DebInstalledHash=a),d.close_after_launch&&!d.rs_plugin_loader&&fetch("/close")))},u.send(c)},o=new XMLHttpRequest,r=P.env.content_url,i=r.concat("dists/trusty/non-free/binary-amd64/Packages");o.open("GET",i,!0),o.onreadystatechange=()=>{if(o.readyState==4&&o.status==200){const a=Object.fromEntries(o.response.split(`
`).map(c=>c.split(": ")));if(!a.Filename||!a.Size){E.error(`Could not parse package data from URL: ${i}`),l();return}if(a.SHA256!==P.rs3DebInstalledHash){E.info("Downloading RS3 client...");const c=new XMLHttpRequest;c.open("GET",r.concat(a.Filename),!0),c.responseType="arraybuffer",c.onprogress=u=>{if(u.loaded){const f=(Math.round(1e3*u.loaded/u.total)/10).toFixed(1);E.updateLogAtIndex(0,`Downloading RS3 client... ${f}%`)}},c.onreadystatechange=()=>{c.readyState==4&&c.status==200&&l(a.SHA256,c.response)},c.onerror=()=>{E.error(`Error downloading game client: from ${i}: non-http error`),l()},c.send()}else E.info("Latest client is already installed"),l()}},o.onerror=()=>{E.error(`Error: from ${i}: non-http error`),l()},o.send()}function dn(n,e,t,l){V.saveConfig();const o=l?"/launch-runelite-jar-configure?":"/launch-runelite-jar?",r=ke(x.config),i=(f,d,g)=>{const _=new XMLHttpRequest,p={};f&&(p.id=f),g&&(p.jar_path=g),n&&(p.jx_session_id=n),e&&(p.jx_character_id=e),t&&(p.jx_display_name=t),r.flatpak_rich_presence&&(p.flatpak_rich_presence=""),_.open(d?"POST":"GET",o.concat(new URLSearchParams(p).toString()),!0),_.onreadystatechange=()=>{_.readyState==4&&(E.info(`Game launch status: '${_.responseText.trim()}'`),_.status==200&&(f&&(P.runeLiteInstalledId=f),r.close_after_launch&&!l&&fetch("/close")))},_.send(d)};if(r.runelite_use_custom_jar){i(null,null,r.runelite_custom_jar);return}const a=2*60*1e3;if(P.runeLiteInstalledId!==null){const f=ke(mt);if(f!==null&&f+a>Date.now()){i();return}}const c=new XMLHttpRequest;c.open("GET","https://api.github.com/repos/runelite/launcher/releases",!0),c.onreadystatechange=()=>{if(c.readyState==4)if(c.status==200){const f=JSON.parse(c.responseText).map(d=>d.assets).flat().find(d=>d.name.toLowerCase()=="runelite.jar");if(f.id!=P.runeLiteInstalledId){E.info("Downloading RuneLite...");const d=new XMLHttpRequest;d.open("GET",f.browser_download_url,!0),d.responseType="arraybuffer",d.onreadystatechange=()=>{d.readyState==4&&(d.status==200?(mt.set(Date.now()),i(f.id,d.response)):E.error(`Error downloading from ${f.url}: ${d.status}: ${d.responseText}`))},d.onprogress=g=>{if(g.loaded&&g.lengthComputable){const _=(Math.round(1e3*g.loaded/g.total)/10).toFixed(1);E.updateLogAtIndex(0,`Downloading RuneLite... ${_}%`)}},d.send()}else mt.set(Date.now()),i()}else E.error(`Failed to check for RuneLite updates: ${c.status}: ${c.responseText}`),i()},c.send()}function os(n,e,t){V.saveConfig();const l=ke(x.config),o=(a,c)=>{const u=new XMLHttpRequest,f={};a&&(f.version=a),n&&(f.jx_session_id=n),e&&(f.jx_character_id=e),t&&(f.jx_display_name=t),u.open("POST","/launch-hdos-jar?".concat(new URLSearchParams(f).toString()),!0),u.onreadystatechange=()=>{u.readyState==4&&(E.info(`Game launch status: '${u.responseText.trim()}'`),u.status==200&&(a&&(P.hdosInstalledVersion=a),l.close_after_launch&&fetch("/close")))},u.send(c)},r=new XMLHttpRequest,i="https://cdn.hdos.dev/client/getdown.txt";r.open("GET",i,!0),r.onreadystatechange=()=>{if(r.readyState==4)if(r.status==200){const a=r.responseText.match(/^launcher\.version *= *(.*?)$/m);if(a&&a.length>=2){const c=a[1];if(c!==P.hdosInstalledVersion){const u=`https://cdn.hdos.dev/launcher/v${c}/hdos-launcher.jar`;E.info("Downloading HDOS...");const f=new XMLHttpRequest;f.open("GET",u,!0),f.responseType="arraybuffer",f.onreadystatechange=()=>{if(f.readyState==4)if(f.status==200)o(c,f.response);else{const d=JSON.parse(r.responseText).map(g=>g.assets).flat().find(g=>g.name.toLowerCase()=="runelite.jar");E.error(`Error downloading from ${d.url}: ${f.status}: ${f.responseText}`)}},f.onprogress=d=>{if(d.loaded&&d.lengthComputable){const g=(Math.round(1e3*d.loaded/d.total)/10).toFixed(1);E.updateLogAtIndex(0,`Downloading HDOS... ${g}%`)}},f.send()}else E.info("Latest JAR is already installed"),o()}else E.info("Couldn't parse latest launcher version"),o()}else E.error(`Error from ${i}: ${r.status}: ${r.responseText}`)},r.send()}function bt(){const n=new XMLHttpRequest;n.open("GET","/list-game-clients",!0),n.onreadystatechange=()=>{n.readyState==4&&n.status!=200&&E.error(`Error requesting client list: ${n.status}: ${n.responseText}`)},n.send()}async function Ut(n,e,t,l,o){V.saveConfig();const r=`${e?"osrs":P.env.provider}-${n?"win":"mac"}`;let i=n?e?P.osrsExeInstalledHash:P.rs3ExeInstalledHash:e?P.osrsAppInstalledHash:P.rs3AppInstalledHash;const a=async(S,O)=>{const H={},F=ke(x.config);S&&(H.hash=S),t&&(H.jx_session_id=t),l&&(H.jx_character_id=l),o&&(H.jx_display_name=o),e||(F.rs_plugin_loader&&(H.plugin_loader="1"),H.config_uri=F.use_custom_rs_config_uri&&F.rs_config_uri?F.rs_config_uri:P.env.default_config_uri);const ne=await fetch(`/launch-${e?"osrs":"rs3"}-${n?"exe":"app"}?${new URLSearchParams(H).toString()}`,{method:"POST",headers:{"Content-Type":"application/octet-stream"},body:await O});ne.text().then(Y=>E.info(`Game launch status: '${Y.trim()}'`)),ne.status==200&&(S&&(i=S),F.close_after_launch&&(e||!F.rs_plugin_loader)&&fetch("/close"))},c=`${P.env.direct6_url}${r}/${r}.json`,u=await fetch(c,{method:"GET"}),f=await u.text();if(u.status!==200){E.error(`Error from ${c}: ${u.status}: ${f}`);return}const d=JSON.parse(atob(f.split(".")[1])).environments.production;if(i===d.id){E.info("Latest client is already installed"),a();return}E.info(`Downloading client version ${d.version}`);const g=`${P.env.direct6_url}${r}/catalog/${d.id}/catalog.json`,_=await fetch(g,{method:"GET"}),p=await _.text();if(_.status!==200){E.error(`Error from ${g}: ${_.status}: ${p}`);return}const y=JSON.parse(atob(p.split(".")[1])),b=S=>S.replace(/^http:\/\/(.{5})-akamai\.aws\.snxd\.com\//i,"https://$1.akamaized.net/").replace(/^http:/i,"https:"),L=b(y.metafile),C=await fetch(L,{method:"GET"}),B=await C.text();if(C.status!==200){E.error(`Error from ${L}: ${C.status}: ${B}`);return}const N=JSON.parse(atob(B.split(".")[1])),I=N.pieces.digests.map(S=>{const O=atob(S).split("").map(F=>F.charCodeAt(0).toString(16).padStart(2,"0")).join(""),H=b(y.config.remote.baseUrl).concat(y.config.remote.pieceFormat.replace("{SubString:0,2,{TargetDigest}}",O.substring(0,2)).replace("{TargetDigest}",O));return fetch(H,{method:"GET"}).then(F=>F.blob().then(ne=>{const Y=new DecompressionStream("gzip");return new Response(ne.slice(6).stream().pipeThrough(Y)).blob()}))});let T=0,$=null;for(let S=0;S<N.files.length;S+=1)if(n?N.files[S].name.endsWith(".exe"):N.files[S].name.includes(".app/Contents/MacOS/"))if($!==null){E.error(`Error parsing ${L}: file list has multiple possibilities for main exe`);return}else $=N.files[S].size;else $===null&&(T+=N.files[S].size);if($===null){E.error(`Error parsing ${L}: file list has no possibilities for main exe`);return}Promise.all(I).then(S=>{const O=new Blob(S).slice(T,T+$);a(N.id,O.arrayBuffer())})}function It(n,e,t){const l=n.slice();return l[48]=e[t],l}function Ht(n,e,t){const l=n.slice();return l[51]=e[t],l}function Ot(n,e,t){const l=n.slice();return l[54]=e[t][0],l[47]=e[t][1],l}function Et(n,e,t){const l=n.slice();return l[48]=e[t],l}function rs(n){let e,t=de(n[5]),l=[];for(let o=0;o<t.length;o+=1)l[o]=Nt(Et(n,t,o));return{c(){for(let o=0;o<l.length;o+=1)l[o].c();e=Se()},m(o,r){for(let i=0;i<l.length;i+=1)l[i]&&l[i].m(o,r);w(o,e,r)},p(o,r){if(r[0]&14628){t=de(o[5]);let i;for(i=0;i<t.length;i+=1){const a=Et(o,t,i);l[i]?l[i].p(a,r):(l[i]=Nt(a),l[i].c(),l[i].m(e.parentNode,e))}for(;i<l.length;i+=1)l[i].d(1);l.length=t.length}},d(o){o&&k(e),Ee(l,o)}}}function is(n){let e;return{c(){e=m("p"),e.textContent="(start an RS3 game client with plugins enabled and it will be listed here.)"},m(t,l){w(t,e,l)},p:A,d(t){t&&k(e)}}}function Nt(n){let e,t=(n[48].identity||Jt)+"",l,o,r,i,a,c;function u(){return n[24](n[48])}return{c(){e=m("button"),l=G(t),r=R(),i=m("br"),h(e,"class",o="m-1 h-[28px] w-[95%] select-none rounded-lg border-2 "+(n[11]&&n[2]===n[48].uid?"border-black bg-blue-500 text-black":"border-blue-500 text-black dark:text-white")+" hover:opacity-75")},m(f,d){w(f,e,d),v(e,l),w(f,r,d),w(f,i,d),a||(c=M(e,"click",u),a=!0)},p(f,d){n=f,d[0]&32&&t!==(t=(n[48].identity||Jt)+"")&&ce(l,t),d[0]&2084&&o!==(o="m-1 h-[28px] w-[95%] select-none rounded-lg border-2 "+(n[11]&&n[2]===n[48].uid?"border-black bg-blue-500 text-black":"border-blue-500 text-black dark:text-white")+" hover:opacity-75")&&h(e,"class",o)},d(f){f&&(k(e),k(r),k(i)),a=!1,c()}}}function as(n){let e;return{c(){e=m("p"),e.textContent="error"},m(t,l){w(t,e,l)},p:A,d(t){t&&k(e)}}}function cs(n){let e,t,l,o,r,i=de(Object.entries(n[0].pluginConfig)),a=[];for(let d=0;d<i.length;d+=1)a[d]=xt(Ot(n,i,d));function c(d,g){return d[11]?us:fs}let u=c(n),f=u(n);return{c(){e=m("select");for(let d=0;d<a.length;d+=1)a[d].c();t=R(),f.c(),l=Se(),h(e,"class","mx-auto mb-4 w-[min(280px,_45%)] cursor-pointer rounded-lg border-2 border-slate-300 bg-inherit p-2 text-inherit duration-200 hover:opacity-75 dark:border-slate-800"),n[1]===void 0&&Fe(()=>n[25].call(e))},m(d,g){w(d,e,g);for(let _=0;_<a.length;_+=1)a[_]&&a[_].m(e,null);Ie(e,n[1],!0),w(d,t,g),f.m(d,g),w(d,l,g),o||(r=[M(e,"change",n[25]),M(e,"change",n[26])],o=!0)},p(d,g){if(g[0]&1){i=de(Object.entries(d[0].pluginConfig));let _;for(_=0;_<i.length;_+=1){const p=Ot(d,i,_);a[_]?a[_].p(p,g):(a[_]=xt(p),a[_].c(),a[_].m(e,null))}for(;_<a.length;_+=1)a[_].d(1);a.length=i.length}g[0]&3&&Ie(e,d[1]),u===(u=c(d))&&f?f.p(d,g):(f.d(1),f=u(d),f&&(f.c(),f.m(l.parentNode,l)))},d(d){d&&(k(e),k(t),k(l)),Ee(a,d),f.d(d),o=!1,Q(r)}}}function xt(n){let e,t=(n[47].name??Je)+"",l,o;return{c(){e=m("option"),l=G(t),h(e,"class","dark:bg-slate-900"),e.__value=o=n[54],ue(e,e.__value)},m(r,i){w(r,e,i),v(e,l)},p(r,i){i[0]&1&&t!==(t=(r[47].name??Je)+"")&&ce(l,t),i[0]&1&&o!==(o=r[54])&&(e.__value=o,ue(e,e.__value))},d(r){r&&k(e)}}}function us(n){let e,t,l,o,r={ctx:n,current:null,token:null,hasCatch:!0,pending:ks,then:ps,catch:ds,value:47};return st(o=n[4],r),{c(){e=m("br"),t=R(),l=Se(),r.block.c()},m(i,a){w(i,e,a),w(i,t,a),w(i,l,a),r.block.m(i,r.anchor=a),r.mount=()=>l.parentNode,r.anchor=l},p(i,a){n=i,r.ctx=n,a[0]&16&&o!==(o=n[4])&&st(o,r)||un(r,n,a)},d(i){i&&(k(e),k(t),k(l)),r.block.d(i),r.token=null,r=null}}}function fs(n){let e,t,l,o,r,i,a,c,u,f,d,g,_,p,y,b,L,C=n[12]&&Dt(n);function B(T,$){return $[0]&1&&(p=null),p==null&&(p=Object.entries(T[0].pluginConfig).length!==0),p?ys:ws}let N=B(n,[-1,-1]),I=N(n);return{c(){e=m("span"),t=m("button"),l=m("img"),i=R(),a=m("button"),c=m("img"),f=R(),d=m("br"),g=R(),C&&C.c(),_=R(),I.c(),y=Se(),wt(l.src,o="svgs/download-solid.svg")||h(l,"src",o),h(l,"alt","Install plugin from updater URL"),h(t,"class","mx-1 aspect-square w-9 select-none rounded-md bg-blue-500 p-1 text-[20px] font-bold duration-200 enabled:hover:opacity-75 disabled:bg-gray-500"),t.disabled=r=!n[0].hasLibArchive||n[10],h(t,"title","Install plugin from updater URL"),wt(c.src,u="svgs/folder-solid.svg")||h(c,"src",u),h(c,"alt","Install plugin from local directory"),h(a,"class","aspect-square w-9 select-none rounded-md bg-blue-500 p-1 text-[20px] font-bold duration-200 enabled:hover:opacity-75 disabled:bg-gray-500"),a.disabled=n[10],h(a,"title","Install plugin from local directory"),h(e,"class","align-middle")},m(T,$){w(T,e,$),v(e,t),v(t,l),v(e,i),v(e,a),v(a,c),w(T,f,$),w(T,d,$),w(T,g,$),C&&C.m(T,$),w(T,_,$),I.m(T,$),w(T,y,$),b||(L=[M(t,"click",n[27]),M(a,"click",n[17])],b=!0)},p(T,$){$[0]&1025&&r!==(r=!T[0].hasLibArchive||T[10])&&(t.disabled=r),$[0]&1024&&(a.disabled=T[10]),T[12]?C?C.p(T,$):(C=Dt(T),C.c(),C.m(_.parentNode,_)):C&&(C.d(1),C=null),N===(N=B(T,$))&&I?I.p(T,$):(I.d(1),I=N(T),I&&(I.c(),I.m(y.parentNode,y)))},d(T){T&&(k(e),k(f),k(d),k(g),k(_),k(y)),C&&C.d(T),I.d(T),b=!1,Q(L)}}}function ds(n){let e;return{c(){e=m("p"),e.textContent="error"},m(t,l){w(t,e,l)},p:A,d(t){t&&k(e)}}}function ps(n){let e,t,l,o,r,i,a,c,u,f;function d(b,L){return L[0]&19&&(e=null),L[0]&1&&(t=null),e==null&&(e=!!(b[47]&&b[47].main&&Object.keys(b[0].pluginConfig).includes(b[1]))),e?hs:(t==null&&(t=Object.entries(b[0].pluginConfig).length===0),t?gs:_s)}let g=d(n,[-1,-1]),_=g(n),p=de(n[5]),y=[];for(let b=0;b<p.length;b+=1)y[b]=At(It(n,p,b));return{c(){_.c(),l=R(),o=m("br"),r=R(),i=m("br"),a=R(),c=m("hr"),u=R();for(let b=0;b<y.length;b+=1)y[b].c();f=Se(),h(c,"class","p-1 dark:border-slate-700")},m(b,L){_.m(b,L),w(b,l,L),w(b,o,L),w(b,r,L),w(b,i,L),w(b,a,L),w(b,c,L),w(b,u,L);for(let C=0;C<y.length;C+=1)y[C]&&y[C].m(b,L);w(b,f,L)},p(b,L){if(g===(g=d(b,L))&&_?_.p(b,L):(_.d(1),_=g(b),_&&(_.c(),_.m(l.parentNode,l))),L[0]&524325){p=de(b[5]);let C;for(C=0;C<p.length;C+=1){const B=It(b,p,C);y[C]?y[C].p(B,L):(y[C]=At(B),y[C].c(),y[C].m(f.parentNode,f))}for(;C<y.length;C+=1)y[C].d(1);y.length=p.length}},d(b){b&&(k(l),k(o),k(r),k(i),k(a),k(c),k(u),k(f)),_.d(b),Ee(y,b)}}}function _s(n){let e;return{c(){e=m("p"),e.textContent="can't start plugin: does not appear to be configured"},m(t,l){w(t,e,l)},p:A,d(t){t&&k(e)}}}function gs(n){let e;return{c(){e=m("p"),e.textContent="(no plugins installed)"},m(t,l){w(t,e,l)},p:A,d(t){t&&k(e)}}}function hs(n){let e,t,l=n[47].name+"",o,r,i;function a(){return n[35](n[47])}return{c(){e=m("button"),t=G("Start "),o=G(l),h(e,"class","mx-auto mb-1 w-auto select-none rounded-lg bg-emerald-500 p-2 font-bold text-black duration-200 hover:opacity-75")},m(c,u){w(c,e,u),v(e,t),v(e,o),r||(i=M(e,"click",a),r=!0)},p(c,u){n=c,u[0]&16&&l!==(l=n[47].name+"")&&ce(o,l)},d(c){c&&k(e),r=!1,i()}}}function Mt(n){let e,t=de(n[48].plugins),l=[];for(let o=0;o<t.length;o+=1)l[o]=jt(Ht(n,t,o));return{c(){for(let o=0;o<l.length;o+=1)l[o].c();e=Se()},m(o,r){for(let i=0;i<l.length;i+=1)l[i]&&l[i].m(o,r);w(o,e,r)},p(o,r){if(r[0]&524325){t=de(o[48].plugins);let i;for(i=0;i<t.length;i+=1){const a=Ht(o,t,i);l[i]?l[i].p(a,r):(l[i]=jt(a),l[i].c(),l[i].m(e.parentNode,e))}for(;i<l.length;i+=1)l[i].d(1);l.length=t.length}},d(o){o&&k(e),Ee(l,o)}}}function ms(n){let e,t=n[51].id+"",l;return{c(){e=m("p"),l=G(t)},m(o,r){w(o,e,r),v(e,l)},p(o,r){r[0]&32&&t!==(t=o[51].id+"")&&ce(l,t)},d(o){o&&k(e)}}}function bs(n){let e,t=(n[0].pluginConfig[n[51].id].name??n[51].id)+"",l,o,r,i,a,c;function u(){return n[36](n[51])}return{c(){e=m("p"),l=G(t),o=R(),r=m("button"),r.innerHTML='<img src="svgs/xmark-solid.svg" class="h-4 w-4" alt="Close"/>',i=R(),h(r,"class","select-none rounded-sm bg-rose-500 shadow-lg hover:opacity-75")},m(f,d){w(f,e,d),v(e,l),v(e,o),v(e,r),v(e,i),a||(c=M(r,"click",u),a=!0)},p(f,d){n=f,d[0]&33&&t!==(t=(n[0].pluginConfig[n[51].id].name??n[51].id)+"")&&ce(l,t)},d(f){f&&k(e),a=!1,c()}}}function jt(n){let e,t;function l(i,a){return a[0]&33&&(e=null),e==null&&(e=!!Object.keys(i[0].pluginConfig).includes(i[51].id)),e?bs:ms}let o=l(n,[-1,-1]),r=o(n);return{c(){r.c(),t=Se()},m(i,a){r.m(i,a),w(i,t,a)},p(i,a){o===(o=l(i,a))&&r?r.p(i,a):(r.d(1),r=o(i),r&&(r.c(),r.m(t.parentNode,t)))},d(i){i&&k(t),r.d(i)}}}function At(n){let e,t=n[48].uid===n[2]&&Mt(n);return{c(){t&&t.c(),e=Se()},m(l,o){t&&t.m(l,o),w(l,e,o)},p(l,o){l[48].uid===l[2]?t?t.p(l,o):(t=Mt(l),t.c(),t.m(e.parentNode,e)):t&&(t.d(1),t=null)},d(l){l&&k(e),t&&t.d(l)}}}function ks(n){let e;return{c(){e=m("p"),e.textContent="loading..."},m(t,l){w(t,e,l)},p:A,d(t){t&&k(e)}}}function Dt(n){let e,t,l,o,r,i,a,c,u,f,d,g;return{c(){e=m("label"),e.textContent="URL:",t=R(),l=m("textarea"),o=R(),r=m("button"),r.innerHTML='<img src="svgs/check-solid.svg" class="h-5 w-5" alt="Confirm"/>',i=R(),a=m("button"),a.innerHTML='<img src="svgs/xmark-solid.svg" class="h-5 w-5" alt="Close"/>',c=R(),u=m("br"),f=m("br"),h(e,"for","plugin-updater-url-input"),h(l,"rows","1"),h(l,"id","plugin-updater-url-input"),h(l,"class","w-[50%] max-w-[60%] resize-x rounded border-2 border-slate-300 bg-slate-100 text-slate-950 dark:border-slate-800"),h(r,"title","Confirm"),h(r,"class","select-none rounded-sm bg-emerald-500 hover:opacity-75"),h(a,"title","Close URL entry"),h(a,"class","select-none rounded-sm bg-rose-500 hover:opacity-75")},m(_,p){w(_,e,p),w(_,t,p),w(_,l,p),ue(l,n[13]),w(_,o,p),w(_,r,p),w(_,i,p),w(_,a,p),w(_,c,p),w(_,u,p),w(_,f,p),d||(g=[M(l,"input",n[28]),M(r,"click",n[29]),M(a,"click",n[30])],d=!0)},p(_,p){p[0]&8192&&ue(l,_[13])},d(_){_&&(k(e),k(t),k(l),k(o),k(r),k(i),k(a),k(c),k(u),k(f)),d=!1,Q(g)}}}function ws(n){let e;return{c(){e=m("p"),e.textContent=`You have no plugins installed. You can install plugins either from an updater URL, or by
						downloading them onto your computer and selecting the "bolt.json" file.`},m(t,l){w(t,e,l)},p:A,d(t){t&&k(e)}}}function ys(n){let e=Object.keys(n[0].pluginConfig).includes(n[1])&&n[4]!==null,t,l=e&&Bt(n);return{c(){l&&l.c(),t=Se()},m(o,r){l&&l.m(o,r),w(o,t,r)},p(o,r){r[0]&19&&(e=Object.keys(o[0].pluginConfig).includes(o[1])&&o[4]!==null),e?l?l.p(o,r):(l=Bt(o),l.c(),l.m(t.parentNode,t)):l&&(l.d(1),l=null)},d(o){o&&k(t),l&&l.d(o)}}}function Bt(n){let e,t,l,o,r,i,a,c,u,f,d,g,_={ctx:n,current:null,token:null,hasCatch:!0,pending:Ss,then:$s,catch:vs,value:47};st(e=n[4],_);let p=n[3].updaterURL&&Gt(n);return{c(){_.block.c(),t=R(),l=m("button"),l.textContent="Browse data",o=G(`
						 
						`),r=m("button"),r.textContent="Browse config",i=R(),a=m("br"),c=R(),p&&p.c(),u=R(),f=m("button"),f.textContent="Remove",h(l,"class","mx-auto mb-1 w-[min(144px,_25%)] select-none rounded-lg bg-blue-500 p-2 font-bold text-black duration-200 hover:opacity-75"),h(r,"class","mx-auto mb-1 w-[min(144px,_25%)] select-none rounded-lg bg-blue-500 p-2 font-bold text-black duration-200 hover:opacity-75"),h(f,"class","m-1 mx-auto w-[min(144px,_25%)] select-none rounded-lg p-2 font-bold text-black duration-200 enabled:bg-rose-500 enabled:hover:opacity-75 disabled:bg-gray-500")},m(y,b){_.block.m(y,_.anchor=b),_.mount=()=>t.parentNode,_.anchor=t,w(y,t,b),w(y,l,b),w(y,o,b),w(y,r,b),w(y,i,b),w(y,a,b),w(y,c,b),p&&p.m(y,b),w(y,u,b),w(y,f,b),d||(g=[M(l,"click",n[31]),M(r,"click",n[32]),M(f,"click",n[34])],d=!0)},p(y,b){n=y,_.ctx=n,b[0]&16&&e!==(e=n[4])&&st(e,_)||un(_,n,b),n[3].updaterURL?p?p.p(n,b):(p=Gt(n),p.c(),p.m(u.parentNode,u)):p&&(p.d(1),p=null)},d(y){y&&(k(t),k(l),k(o),k(r),k(i),k(a),k(c),k(u),k(f)),_.block.d(y),_.token=null,_=null,p&&p.d(y),d=!1,Q(g)}}}function vs(n){let e,t,l;return{c(){e=m("p"),e.textContent="error",t=R(),l=m("br")},m(o,r){w(o,e,r),w(o,t,r),w(o,l,r)},p:A,d(o){o&&(k(e),k(t),k(l))}}}function $s(n){let e,t=(n[47].name??Je)+"",l,o,r,i,a=(n[47].description??"no description")+"",c,u,f,d,g=n[47].version&&qt(n);return{c(){e=m("p"),l=G(t),o=R(),g&&g.c(),r=R(),i=m("p"),c=G(a),f=R(),d=m("br"),h(e,"class","pb-4 text-xl font-bold"),h(i,"class",u=n[47].description?null:"italic")},m(_,p){w(_,e,p),v(e,l),v(e,o),g&&g.m(e,null),w(_,r,p),w(_,i,p),v(i,c),w(_,f,p),w(_,d,p)},p(_,p){p[0]&16&&t!==(t=(_[47].name??Je)+"")&&ce(l,t),_[47].version?g?g.p(_,p):(g=qt(_),g.c(),g.m(e,null)):g&&(g.d(1),g=null),p[0]&16&&a!==(a=(_[47].description??"no description")+"")&&ce(c,a),p[0]&16&&u!==(u=_[47].description?null:"italic")&&h(i,"class",u)},d(_){_&&(k(e),k(r),k(i),k(f),k(d)),g&&g.d()}}}function qt(n){let e,t,l,o,r=n[47].version+"",i;return{c(){e=m("br"),t=R(),l=m("span"),o=G("v"),i=G(r),h(l,"class","pb-4 text-xl font-bold italic text-slate-600")},m(a,c){w(a,e,c),w(a,t,c),w(a,l,c),v(l,o),v(l,i)},p(a,c){c[0]&16&&r!==(r=a[47].version+"")&&ce(i,r)},d(a){a&&(k(e),k(t),k(l))}}}function Ss(n){let e;return{c(){e=m("p"),e.textContent="loading..."},m(t,l){w(t,e,l)},p:A,d(t){t&&k(e)}}}function Gt(n){let e,t,l,o;return{c(){e=m("button"),e.textContent="Check updates",t=G(`
							 `),h(e,"class","m-1 mx-auto w-[min(144px,_25%)] select-none rounded-lg p-2 font-bold text-black duration-200 enabled:bg-blue-500 enabled:hover:opacity-75 disabled:bg-gray-500")},m(r,i){w(r,e,i),w(r,t,i),l||(o=M(e,"click",n[33]),l=!0)},p:A,d(r){r&&(k(e),k(t)),l=!1,o()}}}function Ft(n){let e,t,l,o;function r(c,u){return c[9]?Ls:Cs}let i=r(n),a=i(n);return{c(){e=m("br"),t=m("br"),l=R(),a.c(),o=Se()},m(c,u){w(c,e,u),w(c,t,u),w(c,l,u),a.m(c,u),w(c,o,u)},p(c,u){i===(i=r(c))&&a?a.p(c,u):(a.d(1),a=i(c),a&&(a.c(),a.m(o.parentNode,o)))},d(c){c&&(k(e),k(t),k(l),k(o)),a.d(c)}}}function Cs(n){let e,t,l;return{c(){e=m("p"),t=G("[info] "),l=G(n[8])},m(o,r){w(o,e,r),v(e,t),v(e,l)},p(o,r){r[0]&256&&ce(l,o[8])},d(o){o&&k(e)}}}function Ls(n){let e,t,l;return{c(){e=m("p"),t=G("[error] "),l=G(n[8]),h(e,"class","text-red-500")},m(o,r){w(o,e,r),v(e,t),v(e,l)},p(o,r){r[0]&256&&ce(l,o[8])},d(o){o&&k(e)}}}function Rs(n){let e,t,l,o,r,i,a,c,u,f,d,g,_,p,y;function b($,S){return $[5].length==0?is:rs}let L=b(n),C=L(n);function B($,S){return $[0].hasBoltPlugins?cs:as}let N=B(n),I=N(n),T=n[8]&&Ft(n);return{c(){e=m("div"),t=m("button"),l=G("Manage Plugins"),r=R(),i=m("hr"),a=R(),C.c(),c=R(),u=m("div"),I.c(),f=R(),T&&T.c(),d=R(),g=m("div"),_=m("button"),_.textContent="about plugins",h(t,"class",o="mx-auto mb-2 w-[95%] select-none rounded-lg border-2 "+(n[11]?"border-blue-500 text-black dark:text-white":"border-black bg-blue-500 text-black")+" p-2 font-bold hover:opacity-75"),h(i,"class","p-1 dark:border-slate-700"),h(e,"class","left-0 float-left h-full w-[min(180px,_50%)] overflow-hidden border-r-2 border-slate-300 pt-2 dark:border-slate-800"),h(u,"class","h-full pt-10"),h(_,"class","m-0 cursor-pointer select-none border-none bg-transparent p-0 text-sm text-gray-500 underline"),h(g,"class","absolute bottom-2 right-4")},m($,S){w($,e,S),v(e,t),v(t,l),v(e,r),v(e,i),v(e,a),C.m(e,null),w($,c,S),w($,u,S),I.m(u,null),v(u,f),T&&T.m(u,null),w($,d,S),w($,g,S),v(g,_),p||(y=[M(t,"click",n[23]),M(_,"click",n[21])],p=!0)},p($,S){S[0]&2048&&o!==(o="mx-auto mb-2 w-[95%] select-none rounded-lg border-2 "+($[11]?"border-blue-500 text-black dark:text-white":"border-black bg-blue-500 text-black")+" p-2 font-bold hover:opacity-75")&&h(t,"class",o),L===(L=b($))&&C?C.p($,S):(C.d(1),C=L($),C&&(C.c(),C.m(e,null))),N===(N=B($))&&I?I.p($,S):(I.d(1),I=N($),I&&(I.c(),I.m(u,f))),$[8]?T?T.p($,S):(T=Ft($),T.c(),T.m(u,null)):T&&(T.d(1),T=null)},d($){$&&(k(e),k(c),k(u),k(d),k(g)),C.d(),I.d(),T&&T.d(),p=!1,Q(y)}}}function Ps(n){let e,t,l={class:"h-[90%] w-[90%] text-center",$$slots:{default:[Rs]},$$scope:{ctx:n}};return e=new ut({props:l}),n[37](e),e.$on("close",n[38]),{c(){re(e.$$.fragment)},m(o,r){ee(e,o,r),t=!0},p(o,r){const i={};r[0]&32639|r[1]&268435456&&(i.$$scope={dirty:r,ctx:o}),e.$set(i)},i(o){t||(q(e.$$.fragment,o),t=!0)},o(o){J(e.$$.fragment,o),t=!1},d(o){n[37](null),te(e,o)}}}const Me="bolt.json",Ts="main.lua",Je="(unnamed)",Jt="(new character)";function Us(n,e,t){let l,o,r,i;he(n,vt,U=>t(5,i=U));let a,c=null,u=!1;const f=P.platform==="windows"?"\\":"/",d=f.concat(Me);function g(){t(12,X=!1),a.open()}const _=U=>{console.log(U),t(8,c=U),t(9,u=!1)},p=U=>{console.error(U),t(8,c=U),t(9,u=!0)},y=U=>new Promise((D,W)=>{const ge=U.concat(U.endsWith(f)?Me:d);var z=new XMLHttpRequest;z.onreadystatechange=()=>{z.readyState==4&&(z.status==200?D(JSON.parse(z.responseText)):W(z.responseText))},z.open("GET","/read-json-file?".concat(new URLSearchParams({path:ge}).toString()),!0),z.send()}),b=U=>fetch("/get-plugindir-json?".concat(new URLSearchParams({id:U}).toString())).then(D=>D.ok?D.json():null),L=U=>{const W=P.pluginConfig[U];if(!W)return null;const ge=W.path;return ge?y(ge):b(U)},C=()=>{const U=Object.keys(P.pluginConfig);let D;do D=crypto.randomUUID();while(U.includes(D));return D},B=(U,D)=>{y(U).then(W=>{t(1,H=C()),t(0,P.pluginConfig[H]={name:W.name??Je,path:U,version:W.version},P),t(6,x.pluginConfigHasPendingChanges=!0,x)}).catch(W=>p(`config file '${D}' couldn't be fetched, reason: ${W}`))},N=U=>{_("downloading..."),fetch(U).then(async D=>{if(!D.ok){p(`can't install plugin: updater URL returned ${D.status}: ${D.statusText}`);return}const W=await D.json();if(W.url){const ge=await fetch(W.url);if(!ge.ok){p(`can't install plugin: remote download URL returned ${D.status}: ${D.statusText}`);return}const z=await ge.arrayBuffer();if(W.sha256){const Pe=await crypto.subtle.digest("SHA-256",z),ft=Array.from(new Uint8Array(Pe)).map(dt=>dt.toString(16).padStart(2,"0")).join("");if(W.sha256!==ft){p("can't install plugin: incorrect file hash");return}}const be=C();if(!(await fetch("/install-plugin?".concat(new URLSearchParams({id:be}).toString()),{method:"POST",body:z})).ok){p(`can't install plugin: ${D.statusText}`);return}const He=await b(be);He?(t(1,H=be),t(0,P.pluginConfig[H]={name:He.name??Je,version:He.version,updaterURL:U,sha256:W.sha256},P),t(6,x.pluginConfigHasPendingChanges=!0,x),_(`plugin '${He.name}' installed`)):p(`can't install plugin: ${Me} not found`)}}).catch(()=>{p("can't install plugin: unhandled exception")})};let I=!1;const T=()=>{t(10,I=!0);var U=new XMLHttpRequest;U.onreadystatechange=()=>{if(U.readyState==4&&(t(10,I=!1),U.status==200))if(U.responseText.endsWith(d)){const D=U.responseText.substring(0,U.responseText.length-Me.length);B(D,U.responseText)}else p(`selection '${U.responseText}' is not named ${Me}; ignored`)},U.open("GET","/json-file-picker",!0),U.send()};bt();const $=(U,D,W,ge)=>{let z=null;if(W){const Ce=P.platform==="windows"?W.replaceAll("\\","/"):W;z=Ce.endsWith(f)?Ce:Ce.concat("/")}var be=new XMLHttpRequest;be.onreadystatechange=()=>{be.readyState==4&&(bt(),E.info(`Start-plugin status: ${be.statusText.trim()}`))},z?be.open("GET","/start-plugin?".concat(new URLSearchParams({client:U.toString(),id:D,main:ge,path:z}).toString()),!0):be.open("GET","/start-plugin?".concat(new URLSearchParams({client:U.toString(),id:D,main:ge}).toString()),!0),be.send()},S=(U,D)=>{var W=new XMLHttpRequest;W.onreadystatechange=()=>{W.readyState==4&&(bt(),E.info(`Stop-plugin status: ${W.statusText.trim()}`))},W.open("GET","/stop-plugin?".concat(new URLSearchParams({client:U.toString(),uid:D.toString()}).toString()),!0),W.send()},O=(U,D)=>{const W=U.updaterURL;fetch(W).then(async ge=>{if(!ge.ok){p(`can't update plugin: updater URL returned ${ge.status}: ${ge.statusText}`);return}let z=await ge.json();if(!z.url){_(`can't update plugin '${U.name}': no remote download URL is configured`);return}let be=!1;if(z.sha256?U.sha256!==z.sha256&&(be=!0):z.version&&U.version!==z.version&&(be=!0),be){const Ce=await fetch(z.url);if(!Ce.ok){p(`can't update plugin: remote download URL returned ${Ce.status}: ${Ce.statusText}`);return}const He=await Ce.arrayBuffer();if(z.sha256){const ft=await crypto.subtle.digest("SHA-256",He),dt=Array.from(new Uint8Array(ft)).map(vn=>vn.toString(16).padStart(2,"0")).join("");if(z.sha256!==dt){p(`can't update plugin '${U.name}': incorrect file hash`);return}}fetch("/install-plugin?".concat(new URLSearchParams({id:D}).toString()),{method:"POST",body:He});const Pe=await b(D);Pe?(z.sha256&&(U.sha256=z.sha256),Pe.name&&(U.name=Pe.name),Pe.version&&(U.version=Pe.version),t(6,x.pluginConfigHasPendingChanges=!0,x),_(`plugin '${Pe.name}' updated`)):p(`can't update plugin '${U.name}': ${Me} not found`)}else _(`plugin '${U.name}' is already up-to-date`)})};var H;const F=()=>fetch("/open-external-url",{method:"POST",body:"https://bolt.adamcake.com/plugins"});var ne=!1,Y;let X=!1,Z;const ie=()=>t(11,ne=!1),ae=U=>{t(2,Y=U.uid),t(11,ne=!0),t(12,X=!1),t(13,Z=""),t(8,c=null)};function j(){H=$t(this),t(1,H),t(0,P)}const se=()=>t(8,c=null),Re=()=>{t(12,X=!X),t(13,Z="")};function me(){Z=this.value,t(13,Z)}const Ke=()=>{N(Z),t(12,X=!1),t(13,Z="")},pn=()=>{t(12,X=!1),t(13,Z="")},_n=()=>{const U=P.pluginConfig[H].path;fetch(U?"/browse-directory?".concat(new URLSearchParams({path:U}).toString()):"/browse-plugin-data?".concat(new URLSearchParams({id:H}).toString()))},gn=()=>fetch("/browse-plugin-config?".concat(new URLSearchParams({id:H}).toString())),hn=()=>O(l,H),mn=()=>{t(4,r=null),t(6,x.pluginConfigHasPendingChanges=!0,x);let U=P.pluginConfig;const D=U[H];D&&(fetch("/uninstall-plugin?".concat(new URLSearchParams({id:H,delete_data_dir:typeof D.path=="string"?"0":"1"}).toString())),_(`plugin '${D.name}' uninstalled`),delete U[H],t(0,P.pluginConfig=U,P))},bn=U=>$(Y,H,o??null,U.main??Ts),kn=U=>{S(Y,U.uid)};function wn(U){ve[U?"unshift":"push"](()=>{a=U,t(7,a)})}const yn=()=>V.savePluginConfig(!0);return n.$$.update=()=>{n.$$.dirty[0]&36&&(i.some(U=>U.uid===Y)||t(11,ne=!1)),n.$$.dirty[0]&3&&t(3,l=P.pluginConfig[H]),n.$$.dirty[0]&2&&t(4,r=L(H)),n.$$.dirty[0]&24&&r&&r.then(U=>{let D=!1;U.name!==l.name&&(t(3,l.name=U.name,l),D=!0),U.version!==l.version&&(t(3,l.version=U.version,l),D=!0),D&&(t(3,l),t(0,P),t(1,H),t(4,r),t(6,x.pluginConfigHasPendingChanges=!0,x))}),n.$$.dirty[0]&8&&t(14,o=l?l.path:null)},[P,H,Y,l,r,i,x,a,c,u,I,ne,X,Z,o,_,N,T,$,S,O,F,g,ie,ae,j,se,Re,me,Ke,pn,_n,gn,hn,mn,bn,kn,wn,yn]}class Is extends _e{constructor(e){super(),pe(this,e,Us,Ps,fe,{open:22},null,[-1,-1])}get open(){return this.$$.ctx[22]}}function Hs(n){let e,t,l,o,r,i,a,c,u,f,d,g,_;return{c(){e=m("div"),t=m("h2"),t.textContent="Game is offline",l=R(),o=m("br"),r=R(),i=m("p"),i.textContent="This game appears to be offline for maintenance or an update. Launch anyway?",a=R(),c=m("div"),u=m("button"),u.textContent="No",f=R(),d=m("button"),d.textContent="Yes",h(t,"class","text-3xl font-extrabold"),h(u,"class","mx-1 mb-2 mt-5 w-[45%] rounded-lg bg-blue-500 p-2 font-bold text-black duration-200 hover:opacity-75"),h(d,"class","mx-1 mb-2 mt-5 w-[45%] rounded-lg bg-emerald-500 p-2 font-bold text-black duration-200 hover:opacity-75"),h(c,"class","align-bottom")},m(p,y){w(p,e,y),v(e,t),v(e,l),v(e,o),v(e,r),v(e,i),v(e,a),v(e,c),v(c,u),v(c,f),v(c,d),g||(_=[M(u,"click",n[5]),M(d,"click",n[6])],g=!0)},p:A,d(p){p&&k(e),g=!1,Q(_)}}}function Os(n){let e,t,l={class:"h-fit w-3/5 px-5 py-3 text-center",$$slots:{default:[Hs]},$$scope:{ctx:n}};return e=new ut({props:l}),n[7](e),{c(){re(e.$$.fragment)},m(o,r){ee(e,o,r),t=!0},p(o,[r]){const i={};r&271&&(i.$$scope={dirty:r,ctx:o}),e.$set(i)},i(o){t||(q(e.$$.fragment,o),t=!0)},o(o){J(e.$$.fragment,o),t=!1},d(o){n[7](null),te(e,o)}}}function Es(n,e,t){let l,o,r,i;function a(d,g,_){t(3,i=d),t(1,o=g),t(2,r=_),l.open()}const c=()=>{l.close()},u=()=>{i(o,r),l.close()};function f(d){ve[d?"unshift":"push"](()=>{l=d,t(0,l)})}return[l,o,r,i,a,c,u,f]}class Ns extends _e{constructor(e){super(),pe(this,e,Es,Os,fe,{open:4})}get open(){return this.$$.ctx[4]}}function Wt(n,e,t){const l=n.slice();return l[20]=e[t],l}function Xt(n,e,t){const l=n.slice();return l[23]=e[t],l}function xs(n){let e,t,l={};return e=new Is({props:l}),n[16](e),{c(){re(e.$$.fragment)},m(o,r){ee(e,o,r),t=!0},p(o,r){const i={};e.$set(i)},i(o){t||(q(e.$$.fragment,o),t=!0)},o(o){J(e.$$.fragment,o),t=!1},d(o){n[16](null),te(e,o)}}}function zt(n){let e,t;return{c(){e=m("div"),t=G(n[7]),h(e,"class","absolute left-[2%] w-[96%] rounded-lg bg-blue-400 px-2 text-black")},m(l,o){w(l,e,o),v(e,t)},p(l,o){o&128&&ce(t,l[7])},d(l){l&&k(e)}}}function Ms(n){let e,t,l;return{c(){e=m("button"),e.textContent="Plugin menu",e.disabled=!P.hasBoltPlugins,h(e,"title",P.hasBoltPlugins?null:"This feature is disabled"),h(e,"class","w-52 rounded-lg p-2 font-bold text-black duration-200 enabled:bg-blue-500 enabled:hover:opacity-75 disabled:bg-gray-500")},m(o,r){w(o,e,r),t||(l=M(e,"click",n[19]),t=!0)},p:A,d(o){o&&k(e),t=!1,l()}}}function js(n){let e,t,l,o,r,i,a=de(Ct[n[1].selected.game]),c=[];for(let u=0;u<a.length;u+=1)c[u]=Vt(Xt(n,a,u));return{c(){e=m("label"),t=m("span"),t.textContent="Game Client",l=R(),o=m("select");for(let u=0;u<c.length;u+=1)c[u].c();h(t,"class","text-sm"),h(o,"id","game_client_select"),h(o,"class","w-52 cursor-pointer rounded-lg border-2 border-slate-300 bg-inherit p-2 text-inherit duration-200 hover:opacity-75 dark:border-slate-800"),n[1].selected.client===void 0&&Fe(()=>n[18].call(o)),h(e,"class","flex flex-col")},m(u,f){w(u,e,f),v(e,t),v(e,l),v(e,o);for(let d=0;d<c.length;d+=1)c[d]&&c[d].m(o,null);Ie(o,n[1].selected.client,!0),r||(i=M(o,"change",n[18]),r=!0)},p(u,f){if(f&2){a=de(Ct[u[1].selected.game]);let d;for(d=0;d<a.length;d+=1){const g=Xt(u,a,d);c[d]?c[d].p(g,f):(c[d]=Vt(g),c[d].c(),c[d].m(o,null))}for(;d<c.length;d+=1)c[d].d(1);c.length=a.length}f&2&&Ie(o,u[1].selected.client)},d(u){u&&k(e),Ee(c,u),r=!1,i()}}}function Vt(n){let e,t=n[23]+"",l,o,r;return{c(){e=m("option"),l=G(t),h(e,"class","dark:bg-slate-900"),e.disabled=o=n[23]===Te.official&&P.platform==ze.Linux,e.__value=r=n[23],ue(e,e.__value)},m(i,a){w(i,e,a),v(e,l)},p(i,a){a&2&&t!==(t=i[23]+"")&&ce(l,t),a&2&&o!==(o=i[23]===Te.official&&P.platform==ze.Linux)&&(e.disabled=o),a&2&&r!==(r=i[23])&&(e.__value=r,ue(e,e.__value))},d(i){i&&k(e)}}}function Yt(n){let e;return{c(){e=m("option"),e.textContent="No characters",h(e,"class","dark:bg-slate-900"),e.disabled=!0,e.selected=!0,e.__value="No characters",ue(e,e.__value)},m(t,l){w(t,e,l)},p:A,d(t){t&&k(e)}}}function As(n){let e;return{c(){e=G("New Character")},m(t,l){w(t,e,l)},p:A,d(t){t&&k(e)}}}function Ds(n){let e=n[20].displayName+"",t;return{c(){t=G(e)},m(l,o){w(l,t,o)},p(l,o){o&32&&e!==(e=l[20].displayName+"")&&ce(t,e)},d(l){l&&k(t)}}}function Zt(n){let e,t,l;function o(a,c){return a[20].displayName?Ds:As}let r=o(n),i=r(n);return{c(){e=m("option"),i.c(),t=R(),e.__value=l=n[20].accountId,ue(e,e.__value),h(e,"class","dark:bg-slate-900")},m(a,c){w(a,e,c),i.m(e,null),v(e,t)},p(a,c){r===(r=o(a))&&i?i.p(a,c):(i.d(1),i=r(a),i&&(i.c(),i.m(e,t))),c&32&&l!==(l=a[20].accountId)&&(e.__value=l,ue(e,e.__value))},d(a){a&&k(e),i.d()}}}function Bs(n){let e,t,l,o,r,i,a,c,u,f,d,g,_,p,y,b,L,C,B,N,I,T,$,S,O={};e=new Ns({props:O}),n[15](e);let H=P.hasBoltPlugins&&xs(n),F=n[7]&&zt(n);function ne(j,se){if(j[1].selected.game==le.osrs)return js;if(j[1].selected.game===le.rs3)return Ms}let Y=ne(n),X=Y&&Y(n),Z=de(n[5]),ie=[];for(let j=0;j<Z.length;j+=1)ie[j]=Zt(Wt(n,Z,j));let ae=null;return Z.length||(ae=Yt()),{c(){re(e.$$.fragment),t=R(),H&&H.c(),l=R(),o=m("div"),F&&F.c(),r=R(),i=m("div"),a=m("img"),u=R(),f=m("button"),d=G("Play"),_=R(),X&&X.c(),p=R(),y=m("label"),b=m("span"),b.textContent="Character",L=R(),C=m("select"),B=m("option"),N=G("Select an account");for(let j=0;j<ie.length;j+=1)ie[j].c();ae&&ae.c(),wt(a.src,c="svgs/rocket-solid.svg")||h(a,"src",c),h(a,"alt","Launch icon"),h(a,"class","mb-3 w-24 rounded-3xl bg-gradient-to-br from-rose-500 to-violet-500 p-5"),h(f,"class","w-52 rounded-lg bg-emerald-500 p-2 font-bold text-black duration-200 enabled:hover:opacity-75 disabled:bg-gray-500"),f.disabled=g=!n[8],h(b,"class","text-sm"),B.__value=void 0,ue(B,B.__value),B.disabled=!0,h(B,"class","dark:bg-slate-900"),h(C,"id","character_select"),h(C,"class","mx-auto w-52 cursor-pointer rounded-lg border-2 border-slate-300 bg-inherit p-2 text-inherit duration-200 hover:opacity-75 dark:border-slate-800"),C.disabled=I=!n[8]||n[1].selected.user_id===null,h(y,"class","flex flex-col"),h(i,"class","flex flex-col items-center gap-4"),h(o,"class","bg-grad flex h-full flex-col border-slate-300 p-5 duration-200 dark:border-slate-800")},m(j,se){ee(e,j,se),w(j,t,se),H&&H.m(j,se),w(j,l,se),w(j,o,se),F&&F.m(o,null),v(o,r),v(o,i),v(i,a),v(i,u),v(i,f),v(f,d),v(i,_),X&&X.m(i,null),v(i,p),v(i,y),v(y,b),v(y,L),v(y,C),v(C,B),v(B,N);for(let Re=0;Re<ie.length;Re+=1)ie[Re]&&ie[Re].m(C,null);ae&&ae.m(C,null),Ie(C,n[4]),T=!0,$||(S=[M(f,"click",n[17]),M(C,"change",n[13])],$=!0)},p(j,[se]){const Re={};if(e.$set(Re),P.hasBoltPlugins&&H.p(j,se),j[7]?F?F.p(j,se):(F=zt(j),F.c(),F.m(o,r)):F&&(F.d(1),F=null),(!T||se&256&&g!==(g=!j[8]))&&(f.disabled=g),Y===(Y=ne(j))&&X?X.p(j,se):(X&&X.d(1),X=Y&&Y(j),X&&(X.c(),X.m(i,p))),se&32){Z=de(j[5]);let me;for(me=0;me<Z.length;me+=1){const Ke=Wt(j,Z,me);ie[me]?ie[me].p(Ke,se):(ie[me]=Zt(Ke),ie[me].c(),ie[me].m(C,null))}for(;me<ie.length;me+=1)ie[me].d(1);ie.length=Z.length,!Z.length&&ae?ae.p(j,se):Z.length?ae&&(ae.d(1),ae=null):(ae=Yt(),ae.c(),ae.m(C,null))}(!T||se&258&&I!==(I=!j[8]||j[1].selected.user_id===null))&&(C.disabled=I),(!T||se&48)&&Ie(C,j[4])},i(j){T||(q(e.$$.fragment,j),q(H),T=!0)},o(j){J(e.$$.fragment,j),J(H),T=!1},d(j){j&&(k(t),k(l),k(o)),n[15](null),te(e,j),H&&H.d(j),F&&F.d(),X&&X.d(),Ee(ie,j),ae&&ae.d(),$=!1,Q(S)}}}function qs(n,e,t){let l,o,r,i,a,c,u,f,d,{config:g,initialized:_}=x;he(n,g,$=>t(1,i=$)),he(n,_,$=>t(8,u=$));let p=Ue(null);he(n,p,$=>t(7,c=$));let y=Ue(!0);he(n,y,$=>t(6,a=$));function b($,S){if(!l)return E.warn("Please log in or select a user to play.");if(!o)return E.warn("Please select a character from the select menu.");const O=V.findSession(i.selected.user_id);if(!O)return E.warn("Unable to launch game, session was not found.");const{session_id:H}=O,F=V.findAccount(O.accounts,o);if(!F)return E.warn("Unable to launch game, account was not found.");const{accountId:ne,displayName:Y}=F,X=P.platform===ze.Windows,Z=P.platform===ze.Linux;switch($){case le.osrs:switch(S){case Te.official:Ut(X,!0,H,ne,Y);break;case Te.runelite:dn(H,ne,Y,!1);break;case Te.hdos:os(H,ne,Y);break}break;case le.rs3:Z?ls(H,ne,Y):Ut(X,!1,H,ne,Y);break}}function L($){const S=$.target.value;if(!l)return;const O=i.userDetails[l];O?(O.account_id=S,$e(g,i.userDetails[l]=O,i)):$e(g,i.userDetails[l]={account_id:S},i)}function C($){ve[$?"unshift":"push"](()=>{f=$,t(2,f)})}function B($){ve[$?"unshift":"push"](()=>{d=$,t(3,d)})}const N=()=>{a?b(i.selected.game,i.selected.client):f.open(b,i.selected.game,i.selected.client)};function I(){i.selected.client=$t(this),g.set(i)}const T=()=>{d.open()};return n.$$.update=()=>{var $,S;if(n.$$.dirty&2&&t(14,l=i.selected.user_id),n.$$.dirty&16386&&t(4,o=($=i.userDetails[l??""])==null?void 0:$.account_id),n.$$.dirty&2&&t(5,r=((S=V.findSession(i.selected.user_id))==null?void 0:S.accounts)??[]),n.$$.dirty&2)if(i.check_announcements){const O=`${P.env.psa_url}${i.selected.game==le.osrs?"osrs":P.env.provider}.json`;fetch(O,{method:"GET"}).then(H=>H.json()).then(H=>{$e(p,c=H.psa&&H.psa.length>0?H.psa:null,c),$e(y,a=!(H.isDisabled??!1),a)})}else $e(p,c=null,c),$e(y,a=!0,a)},[b,i,f,d,o,r,a,c,u,g,_,p,y,L,l,C,B,N,I,T]}class Gs extends _e{constructor(e){super(),pe(this,e,qs,Bs,fe,{launch:0})}get launch(){return this.$$.ctx[0]}}function Kt(n,e,t){const l=n.slice();return l[1]=e[t].date,l[2]=e[t].severity,l[3]=e[t].content,l}function Qt(n){var c;let e,t=((c=n[1])==null?void 0:c.toLocaleTimeString())+"",l,o,r=n[3]+"",i,a;return{c(){e=m("li"),l=G(t),o=G(`
				- `),i=G(r),a=R(),oe(e,"text-rose-500",n[2]===Xe.error),oe(e,"text-orange-700",n[2]===Xe.warn)},m(u,f){w(u,e,f),v(e,l),v(e,o),v(e,i),v(e,a)},p(u,f){var d;f&1&&t!==(t=((d=u[1])==null?void 0:d.toLocaleTimeString())+"")&&ce(l,t),f&1&&r!==(r=u[3]+"")&&ce(i,r),f&1&&oe(e,"text-rose-500",u[2]===Xe.error),f&1&&oe(e,"text-orange-700",u[2]===Xe.warn)},d(u){u&&k(e)}}}function Fs(n){let e,t,l,o,r=de(n[0]),i=[];for(let a=0;a<r.length;a+=1)i[a]=Qt(Kt(n,r,a));return{c(){e=m("div"),t=m("div"),t.innerHTML='<img src="svgs/circle-info-solid.svg" alt="Message list icon" class="h-7 w-7 rounded-full bg-blue-500 p-[3px] duration-200"/>',l=R(),o=m("ol");for(let a=0;a<i.length;a+=1)i[a].c();h(t,"class","absolute right-6 top-2"),h(o,"id","message_list"),h(o,"class","h-full list-inside list-disc overflow-y-auto pl-5 pt-1 marker:text-blue-500"),h(e,"class","fixed bottom-0 h-1/4 w-screen border-t-2 border-t-slate-300 bg-slate-100 duration-200 dark:border-t-slate-800 dark:bg-slate-900")},m(a,c){w(a,e,c),v(e,t),v(e,l),v(e,o);for(let u=0;u<i.length;u+=1)i[u]&&i[u].m(o,null)},p(a,[c]){if(c&1){r=de(a[0]);let u;for(u=0;u<r.length;u+=1){const f=Kt(a,r,u);i[u]?i[u].p(f,c):(i[u]=Qt(f),i[u].c(),i[u].m(o,null))}for(;u<i.length;u+=1)i[u].d(1);i.length=r.length}},i:A,o:A,d(a){a&&k(e),Ee(i,a)}}}function Js(n,e,t){let{logs:l}=e;return n.$$set=o=>{"logs"in o&&t(0,l=o.logs)},[l]}class Ws extends _e{constructor(e){super(),pe(this,e,Js,Fs,fe,{logs:0})}}function en(n,e,t){const l=n.slice();return l[7]=e[t],l}function tn(n,e){let t,l=e[7].user.displayName+"",o,r;return{key:n,first:null,c(){t=m("option"),o=G(l),t.__value=r=e[7].user.userId,ue(t,t.__value),h(t,"class","dark:bg-slate-900"),this.first=t},m(i,a){w(i,t,a),v(t,o)},p(i,a){e=i,a&2&&l!==(l=e[7].user.displayName+"")&&ce(o,l),a&2&&r!==(r=e[7].user.userId)&&(t.__value=r,ue(t,t.__value))},d(i){i&&k(t)}}}function Xs(n){let e,t,l=[],o=new Map,r,i,a,c,u,f,d,g,_,p=de(n[1]);const y=b=>b[7].user.userId;for(let b=0;b<p.length;b+=1){let L=en(n,p,b),C=y(L);o.set(C,l[b]=tn(C,L))}return{c(){e=m("select"),t=m("option"),t.textContent="Select a user";for(let b=0;b<l.length;b+=1)l[b].c();r=R(),i=m("div"),a=m("button"),a.textContent="Log In",c=R(),u=m("button"),f=G("Log Out"),t.__value=null,ue(t,t.__value),t.disabled=!0,h(t,"class","dark:bg-slate-900"),h(e,"class","w-full cursor-pointer rounded-lg border-2 border-inherit bg-inherit p-2 text-center"),n[0].selected.user_id===void 0&&Fe(()=>n[4].call(e)),h(a,"class","mx-auto mr-2 rounded-lg bg-blue-500 p-2 font-bold text-black duration-200 hover:opacity-75"),h(u,"class","mx-auto rounded-lg border-2 border-blue-500 p-2 font-bold duration-200 hover:opacity-75"),u.disabled=d=!n[0].selected.user_id,h(i,"class","mt-5 flex")},m(b,L){w(b,e,L),v(e,t);for(let C=0;C<l.length;C+=1)l[C]&&l[C].m(e,null);Ie(e,n[0].selected.user_id,!0),w(b,r,L),w(b,i,L),v(i,a),v(i,c),v(i,u),v(u,f),g||(_=[M(e,"change",n[4]),M(a,"click",n[5]),M(u,"click",n[6])],g=!0)},p(b,[L]){L&2&&(p=de(b[1]),l=An(l,L,y,1,b,p,o,e,jn,tn,null,en)),L&3&&Ie(e,b[0].selected.user_id),L&3&&d!==(d=!b[0].selected.user_id)&&(u.disabled=d)},i:A,o:A,d(b){b&&(k(e),k(r),k(i));for(let L=0;L<l.length;L+=1)l[L].d();g=!1,Q(_)}}}function zs(n,e,t){let l,o;const{sessions:r,config:i}=x;he(n,r,f=>t(1,o=f)),he(n,i,f=>t(0,l=f));function a(){l.selected.user_id=$t(this),i.set(l)}return[l,o,r,i,a,()=>{const{origin:f,redirect:d,clientid:g}=P.env;we.openLoginWindow(f,d,g)},async()=>{l.selected.user_id&&(await V.logout(l.selected.user_id),V.saveCredentials())}]}class Vs extends _e{constructor(e){super(),pe(this,e,zs,Xs,fe,{})}}function Ys(n,{callback:e,ignore:t=[]}){const l=o=>{const r=t.some(i=>i.contains(o.target));n&&!n.contains(o.target)&&!o.defaultPrevented&&!r&&e()};return document.addEventListener("click",l,!0),document.addEventListener("contextmenu",l,!0),{destroy(){document.removeEventListener("click",l,!0),document.removeEventListener("contextmenu",l,!0)}}}const Zs=n=>({}),nn=n=>({});function sn(n){let e,t,l,o,r,i;const a=n[9].content,c=ot(a,n,n[8],nn);return{c(){e=m("div"),c&&c.c(),h(e,"class",t="dropdown-color absolute z-20 rounded-lg border-2 "+n[1]+" "+n[2]+" svelte-xifudk")},m(u,f){w(u,e,f),c&&c.m(e,null),o=!0,r||(i=Pn(l=Ys.call(null,e,{callback:n[3],ignore:[n[5]]})),r=!0)},p(u,f){c&&c.p&&(!o||f&256)&&it(c,a,u,u[8],o?rt(a,u[8],f,Zs):at(u[8]),nn),(!o||f&6&&t!==(t="dropdown-color absolute z-20 rounded-lg border-2 "+u[1]+" "+u[2]+" svelte-xifudk"))&&h(e,"class",t),l&&lt(l.update)&&f&32&&l.update.call(null,{callback:u[3],ignore:[u[5]]})},i(u){o||(q(c,u),o=!0)},o(u){J(c,u),o=!1},d(u){u&&k(e),c&&c.d(u),r=!1,i()}}}function Ks(n){let e,t,l,o,r,i,a;const c=n[9].default,u=ot(c,n,n[8],null);let f=n[4]&&sn(n);return{c(){e=m("div"),t=m("button"),u&&u.c(),l=R(),f&&f.c(),h(e,"class",o="relative h-fit w-fit "+n[0]+" svelte-xifudk")},m(d,g){w(d,e,g),v(e,t),u&&u.m(t,null),n[10](t),v(e,l),f&&f.m(e,null),r=!0,i||(a=M(t,"click",n[6]),i=!0)},p(d,[g]){u&&u.p&&(!r||g&256)&&it(u,c,d,d[8],r?rt(c,d[8],g,null):at(d[8]),null),d[4]?f?(f.p(d,g),g&16&&q(f,1)):(f=sn(d),f.c(),q(f,1),f.m(e,null)):f&&(Ye(),J(f,1,1,()=>{f=null}),Ze()),(!r||g&1&&o!==(o="relative h-fit w-fit "+d[0]+" svelte-xifudk"))&&h(e,"class",o)},i(d){r||(q(u,d),q(f),r=!0)},o(d){J(u,d),J(f),r=!1},d(d){d&&k(e),u&&u.d(d),n[10](null),f&&f.d(),i=!1,a()}}}function Qs(n,e,t){let{$$slots:l={},$$scope:o}=e,{class:r=""}=e,{position:i="bottom"}=e,{align:a="start"}=e,c=!1,u;function f(){t(4,c=!0)}function d(){t(4,c=!1)}function g(){c?d():f()}function _(p){ve[p?"unshift":"push"](()=>{u=p,t(5,u)})}return n.$$set=p=>{"class"in p&&t(0,r=p.class),"position"in p&&t(1,i=p.position),"align"in p&&t(2,a=p.align),"$$scope"in p&&t(8,o=p.$$scope)},[r,i,a,d,c,u,g,f,o,l,_]}class el extends _e{constructor(e){super(),pe(this,e,Qs,Ks,fe,{class:0,position:1,align:2,open:7,close:3})}get open(){return this.$$.ctx[7]}get close(){return this.$$.ctx[3]}}function tl(n){let e,t,l,o,r,i,a,c,u,f,d,g,_;return{c(){e=m("button"),e.innerHTML=`<div class="flex"><img src="svgs/database-solid.svg" alt="Browse app data" class="mr-2 h-7 w-7 rounded-lg bg-violet-500 p-1"/>
		Browse App Data</div>`,t=R(),l=m("div"),o=m("label"),o.textContent="Check game announcements:",r=R(),i=m("input"),a=R(),c=m("div"),u=m("label"),u.textContent="Close Bolt after launching a game:",f=R(),d=m("input"),h(e,"id","data_dir_button"),h(e,"class","p-2 hover:opacity-75"),h(o,"for","check_announcements"),h(i,"id","check_announcements"),h(i,"type","checkbox"),h(i,"class","ml-2"),h(l,"class","mx-auto p-2"),h(u,"for","close_after_launch"),h(d,"id","close_after_launch"),h(d,"type","checkbox"),h(d,"class","ml-2"),h(c,"class","mx-auto p-2")},m(p,y){w(p,e,y),w(p,t,y),w(p,l,y),v(l,o),v(l,r),v(l,i),i.checked=n[0].check_announcements,w(p,a,y),w(p,c,y),v(c,u),v(c,f),v(c,d),d.checked=n[0].close_after_launch,g||(_=[M(e,"click",n[3]),M(i,"change",n[4]),M(d,"change",n[5])],g=!0)},p(p,[y]){y&1&&(i.checked=p[0].check_announcements),y&1&&(d.checked=p[0].close_after_launch)},i:A,o:A,d(p){p&&(k(e),k(t),k(l),k(a),k(c)),g=!1,Q(_)}}}function nl(n,e,t){let l;function o(){var u=new XMLHttpRequest;u.open("GET","/browse-data"),u.onreadystatechange=()=>{u.readyState==4&&E.info(`Browse status: '${u.responseText.trim()}'`)},u.send()}const{config:r}=x;he(n,r,u=>t(0,l=u));const i=()=>{o()};function a(){l.check_announcements=this.checked,r.set(l)}function c(){l.close_after_launch=this.checked,r.set(l)}return[l,o,r,i,a,c]}class sl extends _e{constructor(e){super(),pe(this,e,nl,tl,fe,{})}}function ll(n){let e,t,l,o,r,i,a,c,u,f,d,g,_,p,y,b,L,C,B;return{c(){var N,I;e=m("button"),t=m("div"),t.innerHTML=`<img src="svgs/wrench-solid.svg" alt="Configure RuneLite" class="mr-2 h-7 w-7 rounded-lg bg-pink-500 p-1"/>
		Configure RuneLite`,o=R(),r=m("div"),i=m("label"),i.textContent="Use custom RuneLite JAR:",a=R(),c=m("input"),u=R(),f=m("div"),d=m("textarea"),_=R(),p=m("br"),y=R(),b=m("button"),L=G("Select File"),h(t,"class","flex"),e.disabled=l=!((N=n[0])!=null&&N.session_id)||!((I=n[3])!=null&&I.accountId),h(e,"class","p-2 pb-5 hover:opacity-75"),h(i,"for","use_custom_jar"),h(c,"id","use_custom_jar"),h(c,"type","checkbox"),h(c,"class","ml-2"),h(r,"class","mx-auto border-t-2 border-slate-300 p-2 pt-5 dark:border-slate-800"),h(d,"class","h-10 rounded border-2 border-slate-300 bg-slate-100 text-slate-950 dark:border-slate-800 dark:bg-slate-900 dark:text-slate-50"),d.disabled=g=!n[1].runelite_use_custom_jar,h(b,"class","mt-1 rounded-lg border-2 border-blue-500 p-1 duration-200 hover:opacity-75"),b.disabled=n[2],h(f,"class","mx-auto p-2"),oe(f,"opacity-25",!n[1].runelite_use_custom_jar)},m(N,I){w(N,e,I),v(e,t),w(N,o,I),w(N,r,I),v(r,i),v(r,a),v(r,c),c.checked=n[1].runelite_use_custom_jar,w(N,u,I),w(N,f,I),v(f,d),ue(d,n[1].runelite_custom_jar),v(f,_),v(f,p),v(f,y),v(f,b),v(b,L),C||(B=[M(e,"click",n[7]),M(c,"change",n[8]),M(d,"input",n[9]),M(b,"click",n[10])],C=!0)},p(N,[I]){var T,$;I&9&&l!==(l=!((T=N[0])!=null&&T.session_id)||!(($=N[3])!=null&&$.accountId))&&(e.disabled=l),I&2&&(c.checked=N[1].runelite_use_custom_jar),I&2&&g!==(g=!N[1].runelite_use_custom_jar)&&(d.disabled=g),I&2&&ue(d,N[1].runelite_custom_jar),I&4&&(b.disabled=N[2]),I&2&&oe(f,"opacity-25",!N[1].runelite_use_custom_jar)},i:A,o:A,d(N){N&&(k(e),k(o),k(r),k(u),k(f)),C=!1,Q(B)}}}function ol(n,e,t){let l,o,r;const{config:i}=x;he(n,i,p=>t(1,r=p));let a=!1;async function c(){t(2,a=!0),$e(i,r.runelite_custom_jar=await V.openFilePicker(),r),console.log("done picking"),t(2,a=!1)}function u(){!(l!=null&&l.session_id)||!(o!=null&&o.accountId)||!(o!=null&&o.displayName)||dn(l.session_id,o.accountId,o.displayName,!0)}const f=()=>u();function d(){r.runelite_use_custom_jar=this.checked,i.set(r)}function g(){r.runelite_custom_jar=this.value,i.set(r)}const _=()=>{c()};return n.$$.update=()=>{var p;n.$$.dirty&2&&t(0,l=V.findSession(r.selected.user_id)),n.$$.dirty&3&&t(3,o=V.findAccount((l==null?void 0:l.accounts)??[],(p=r.userDetails[r.selected.user_id??""])==null?void 0:p.account_id))},[l,r,a,o,i,c,u,f,d,g,_]}class rl extends _e{constructor(e){super(),pe(this,e,ol,ll,fe,{})}}function il(n){let e,t,l,o,r,i;return{c(){e=m("div"),t=m("label"),t.textContent="Enable Bolt plugin loader:",l=R(),o=m("input"),h(t,"for","enable_plugins"),h(o,"type","checkbox"),h(o,"name","enable_plugins"),h(o,"id","enable_plugins"),h(o,"class","ml-2"),h(e,"class","mx-auto p-2")},m(a,c){w(a,e,c),v(e,t),v(e,l),v(e,o),o.checked=n[0].rs_plugin_loader,r||(i=M(o,"change",n[2]),r=!0)},p(a,c){c&1&&(o.checked=a[0].rs_plugin_loader)},d(a){a&&k(e),r=!1,i()}}}function al(n){let e,t,l,o,r,i,a,c,u,f,d,g=P.hasBoltPlugins&&il(n);return{c(){g&&g.c(),e=R(),t=m("div"),l=m("label"),l.textContent="Use custom config URI:",o=R(),r=m("input"),i=R(),a=m("div"),c=m("textarea"),h(l,"for","use_custom_uri"),h(r,"id","use_custom_uri"),h(r,"type","checkbox"),h(r,"class","ml-2"),h(t,"class","mx-auto p-2"),h(c,"class","rounded border-2 border-slate-300 bg-slate-100 text-slate-950 disabled:opacity-50 dark:border-slate-800 dark:bg-slate-900 dark:text-slate-50"),c.disabled=u=!n[0].use_custom_rs_config_uri,h(c,"rows","4"),h(c,"placeholder",P.env.default_config_uri),h(a,"class","p-2")},m(_,p){g&&g.m(_,p),w(_,e,p),w(_,t,p),v(t,l),v(t,o),v(t,r),r.checked=n[0].use_custom_rs_config_uri,w(_,i,p),w(_,a,p),v(a,c),ue(c,n[0].rs_config_uri),f||(d=[M(r,"change",n[3]),M(c,"input",n[4])],f=!0)},p(_,[p]){P.hasBoltPlugins&&g.p(_,p),p&1&&(r.checked=_[0].use_custom_rs_config_uri),p&1&&u!==(u=!_[0].use_custom_rs_config_uri)&&(c.disabled=u),p&1&&ue(c,_[0].rs_config_uri)},i:A,o:A,d(_){_&&(k(e),k(t),k(i),k(a)),g&&g.d(_),f=!1,Q(d)}}}function cl(n,e,t){let l;const{config:o}=x;he(n,o,c=>t(0,l=c));function r(){l.rs_plugin_loader=this.checked,o.set(l)}function i(){l.use_custom_rs_config_uri=this.checked,o.set(l)}function a(){l.rs_config_uri=this.value,o.set(l)}return[l,o,r,i,a]}class ul extends _e{constructor(e){super(),pe(this,e,cl,al,fe,{})}}function fl(n){let e,t;return e=new ul({}),{c(){re(e.$$.fragment)},m(l,o){ee(e,l,o),t=!0},i(l){t||(q(e.$$.fragment,l),t=!0)},o(l){J(e.$$.fragment,l),t=!1},d(l){te(e,l)}}}function dl(n){let e,t;return e=new rl({}),{c(){re(e.$$.fragment)},m(l,o){ee(e,l,o),t=!0},i(l){t||(q(e.$$.fragment,l),t=!0)},o(l){J(e.$$.fragment,l),t=!1},d(l){te(e,l)}}}function pl(n){let e,t;return e=new sl({}),{c(){re(e.$$.fragment)},m(l,o){ee(e,l,o),t=!0},i(l){t||(q(e.$$.fragment,l),t=!0)},o(l){J(e.$$.fragment,l),t=!1},d(l){te(e,l)}}}function _l(n){let e,t,l,o,r,i,a,c,u,f,d,g,_,p,y,b,L,C,B,N;const I=[pl,dl,fl],T=[];function $(S,O){return S[1]==S[2].general?0:S[1]==S[2].osrs?1:S[1]==S[2].rs3?2:-1}return~(b=$(n))&&(L=T[b]=I[b](n)),{c(){e=m("div"),t=m("div"),l=m("button"),o=G("General"),i=R(),a=m("button"),c=G("OSRS"),f=R(),d=m("button"),g=G("RS3"),p=R(),y=m("div"),L&&L.c(),h(l,"class",r=n[1]===n[2].general?je:Ae),h(a,"class",u=n[1]===n[2].osrs?je:Ae),h(d,"class",_=n[1]===n[2].rs3?je:Ae),h(t,"class","flex flex-col items-center gap-2 border-r-2 border-slate-300 pt-10 dark:border-slate-800"),h(y,"class","col-span-3 p-5 pt-10 text-center"),h(e,"class","grid h-full grid-cols-4")},m(S,O){w(S,e,O),v(e,t),v(t,l),v(l,o),v(t,i),v(t,a),v(a,c),v(t,f),v(t,d),v(d,g),v(e,p),v(e,y),~b&&T[b].m(y,null),C=!0,B||(N=[M(l,"click",n[4]),M(a,"click",n[5]),M(d,"click",n[6])],B=!0)},p(S,O){(!C||O&2&&r!==(r=S[1]===S[2].general?je:Ae))&&h(l,"class",r),(!C||O&2&&u!==(u=S[1]===S[2].osrs?je:Ae))&&h(a,"class",u),(!C||O&2&&_!==(_=S[1]===S[2].rs3?je:Ae))&&h(d,"class",_);let H=b;b=$(S),b!==H&&(L&&(Ye(),J(T[H],1,1,()=>{T[H]=null}),Ze()),~b?(L=T[b],L||(L=T[b]=I[b](S),L.c()),q(L,1),L.m(y,null)):L=null)},i(S){C||(q(L),C=!0)},o(S){J(L),C=!1},d(S){S&&k(e),~b&&T[b].d(),B=!1,Q(N)}}}function gl(n){let e,t,l={class:"h-3/4 w-3/4 select-none",$$slots:{default:[_l]},$$scope:{ctx:n}};return e=new ut({props:l}),n[7](e),{c(){re(e.$$.fragment)},m(o,r){ee(e,o,r),t=!0},p(o,[r]){const i={};r&258&&(i.$$scope={dirty:r,ctx:o}),e.$set(i)},i(o){t||(q(e.$$.fragment,o),t=!0)},o(o){J(e.$$.fragment,o),t=!1},d(o){n[7](null),te(e,o)}}}let je="border-2 border-blue-500 bg-blue-500 hover:opacity-75 font-bold text-black duration-200 rounded-lg p-1 w-3/4",Ae="border-2 border-blue-500 hover:opacity-75 duration-200 rounded-lg p-1 w-3/4";function hl(n,e,t){let l;function o(){l.open()}var r=(d=>(d[d.general=0]="general",d[d.osrs=1]="osrs",d[d.rs3=2]="rs3",d))(r||{});let i=0;const a=()=>{t(1,i=r.general)},c=()=>{t(1,i=r.osrs)},u=()=>{t(1,i=r.rs3)};function f(d){ve[d?"unshift":"push"](()=>{l=d,t(0,l)})}return[l,i,r,o,a,c,u,f]}class ml extends _e{constructor(e){super(),pe(this,e,hl,gl,fe,{open:3})}get open(){return this.$$.ctx[3]}}function bl(n){const e=n.slice(),t=V.findSession(e[1].selected.user_id??"");return e[11]=t,e}function kl(n){let e,t,l;return{c(){e=m("button"),e.textContent="Login",h(e,"class","h-11 w-48 rounded-lg border-2 border-slate-300 bg-inherit p-2 text-center font-bold text-black duration-200 hover:opacity-75 dark:border-slate-800 dark:text-slate-50")},m(o,r){w(o,e,r),t||(l=M(e,"click",n[10]),t=!0)},p:A,i:A,o:A,d(o){o&&k(e),t=!1,l()}}}function wl(n){let e,t;return e=new el({props:{align:"center",$$slots:{content:[vl],default:[yl]},$$scope:{ctx:n}}}),{c(){re(e.$$.fragment)},m(l,o){ee(e,l,o),t=!0},p(l,o){const r={};o&4098&&(r.$$scope={dirty:o,ctx:l}),e.$set(r)},i(l){t||(q(e.$$.fragment,l),t=!0)},o(l){J(e.$$.fragment,l),t=!1},d(l){te(e,l)}}}function yl(n){var o;let e,t=(((o=n[11])==null?void 0:o.user.displayName)??"No user selected")+"",l;return{c(){e=m("button"),l=G(t),h(e,"class","h-11 w-48 rounded-lg border-2 border-slate-300 bg-inherit text-center font-bold text-black duration-200 hover:opacity-75 dark:border-slate-800 dark:text-slate-50")},m(r,i){w(r,e,i),v(e,l)},p(r,i){var a;i&2&&t!==(t=(((a=r[11])==null?void 0:a.user.displayName)??"No user selected")+"")&&ce(l,t)},d(r){r&&k(e)}}}function vl(n){let e,t,l;return t=new Vs({}),{c(){e=m("div"),re(t.$$.fragment),h(e,"slot","content"),h(e,"class","w-40")},m(o,r){w(o,e,r),ee(t,e,null),l=!0},p:A,i(o){l||(q(t.$$.fragment,o),l=!0)},o(o){J(t.$$.fragment,o),l=!1},d(o){o&&k(e),te(t)}}}function $l(n){let e,t,l,o,r,i,a,c,u,f,d,g,_,p,y,b,L,C,B={};e=new ml({props:B}),n[5](e);const N=[wl,kl],I=[];function T(S,O){return S[2].length>0?0:1}function $(S,O){return O===0?bl(S):S}return p=T(n),y=I[p]=N[p]($(n,p)),{c(){re(e.$$.fragment),t=R(),l=m("div"),o=m("div"),r=m("button"),r.textContent="RS3",i=R(),a=m("button"),a.textContent="OSRS",c=R(),u=m("div"),f=m("button"),f.innerHTML='<img src="svgs/lightbulb-solid.svg" class="m-auto h-6 w-6" alt="Change Theme"/>',d=R(),g=m("button"),g.innerHTML='<img src="svgs/gear-solid.svg" class="m-auto h-6 w-6" alt="Settings"/>',_=R(),y.c(),h(r,"class","mx-1 w-20 rounded-lg border-2 border-blue-500 p-2 duration-200 hover:opacity-75"),oe(r,"text-black",n[1].selected.game===le.rs3),oe(r,"bg-blue-500",n[1].selected.game===le.rs3),h(a,"class","mx-1 w-20 rounded-lg border-2 border-blue-500 bg-blue-500 p-2 text-black duration-200 hover:opacity-75"),oe(a,"text-black",n[1].selected.game===le.osrs),oe(a,"bg-blue-500",n[1].selected.game===le.osrs),h(o,"class","m-3 ml-9 font-bold"),h(f,"class","h-10 w-10 rounded-full bg-blue-500 text-center duration-200 hover:rotate-45 hover:opacity-75"),h(g,"class","h-10 w-10 rounded-full bg-blue-500 text-center duration-200 hover:rotate-45 hover:opacity-75"),h(u,"class","m-2 ml-auto flex gap-2"),h(l,"class","fixed top-0 flex h-16 w-screen border-b-2 border-slate-300 bg-slate-100 duration-200 dark:border-slate-800 dark:bg-slate-900")},m(S,O){ee(e,S,O),w(S,t,O),w(S,l,O),v(l,o),v(o,r),v(o,i),v(o,a),v(l,c),v(l,u),v(u,f),v(u,d),v(u,g),v(u,_),I[p].m(u,null),b=!0,L||(C=[M(r,"click",n[6]),M(a,"click",n[7]),M(f,"click",n[8]),M(g,"click",n[9])],L=!0)},p(S,[O]){const H={};e.$set(H),(!b||O&2)&&oe(r,"text-black",S[1].selected.game===le.rs3),(!b||O&2)&&oe(r,"bg-blue-500",S[1].selected.game===le.rs3),(!b||O&2)&&oe(a,"text-black",S[1].selected.game===le.osrs),(!b||O&2)&&oe(a,"bg-blue-500",S[1].selected.game===le.osrs);let F=p;p=T(S),p===F?I[p].p($(S,p),O):(Ye(),J(I[F],1,1,()=>{I[F]=null}),Ze(),y=I[p],y?y.p($(S,p),O):(y=I[p]=N[p]($(S,p)),y.c()),q(y,1),y.m(u,null))},i(S){b||(q(e.$$.fragment,S),q(y),b=!0)},o(S){J(e.$$.fragment,S),J(y),b=!1},d(S){S&&(k(t),k(l)),n[5](null),te(e,S),I[p].d(),L=!1,Q(C)}}}function Sl(n,e,t){let l,o;const{config:r,sessions:i}=x;he(n,r,p=>t(1,l=p)),he(n,i,p=>t(2,o=p));let a;function c(p){ve[p?"unshift":"push"](()=>{a=p,t(0,a)})}return[a,l,o,r,i,c,()=>{$e(r,l.selected.game=le.rs3,l)},()=>{$e(r,l.selected.game=le.osrs,l)},()=>$e(r,l.use_dark_theme=!l.use_dark_theme,l),()=>a.open(),()=>{const{origin:p,redirect:y,clientid:b}=P.env;we.openLoginWindow(p,y,b)}]}class Cl extends _e{constructor(e){super(),pe(this,e,Sl,$l,fe,{})}}function Ll(n){let e,t,l,o,r,i,a,c,u,f,d,g,_;return e=new ss({}),l=new Cl({}),c=new Gs({}),g=new Ws({props:{logs:n[0]}}),{c(){re(e.$$.fragment),t=R(),re(l.$$.fragment),o=R(),r=m("div"),i=m("div"),a=R(),re(c.$$.fragment),u=R(),f=m("div"),d=R(),re(g.$$.fragment),h(r,"class","mt-16 grid h-full grid-flow-col grid-cols-3")},m(p,y){ee(e,p,y),w(p,t,y),ee(l,p,y),w(p,o,y),w(p,r,y),v(r,i),v(r,a),ee(c,r,null),v(r,u),v(r,f),w(p,d,y),ee(g,p,y),_=!0},p(p,y){const b={};y&1&&(b.logs=p[0]),g.$set(b)},i(p){_||(q(e.$$.fragment,p),q(l.$$.fragment,p),q(c.$$.fragment,p),q(g.$$.fragment,p),_=!0)},o(p){J(e.$$.fragment,p),J(l.$$.fragment,p),J(c.$$.fragment,p),J(g.$$.fragment,p),_=!1},d(p){p&&(k(t),k(o),k(r),k(d)),te(e,p),te(l,p),te(c),te(g,p)}}}function Rl(n){let e,t,l,o;return e=new fn({props:{$$slots:{default:[Ll]},$$scope:{ctx:n}}}),{c(){re(e.$$.fragment)},m(r,i){ee(e,r,i),t=!0,l||(o=M(window,"beforeunload",n[2]),l=!0)},p(r,[i]){const a={};i&9&&(a.$$scope={dirty:i,ctx:r}),e.$set(a)},i(r){t||(q(e.$$.fragment,r),t=!0)},o(r){J(e.$$.fragment,r),t=!1},d(r){te(e,r),l=!1,o()}}}function Pl(n,e,t){let l;const o=E.logs;return he(n,o,i=>t(0,l=i)),[l,o,()=>{V.saveConfig(),P.hasBoltPlugins&&V.savePluginConfig(!0)}]}class Tl extends _e{constructor(e){super(),pe(this,e,Pl,Rl,fe,{})}}const ln={target:document.getElementById("app")};window.opener||window.location.search.includes("&id_token")?new Zn(ln):(Ul(),Jn(),Il(),Hl().finally(()=>{x.initialized.set(!0)}),new Tl(ln));function Ul(){const n=new URLSearchParams(window.location.search);P.platform=n.get("platform"),P.isFlathub=n.get("flathub")==="1",P.hasLibArchive=n.get("has_libarchive")==="1",P.rs3DebInstalledHash=n.get("rs3_deb_installed_hash"),P.rs3ExeInstalledHash=n.get("rs3_exe_installed_hash"),P.rs3AppInstalledHash=n.get("rs3_app_installed_hash"),P.osrsExeInstalledHash=n.get("osrs_exe_installed_hash"),P.osrsAppInstalledHash=n.get("osrs_app_installed_hash"),P.runeLiteInstalledId=n.get("runelite_installed_id"),P.hdosInstalledVersion=n.get("hdos_installed_version");const e=n.get("plugins");if(P.hasBoltPlugins=e!==null,e!==null)try{P.pluginConfig=JSON.parse(e)}catch{E.error("Unable to parse plugin list")}const t=n.get("credentials");if(t)try{const l=JSON.parse(t),o=l.every(r=>typeof r.session_id=="string"&&typeof r.tokens=="object"&&typeof r.accounts=="object"&&typeof r.user=="object");o?x.sessions.set(l):(x.sessions.set([]),V.saveCredentials(),E.warn("Credentials saved on disk are out of date. Please sign in again.")),x.sessions.set(o?l:[])}catch{x.sessions.set([]),V.saveCredentials(),E.error("Unable to parse saved credentials. Please sign in again.")}}function Il(){const{origin:n,origin_2fa:e}=P.env,t=[window.location.origin,n,e];let l=null;window.addEventListener("message",async o=>{var r;if(!t.includes(o.origin)){E.info(`discarding window message from origin ${o.origin}`);return}switch(o.data.type){case"authTokenUpdate":{l=o.data.tokens;break}case"authSessionUpdate":{if(l===null)return E.error("auth is null. Please try again.");const i=o.data.sessionId,a=await V.login(l,i);a.ok?E.info(`Added new user '${a.value.user.displayName}'`):E.error(`Unable to add new user. Please try again. ${a.error}`),V.saveCredentials(),we.pendingLoginWindow=null,l=null;break}case"authFailed":{E.error(`Unable to authenticate: ${o.data.reason}`),we.pendingLoginWindow=null,l=null;break}case"externalUrl":{const i=new XMLHttpRequest;i.onreadystatechange=()=>{i.readyState==4&&E.info(`External URL status: '${i.responseText.trim()}'`)},i.open("POST","/open-external-url",!0),i.send(o.data.url);break}case"gameClientList":ke(x.config).close_after_launch&&o.data.clients.length>ke(vt).length?fetch("/close"):vt.set(o.data.clients);break;default:{const i=((r=o.data)==null?void 0:r.type)??"no type provided";E.info(`Unknown message type: ${i}`);break}}})}async function Hl(){const n=ke(x.sessions),e=[];n.length>0&&E.info("Logging in...");for(const t of n){const l=await we.refreshOAuthToken(t.tokens);if(!l.ok){l.error===0?E.error(`Unable to verify saved login, status: ${l.error}. Do you have an internet connection? Please relaunch Bolt to try again.`):(E.error(`Discarding expired login, status: ${l.error}. Please sign in again.`),e.push(t.tokens.sub));continue}const o=l.value;t.tokens=o;const r=await V.login(o,t.session_id);r.ok?E.info(`Signed into saved user '${r.value.user.displayName}'`):(E.error(`Unable to sign into saved user '${t.user.displayName}' - please sign in again. ${r.error}`),e.push(t.tokens.sub))}e.forEach(async t=>{await V.logout(t)}),x.sessions.set(n),await V.saveCredentials()}

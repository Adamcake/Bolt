var $n=Object.defineProperty;var Sn=(t,e,n)=>e in t?$n(t,e,{enumerable:!0,configurable:!0,writable:!0,value:n}):t[e]=n;var Ze=(t,e,n)=>(Sn(t,typeof e!="symbol"?e+"":e,n),n);(function(){const e=document.createElement("link").relList;if(e&&e.supports&&e.supports("modulepreload"))return;for(const o of document.querySelectorAll('link[rel="modulepreload"]'))l(o);new MutationObserver(o=>{for(const r of o)if(r.type==="childList")for(const i of r.addedNodes)i.tagName==="LINK"&&i.rel==="modulepreload"&&l(i)}).observe(document,{childList:!0,subtree:!0});function n(o){const r={};return o.integrity&&(r.integrity=o.integrity),o.referrerPolicy&&(r.referrerPolicy=o.referrerPolicy),o.crossOrigin==="use-credentials"?r.credentials="include":o.crossOrigin==="anonymous"?r.credentials="omit":r.credentials="same-origin",r}function l(o){if(o.ep)return;o.ep=!0;const r=n(o);fetch(o.href,r)}})();var Ct=(t=>(t[t.SECOND=1e3]="SECOND",t[t.MINUTE=6e4]="MINUTE",t[t.HALF_HOUR=18e5]="HALF_HOUR",t[t.HOUR=36e5]="HOUR",t[t.DAY=864e5]="DAY",t[t.WEEK=6048e5]="WEEK",t[t.MONTH=2592e6]="MONTH",t))(Ct||{});class Fe{static set(e,n,l,o){const r=new Date;r.setTime(r.getTime()+l*o);const i=`expires=${r.toUTCString()}`;document.cookie=`${e}=${n};${i};path=/`}static get(e){const n=`${e}=`,l=document.cookie.split(";");for(let o=0;o<l.length;o++){let r=l[o];for(;r.charAt(0)===" ";)r=r.substring(1,r.length);if(r.indexOf(n)===0)return r.substring(n.length,r.length)}return null}static remove(e){document.cookie=`${e}=; Max-Age=-99999999;`}}function Ce(t){return{ok:!0,value:t}}function oe(t){return{ok:!1,error:t}}var ce=(t=>(t.rs3="rs3",t.osrs="osrs",t))(ce||{}),We=(t=>(t.official="Official",t.runelite="RuneLite",t.hdos="HDOS",t))(We||{});const Ht={rs3:["Official"],osrs:["Official","RuneLite","HDOS"]};class rt{static parseTokenResponse(e){try{const n=JSON.parse(e),l=n.id_token.split(".");if(l.length!==3){const i=`Malformed id_token: ${l.length} sections, expected 3`;return oe(i)}const o=JSON.parse(atob(l[0]));if(o.typ!=="JWT"){const i=`Bad id_token header: typ ${o.typ}, expected JWT`;return oe(i)}const r=JSON.parse(atob(l[1]));return Ce({access_token:n.access_token,id_token:n.id_token,refresh_token:n.refresh_token,sub:r.sub,expiry:Date.now()+n.expires_in*1e3})}catch{return oe("Unable to parse token response")}}static parseSessionResponse(e){try{const n=JSON.parse(e);return n.sessionId?Ce(n.sessionId):oe("sessionId does not exist on parsed object")}catch{return oe("Unable to parse session response")}}static decodeBolt(e){const n={};for(const l in e){const o=l,r=e[o];typeof r=="string"?n[o]=atob(r):Array.isArray(r)&&r.every(i=>typeof i=="string")?n[o]=r.map(i=>atob(i)):n[o]=r}return n}}var Lt=(t=>(t.Windows="windows",t.Linux="linux",t.MacOS="mac",t))(Lt||{});const U={env:rt.decodeBolt(s()),platform:null,rs3DebInstalledHash:null,rs3ExeInstalledHash:null,rs3AppInstalledHash:null,osrsExeInstalledHash:null,osrsAppInstalledHash:null,runeLiteInstalledId:null,hdosInstalledVersion:null,isFlathub:!1,hasLibArchive:!1,hasBoltPlugins:!1,pluginConfig:{}};class kt{static async makeLoginUrl(e){const n=new TextEncoder().encode(e.pkceCodeVerifier),l=await crypto.subtle.digest("SHA-256",n);let o="";const r=new Uint8Array(l);for(let a=0;a<r.byteLength;a++)o+=String.fromCharCode(r[a]);const i=btoa(o).replace(/\+/g,"-").replace(/\//g,"_").replace(/=+$/,"");return e.origin.concat("/oauth2/auth?").concat(new URLSearchParams({auth_method:e.authMethod,login_type:e.loginType,flow:e.flow,response_type:"code",client_id:e.clientid,redirect_uri:e.redirect,code_challenge:i,code_challenge_method:"S256",prompt:"login",scope:"openid offline gamesso.token.create user.profile.read",state:e.pkceState}).toString())}static makeRandomVerifier(){const e="ABCDEFGHIJKLMNOPQRSTUVWXYZabcdefghijklmnopqrstuvwxyz0123456789-._~",n=new Uint32Array(43);return crypto.getRandomValues(n),Array.from(n,function(l){return e[l%e.length]}).join("")}static makeRandomState(){const n="ABCDEFGHIJKLMNOPQRSTUVWXYZabcdefghijklmnopqrstuvwxyz",l=n.length-1,o=crypto.getRandomValues(new Uint8Array(12));return Array.from(o).map(r=>Math.round(r*(l-0)/255+0)).map(r=>n[r]).join("")}}const Je=class Je{static async openLoginWindow(e,n,l){if(Je.pendingLoginWindow!==null)return Je.pendingLoginWindow.window.focus();const o=kt.makeRandomState(),r=kt.makeRandomVerifier(),i=new TextEncoder().encode(r),a=await crypto.subtle.digest("SHA-256",i);let c="";const u=new Uint8Array(a);for(let g=0;g<u.byteLength;g++)c+=String.fromCharCode(u[g]);const f=btoa(c).replace(/\+/g,"-").replace(/\//g,"_").replace(/=+$/,""),d=new URLSearchParams({auth_method:"",login_type:"",flow:"launcher",response_type:"code",client_id:l,redirect_uri:n,code_challenge:f,code_challenge_method:"S256",prompt:"login",scope:"openid offline gamesso.token.create user.profile.read",state:o}),m=`${e}/oauth2/auth?${d.toString()}`;Fe.set("auth_verifier",r,10,Ct.MINUTE),Je.pendingLoginWindow=window.open(m,"","width=480,height=720")}static navigateToAuthConsent(e,n,l){const o=kt.makeRandomState(),r=new URLSearchParams({id_token_hint:n,nonce:l,prompt:"consent",redirect_uri:"http://localhost",response_type:"id_token code",state:o,client_id:"1fddee4e-b100-4f4e-b2b0-097f9088f9d2",scope:"openid offline"}),i=`${e}/oauth2/auth?${r.toString()}`;Fe.set("auth_nonce",l,10,Ct.MINUTE),window.location.href=i}static async refreshOAuthToken(e){return new Promise(n=>{if(e.expiry-Date.now()<3e4){const l=new URLSearchParams({grant_type:"refresh_token",client_id:U.env.clientid,refresh_token:e.refresh_token}),o=new XMLHttpRequest;o.onreadystatechange=()=>{if(o.readyState==4)if(o.status==200){const i=rt.parseTokenResponse(o.response);i.ok?n(Ce(i.value)):n(oe(0))}else n(oe(o.status))},o.onerror=()=>{n(oe(0))};const r=U.env.origin.concat("/oauth2/token");o.open("POST",r,!0),o.setRequestHeader("Content-Type","application/x-www-form-urlencoded"),o.setRequestHeader("Accept","application/json"),o.send(l)}else n(Ce(e))})}static async getOAuthToken(e,n,l,o,r){const i=`${e}/oauth2/token`;return new Promise(a=>{const c=new XMLHttpRequest;c.onreadystatechange=()=>{if(c.readyState==4)if(c.status==200){const f=rt.parseTokenResponse(c.response);return f.ok?a(Ce(f.value)):a(oe(f.error))}else return a(oe(`Error: from ${i}: ${c.status}: ${c.response}`))},c.open("POST",i,!0),c.setRequestHeader("Content-Type","application/x-www-form-urlencoded"),c.setRequestHeader("Accept","application/json");const u=new URLSearchParams({grant_type:"authorization_code",client_id:n,code:r,code_verifier:l,redirect_uri:o});c.send(u)})}static revokeOauthCreds(e){const n=`${U.env.origin}/oauth2/revoke`;return new Promise(l=>{const o=new XMLHttpRequest;o.open("POST",n,!0),o.onreadystatechange=()=>{o.readyState==4&&l(o.status)},o.setRequestHeader("Content-Type","application/x-www-form-urlencoded");const r=new URLSearchParams({token:e,client_id:U.env.clientid});o.send(r)})}static async getSessionId(e,n){const l=`${e}/sessions`;return new Promise(o=>{const r=new XMLHttpRequest;r.onreadystatechange=()=>{if(r.readyState==4)if(r.status==200){const a=rt.parseSessionResponse(r.response);return a.ok?o(Ce(a.value)):o(oe(a.error))}else oe(`Error: from ${l}: ${r.status}: ${r.response}`)},r.open("POST",l,!0),r.setRequestHeader("Content-Type","application/json"),r.setRequestHeader("Accept","application/json");const i={idToken:n};r.send(JSON.stringify(i))})}static validateIdToken(e,n){const l=e.split(".");if(l.length!==3)return oe(`Malformed id_token: ${l.length} sections, expected 3`);const o=JSON.parse(atob(l[0]));return o.typ!=="JWT"?oe(`Bad id_token header: typ ${o.typ}, expected JWT`):JSON.parse(atob(l[1])).nonce!==n?oe("Incorrect nonce in id_token"):Ce(void 0)}};Ze(Je,"pendingLoginWindow",null);let $e=Je;class at{static async buildSession(e,n){const l=await at.getUser(e.sub,e.access_token);if(!l.ok)return oe(`Failed to fetch user. Status: ${l.error}`);const o=await at.getUserAccounts(n);return o.ok?Ce({user:l.value,accounts:o.value,tokens:e,session_id:n}):oe(`Failed to fetch game accounts. Status: ${o.error}`)}static getUser(e,n){return new Promise(l=>{const o=`${U.env.api}/users/${e}/displayName`,r=new XMLHttpRequest;r.onreadystatechange=()=>{if(r.readyState==4)if(r.status==200){const i=JSON.parse(r.response);l(Ce(i))}else l(oe(r.status))},r.open("GET",o,!0),r.setRequestHeader("Authorization","Bearer ".concat(n)),r.send()})}static getUserAccounts(e){const n=`${U.env.auth_api}/accounts`;return new Promise(l=>{const o=new XMLHttpRequest;o.onreadystatechange=async()=>{if(o.readyState==4)if(o.status==200){const r=JSON.parse(o.response);l(Ce(r))}else l(oe(o.status))},o.open("GET",n,!0),o.setRequestHeader("Accept","application/json"),o.setRequestHeader("Authorization","Bearer ".concat(e)),o.send()})}}function B(){}function Cn(t,e){for(const n in e)t[n]=e[n];return t}function Ln(t){return!!t&&(typeof t=="object"||typeof t=="function")&&typeof t.then=="function"}function pn(t){return t()}function xt(){return Object.create(null)}function re(t){t.forEach(pn)}function ut(t){return typeof t=="function"}function _e(t,e){return t!=t?e==e:t!==e||t&&typeof t=="object"||typeof t=="function"}let ot;function Rt(t,e){return t===e?!0:(ot||(ot=document.createElement("a")),ot.href=e,t===ot.href)}function Rn(t){return Object.keys(t).length===0}function _n(t,...e){if(t==null){for(const l of e)l(void 0);return B}const n=t.subscribe(...e);return n.unsubscribe?()=>n.unsubscribe():n}function ve(t){let e;return _n(t,n=>e=n)(),e}function ke(t,e,n){t.$$.on_destroy.push(_n(e,n))}function dt(t,e,n,l){if(t){const o=gn(t,e,n,l);return t[0](o)}}function gn(t,e,n,l){return t[1]&&l?Cn(n.ctx.slice(),t[1](l(e))):n.ctx}function ft(t,e,n,l){if(t[2]&&l){const o=t[2](l(n));if(e.dirty===void 0)return o;if(typeof o=="object"){const r=[],i=Math.max(e.dirty.length,o.length);for(let a=0;a<i;a+=1)r[a]=e.dirty[a]|o[a];return r}return e.dirty|o}return e.dirty}function pt(t,e,n,l,o,r){if(o){const i=gn(e,n,l,r);t.p(i,o)}}function _t(t){if(t.ctx.length>32){const e=[],n=t.ctx.length/32;for(let l=0;l<n;l++)e[l]=-1;return e}return-1}function Re(t,e,n){return t.set(n),e}function Pn(t){return t&&ut(t.destroy)?t.destroy:B}function w(t,e){t.appendChild(e)}function v(t,e,n){t.insertBefore(e,n||null)}function k(t){t.parentNode&&t.parentNode.removeChild(t)}function je(t,e){for(let n=0;n<t.length;n+=1)t[n]&&t[n].d(e)}function h(t){return document.createElement(t)}function F(t){return document.createTextNode(t)}function L(){return F(" ")}function Pe(){return F("")}function M(t,e,n,l){return t.addEventListener(e,n,l),()=>t.removeEventListener(e,n,l)}function Tn(t){return function(e){e.target===this&&t.call(this,e)}}function _(t,e,n){n==null?t.removeAttribute(e):t.getAttribute(e)!==n&&t.setAttribute(e,n)}function Un(t){return Array.from(t.childNodes)}function pe(t,e){e=""+e,t.data!==e&&(t.data=e)}function Q(t,e){t.value=e??""}function xe(t,e,n){for(let l=0;l<t.options.length;l+=1){const o=t.options[l];if(o.__value===e){o.selected=!0;return}}(!n||e!==void 0)&&(t.selectedIndex=-1)}function Ut(t){const e=t.querySelector(":checked");return e&&e.__value}function ue(t,e,n){t.classList.toggle(e,!!n)}function In(t,e,{bubbles:n=!1,cancelable:l=!1}={}){return new CustomEvent(t,{detail:e,bubbles:n,cancelable:l})}let Qe;function Ue(t){Qe=t}function gt(){if(!Qe)throw new Error("Function called outside component initialization");return Qe}function mn(t){gt().$$.on_mount.push(t)}function Hn(t){gt().$$.on_destroy.push(t)}function xn(){const t=gt();return(e,n,{cancelable:l=!1}={})=>{const o=t.$$.callbacks[e];if(o){const r=In(e,n,{cancelable:l});return o.slice().forEach(i=>{i.call(t,r)}),!r.defaultPrevented}return!0}}const Ge=[],Le=[];let Xe=[];const Ot=[],On=Promise.resolve();let Pt=!1;function En(){Pt||(Pt=!0,On.then(It))}function ze(t){Xe.push(t)}const wt=new Set;let Me=0;function It(){if(Me!==0)return;const t=Qe;do{try{for(;Me<Ge.length;){const e=Ge[Me];Me++,Ue(e),Nn(e.$$)}}catch(e){throw Ge.length=0,Me=0,e}for(Ue(null),Ge.length=0,Me=0;Le.length;)Le.pop()();for(let e=0;e<Xe.length;e+=1){const n=Xe[e];wt.has(n)||(wt.add(n),n())}Xe.length=0}while(Ge.length);for(;Ot.length;)Ot.pop()();Pt=!1,wt.clear(),Ue(t)}function Nn(t){if(t.fragment!==null){t.update(),re(t.before_update);const e=t.dirty;t.dirty=[-1],t.fragment&&t.fragment.p(t.ctx,e),t.after_update.forEach(ze)}}function jn(t){const e=[],n=[];Xe.forEach(l=>t.indexOf(l)===-1?e.push(l):n.push(l)),n.forEach(l=>l()),Xe=e}const it=new Set;let Ne;function et(){Ne={r:0,c:[],p:Ne}}function tt(){Ne.r||re(Ne.c),Ne=Ne.p}function G(t,e){t&&t.i&&(it.delete(t),t.i(e))}function J(t,e,n,l){if(t&&t.o){if(it.has(t))return;it.add(t),Ne.c.push(()=>{it.delete(t),l&&(n&&t.d(1),l())}),t.o(e)}else l&&l()}function ct(t,e){const n=e.token={};function l(o,r,i,a){if(e.token!==n)return;e.resolved=a;let c=e.ctx;i!==void 0&&(c=c.slice(),c[i]=a);const u=o&&(e.current=o)(c);let f=!1;e.block&&(e.blocks?e.blocks.forEach((d,m)=>{m!==r&&d&&(et(),J(d,1,1,()=>{e.blocks[m]===d&&(e.blocks[m]=null)}),tt())}):e.block.d(1),u.c(),G(u,1),u.m(e.mount(),e.anchor),f=!0),e.block=u,e.blocks&&(e.blocks[r]=u),f&&It()}if(Ln(t)){const o=gt();if(t.then(r=>{Ue(o),l(e.then,1,e.value,r),Ue(null)},r=>{if(Ue(o),l(e.catch,2,e.error,r),Ue(null),!e.hasCatch)throw r}),e.current!==e.pending)return l(e.pending,0),!0}else{if(e.current!==e.then)return l(e.then,1,e.value,t),!0;e.resolved=t}}function hn(t,e,n){const l=e.slice(),{resolved:o}=t;t.current===t.then&&(l[t.value]=o),t.current===t.catch&&(l[t.error]=o),t.block.p(l,n)}function ge(t){return(t==null?void 0:t.length)!==void 0?t:Array.from(t)}function Mn(t,e){t.d(1),e.delete(t.key)}function An(t,e,n,l,o,r,i,a,c,u,f,d){let m=t.length,g=r.length,p=m;const y={};for(;p--;)y[t[p].key]=p;const b=[],R=new Map,C=new Map,D=[];for(p=g;p--;){const S=d(o,r,p),$=n(S);let H=i.get($);H?l&&D.push(()=>H.p(S,e)):(H=u($,S),H.c()),R.set($,b[p]=H),$ in y&&C.set($,Math.abs(p-y[$]))}const O=new Set,I=new Set;function P(S){G(S,1),S.m(a,f),i.set(S.key,S),f=S.first,g--}for(;m&&g;){const S=b[g-1],$=t[m-1],H=S.key,x=$.key;S===$?(f=S.first,m--,g--):R.has(x)?!i.has(H)||O.has(H)?P(S):I.has(x)?m--:C.get(H)>C.get(x)?(I.add(H),P(S)):(O.add(x),m--):(c($,i),m--)}for(;m--;){const S=t[m];R.has(S.key)||c(S,i)}for(;g;)P(b[g-1]);return re(D),b}function de(t){t&&t.c()}function ie(t,e,n){const{fragment:l,after_update:o}=t.$$;l&&l.m(e,n),ze(()=>{const r=t.$$.on_mount.map(pn).filter(ut);t.$$.on_destroy?t.$$.on_destroy.push(...r):re(r),t.$$.on_mount=[]}),o.forEach(ze)}function ae(t,e){const n=t.$$;n.fragment!==null&&(jn(n.after_update),re(n.on_destroy),n.fragment&&n.fragment.d(e),n.on_destroy=n.fragment=null,n.ctx=[])}function Dn(t,e){t.$$.dirty[0]===-1&&(Ge.push(t),En(),t.$$.dirty.fill(0)),t.$$.dirty[e/31|0]|=1<<e%31}function me(t,e,n,l,o,r,i=null,a=[-1]){const c=Qe;Ue(t);const u=t.$$={fragment:null,ctx:[],props:r,update:B,not_equal:o,bound:xt(),on_mount:[],on_destroy:[],on_disconnect:[],before_update:[],after_update:[],context:new Map(e.context||(c?c.$$.context:[])),callbacks:xt(),dirty:a,skip_bound:!1,root:e.target||c.$$.root};i&&i(u.root);let f=!1;if(u.ctx=n?n(t,e.props||{},(d,m,...g)=>{const p=g.length?g[0]:m;return u.ctx&&o(u.ctx[d],u.ctx[d]=p)&&(!u.skip_bound&&u.bound[d]&&u.bound[d](p),f&&Dn(t,d)),m}):[],u.update(),f=!0,re(u.before_update),u.fragment=l?l(u.ctx):!1,e.target){if(e.hydrate){const d=Un(e.target);u.fragment&&u.fragment.l(d),d.forEach(k)}else u.fragment&&u.fragment.c();e.intro&&G(t.$$.fragment),ie(t,e.target,e.anchor),It()}Ue(c)}class he{constructor(){Ze(this,"$$");Ze(this,"$$set")}$destroy(){ae(this,1),this.$destroy=B}$on(e,n){if(!ut(n))return B;const l=this.$$.callbacks[e]||(this.$$.callbacks[e]=[]);return l.push(n),()=>{const o=l.indexOf(n);o!==-1&&l.splice(o,1)}}$set(e){this.$$set&&!Rn(e)&&(this.$$.skip_bound=!0,this.$$set(e),this.$$.skip_bound=!1)}}const Bn="4",Ae=[];function He(t,e=B){let n;const l=new Set;function o(a){if(_e(t,a)&&(t=a,n)){const c=!Ae.length;for(const u of l)u[1](),Ae.push(u,t);if(c){for(let u=0;u<Ae.length;u+=2)Ae[u][0](Ae[u+1]);Ae.length=0}}}function r(a){o(a(t))}function i(a,c=B){const u=[a,c];return l.add(u),l.size===1&&(n=e(o,r)||B),a(t),()=>{l.delete(u),l.size===0&&n&&(n(),n=null)}}return{set:o,update:r,subscribe:i}}var Ke=(t=>(t.info="info",t.warn="warn",t.error="error",t))(Ke||{});class qn{constructor(){Ze(this,"logs",He([]))}_addLog(e,n){this.logs.update(l=>(l.unshift({date:new Date,severity:e,content:n}),l))}info(e){this._addLog("info",e)}warn(e){this._addLog("warn",e)}error(e){this._addLog("error",e)}updateLogAtIndex(e,n){this.logs.update(l=>(l[e]&&(l[e].content=n),l))}}const E=new qn;function Gn(t,e){let n=!1;return t.subscribe(l=>{n?e(l):n=!0})}const Fn={use_dark_theme:!0,rs_plugin_loader:!1,close_after_launch:!1,check_announcements:!0,flatpak_rich_presence:!1,runelite_use_custom_jar:!1,use_custom_rs_config_uri:!1,rs_launch_command:null,osrs_launch_command:null,runelite_custom_jar:null,runelite_launch_command:null,hdos_launch_command:null,selected:{game:ce.osrs,client:We.runelite,user_id:null},userDetails:{}};function Jn(){const e=new URLSearchParams(window.location.search).get("config");function n(o){return typeof o=="object"&&typeof o.use_dark_theme=="boolean"&&typeof o.rs_plugin_loader=="boolean"&&typeof o.close_after_launch=="boolean"&&typeof o.check_announcements=="boolean"&&typeof o.flatpak_rich_presence=="boolean"&&typeof o.runelite_use_custom_jar=="boolean"&&typeof o.selected=="object"&&Object.values(ce).includes(o.selected.game)&&Object.values(We).includes(o.selected.client)&&(typeof o.selected.user_id=="string"||o.selected.user_id===null)&&typeof o.userDetails=="object"}const{config:l}=A;if(e)try{const o=JSON.parse(e);typeof o.check_announcements>"u"&&(o.check_announcements=!0,A.configHasPendingChanges=!0),typeof o.close_after_launch>"u"&&(o.close_after_launch=!1,A.configHasPendingChanges=!0),n(o)?l.set(o):(E.error("The config saved on disk is not the correct format. It has been restored to default."),A.configHasPendingChanges=!0)}catch{E.error("Unable to parse config, restoring to default"),A.configHasPendingChanges=!0}else A.configHasPendingChanges=!0;Gn(A.config,()=>{A.configHasPendingChanges=!0})}const A={initialized:He(!1),configHasPendingChanges:!1,pluginConfigHasPendingChanges:!1,config:He(Fn),sessions:He([])};let vt=!1,yt=!1;class se{static async login(e,n){const l=await at.buildSession(e,n);if(!l.ok)return oe(l.error);const o=l.value,i=ve(A.sessions).findIndex(a=>a.user.userId===e.sub);return i!==-1?A.sessions.update(a=>(a[i]=o,a)):(A.sessions.update(a=>(a.push(o),a)),A.config.update(a=>(a.selected.user_id=o.user.userId,a))),Ce(o)}static async logout(e){const{sessions:n,config:l}=A;return n.update(o=>{const r=o.findIndex(i=>i.user.userId===e);return r>-1&&($e.revokeOauthCreds(o[r].tokens.access_token),o.splice(r,1)),o}),l.update(o=>(typeof o.userDetails[e]<"u"&&delete o.userDetails[e],o.selected.user_id===e&&(o.selected.user_id=null),o)),ve(n)}static postJSON(e,n,l=null){const o=JSON.stringify(n);return fetch(e,{method:"POST",body:o,headers:{"Content-Type":"application/json"}}).then(i=>{i.ok||i.text().then(a=>E.error(`${e} error: ${i.status}: ${a}`)),l&&l(i)})}static saveConfig(e=!0){if(vt||e&&!A.configHasPendingChanges)return;vt=!0;const n=ve(A.config);return n.rs_launch_command===""&&(n.rs_launch_command=null),n.osrs_launch_command===""&&(n.osrs_launch_command=null),n.runelite_launch_command===""&&(n.runelite_launch_command=null),n.hdos_launch_command===""&&(n.hdos_launch_command=null),this.postJSON("/save-config",n,()=>vt=!1),n}static savePluginConfig(e=!0){yt||e&&!A.pluginConfigHasPendingChanges||(yt=!0,this.postJSON("/save-plugin-config",U.pluginConfig,()=>yt=!1))}static async saveCredentials(){return this.postJSON("/save-credentials",ve(A.sessions))}static async openFilePicker(){const e=await fetch("/jar-file-picker");return e.status===200?e.text():null}static findSession(e){return ve(A.sessions).find(l=>l.user.userId===e)}static findAccount(e,n){return e.find(l=>l.accountId==n)}}const Tt=He([]),$t=He(null);typeof window<"u"&&(window.__svelte||(window.__svelte={v:new Set})).v.add(Bn);function Wn(t){let e,n;const l=t[4].default,o=dt(l,t,t[3],null);return{c(){e=h("main"),o&&o.c(),_(e,"class","fixed top-0 h-screen w-screen bg-slate-100 text-xs text-slate-900 duration-200 sm:text-sm md:text-base dark:bg-slate-900 dark:text-slate-50"),ue(e,"dark",t[0])},m(r,i){v(r,e,i),o&&o.m(e,null),n=!0},p(r,[i]){o&&o.p&&(!n||i&8)&&pt(o,l,r,r[3],n?ft(l,r[3],i,null):_t(r[3]),null),(!n||i&1)&&ue(e,"dark",r[0])},i(r){n||(G(o,r),n=!0)},o(r){J(o,r),n=!1},d(r){r&&k(e),o&&o.d(r)}}}function Xn(t,e,n){let l,o,{$$slots:r={},$$scope:i}=e;const{config:a}=A;return ke(t,a,c=>n(2,o=c)),t.$$set=c=>{"$$scope"in c&&n(3,i=c.$$scope)},t.$$.update=()=>{t.$$.dirty&4&&n(0,l=o.use_dark_theme)},[l,a,o,i,r]}class bn extends he{constructor(e){super(),me(this,e,Xn,Wn,_e,{})}}function zn(t){let e;return{c(){e=h("div"),e.innerHTML='<img class="h-60 w-60 animate-spin" src="svgs/circle-notch-solid.svg" alt="loading"/>',_(e,"class","flex h-full items-center justify-center")},m(n,l){v(n,e,l)},p:B,d(n){n&&k(e)}}}function Vn(t){let e,n;return e=new bn({props:{$$slots:{default:[zn]},$$scope:{ctx:t}}}),{c(){de(e.$$.fragment)},m(l,o){ie(e,l,o),n=!0},p(l,[o]){const r={};o&32&&(r.$$scope={dirty:o,ctx:l}),e.$set(r)},i(l){n||(G(e.$$.fragment,l),n=!0)},o(l){J(e.$$.fragment,l),n=!1},d(l){ae(e,l)}}}function Yn(t){const e=window.opener;U.env==null&&o("BoltEnv is not defined. Please close and re-open Bolt to try again.");async function n(i){const a=Fe.get("auth_verifier");if(!a)return o("Verifier token has expired. Please try signing in again."),null;const{clientid:c,redirect:u}=U.env,f=await $e.getOAuthToken(U.env.origin,c,a,u,i);return f.ok?f.value:(o(`Fetching OAuth token failed. ${f.error}`),null)}async function l(i){const a=Fe.get("auth_nonce"),c=$e.validateIdToken(i,a??"");if(!c.ok)return o(c.error),null;const u=await $e.getSessionId(U.env.auth_api,i);return u.ok?u.value:(o(`Unable to retreive session id. ${u.error}`),null)}function o(i){r({type:"authFailed",reason:i}),fetch("/close")}function r(i){e.postMessage(i,window.location.origin)}return mn(async()=>{const i=new URLSearchParams(window.location.search),a=i.get("code"),c=i.get("state"),u=i.get("id_token");if(u==null&&a&&c){const f=await n(a);if(!f)return o("tokens object is null.");r({type:"authTokenUpdate",tokens:f});const d=crypto.randomUUID();$e.navigateToAuthConsent(U.env.origin,f.id_token,d)}else if(u&&a&&c){const f=await l(u);if(!f)return o("sessionId is null");r({type:"authSessionUpdate",sessionId:f}),fetch("/close")}else o("Authentication server did not response with the appropriate parameters. Please try again later.")}),Hn(()=>{Fe.remove("auth_verifier"),Fe.remove("auth_nonce")}),[]}class Zn extends he{constructor(e){super(),me(this,e,Yn,Vn,_e,{})}}function Et(t){let e,n,l;return{c(){e=h("button"),e.innerHTML='<img src="svgs/xmark-solid.svg" class="h-5 w-5" alt="Close"/>',_(e,"class","absolute right-3 top-3 rounded-full bg-rose-500 p-[2px] shadow-lg duration-200 hover:rotate-90 hover:opacity-75")},m(o,r){v(o,e,r),n||(l=M(e,"click",t[2]),n=!0)},p:B,d(o){o&&k(e),n=!1,l()}}}function Nt(t){let e;const n=t[7].default,l=dt(n,t,t[6],null);return{c(){l&&l.c()},m(o,r){l&&l.m(o,r),e=!0},p(o,r){l&&l.p&&(!e||r&64)&&pt(l,n,o,o[6],e?ft(n,o[6],r,null):_t(o[6]),null)},i(o){e||(G(l,o),e=!0)},o(o){J(l,o),e=!1},d(o){l&&l.d(o)}}}function Kn(t){let e,n,l,o,r,i,a=t[1]&&Et(t),c=t[4]&&Nt(t);return{c(){e=h("dialog"),a&&a.c(),n=L(),c&&c.c(),_(e,"class",l=t[0]+" backdrop max-h-[90%] max-w-[90%] overflow-auto rounded-xl text-inherit focus-visible:outline-none svelte-csux1e"),ue(e,"backdrop:cursor-pointer",t[1])},m(u,f){v(u,e,f),a&&a.m(e,null),w(e,n),c&&c.m(e,null),t[8](e),o=!0,r||(i=[M(e,"keydown",t[9]),M(e,"mousedown",Tn(t[10]))],r=!0)},p(u,[f]){u[1]?a?a.p(u,f):(a=Et(u),a.c(),a.m(e,n)):a&&(a.d(1),a=null),u[4]?c?(c.p(u,f),f&16&&G(c,1)):(c=Nt(u),c.c(),G(c,1),c.m(e,null)):c&&(et(),J(c,1,1,()=>{c=null}),tt()),(!o||f&1&&l!==(l=u[0]+" backdrop max-h-[90%] max-w-[90%] overflow-auto rounded-xl text-inherit focus-visible:outline-none svelte-csux1e"))&&_(e,"class",l),(!o||f&3)&&ue(e,"backdrop:cursor-pointer",u[1])},i(u){o||(G(c),o=!0)},o(u){J(c),o=!1},d(u){u&&k(e),a&&a.d(),c&&c.d(),t[8](null),r=!1,re(i)}}}function Qn(t,e,n){let{$$slots:l={},$$scope:o}=e,{class:r=""}=e,{canSelfClose:i=!0}=e,a,c=!1;const u=xn();function f(){a.showModal(),n(4,c=!0)}function d(){u("close"),a.close(),n(4,c=!1)}function m(y){Le[y?"unshift":"push"](()=>{a=y,n(3,a)})}const g=y=>{y.key==="Escape"&&(y.preventDefault(),i&&d())},p=()=>{i&&d()};return t.$$set=y=>{"class"in y&&n(0,r=y.class),"canSelfClose"in y&&n(1,i=y.canSelfClose),"$$scope"in y&&n(6,o=y.$$scope)},[r,i,d,a,c,f,o,l,m,g,p]}class mt extends he{constructor(e){super(),me(this,e,Qn,Kn,_e,{class:0,canSelfClose:1,open:5,close:2})}get open(){return this.$$.ctx[5]}get close(){return this.$$.ctx[2]}}function es(t){let e,n,l,o,r,i,a;return{c(){e=h("p"),e.textContent=`${atob("Qm9sdCBpcyBhbiB1bm9mZmljaWFsIHRoaXJkLXBhcnR5IGxhdW5jaGVyLiBJdCdzIGZyZWUgYW5kIG9wZW4tc291cmNlIHNvZnR3YXJlIGxpY2Vuc2VkIHVuZGVyIEFHUEwgMy4wLg==")}`,n=L(),l=h("p"),l.textContent=`${atob("SmFnZXggaXMgbm90IHJlc3BvbnNpYmxlIGZvciBhbnkgcHJvYmxlbXMgb3IgZGFtYWdlIGNhdXNlZCBieSB1c2luZyB0aGlzIHByb2R1Y3Qu")}`,o=L(),r=h("button"),r.textContent="I Understand",_(e,"class","p-2"),_(l,"class","p-2"),_(r,"class","m-5 rounded-lg border-2 border-blue-500 p-2 duration-200 hover:opacity-75")},m(c,u){v(c,e,u),v(c,n,u),v(c,l,u),v(c,o,u),v(c,r,u),i||(a=M(r,"click",t[2]),i=!0)},p:B,d(c){c&&(k(e),k(n),k(l),k(o),k(r)),i=!1,a()}}}function ts(t){let e,n,l={canSelfClose:!1,class:"w-1/2 text-center",$$slots:{default:[es]},$$scope:{ctx:t}};return e=new mt({props:l}),t[3](e),{c(){de(e.$$.fragment)},m(o,r){ie(e,o,r),n=!0},p(o,[r]){const i={};r&33&&(i.$$scope={dirty:r,ctx:o}),e.$set(i)},i(o){n||(G(e.$$.fragment,o),n=!0)},o(o){J(e.$$.fragment,o),n=!1},d(o){t[3](null),ae(e,o)}}}function ns(t,e,n){let l;const{sessions:o}=A;ke(t,o,c=>n(4,l=c));let r;mn(()=>{l.length==0&&r.open()});const i=()=>r.close();function a(c){Le[c?"unshift":"push"](()=>{r=c,n(0,r)})}return[r,o,i,a]}class ss extends he{constructor(e){super(),me(this,e,ns,ts,_e,{})}}function ls(t,e,n){se.saveConfig();const l=(a,c)=>{const u=new XMLHttpRequest,f={},d=ve(A.config);a&&(f.hash=a),t&&(f.jx_session_id=t),e&&(f.jx_character_id=e),n&&(f.jx_display_name=n),d.rs_launch_command&&d.rs_launch_command!==""&&(f.launch_command=d.rs_launch_command),d.rs_plugin_loader&&(f.plugin_loader="1"),d.use_custom_rs_config_uri&&d.rs_config_uri?f.config_uri=d.rs_config_uri:f.config_uri=U.env.default_config_uri,u.open("POST","/launch-rs3-deb?".concat(new URLSearchParams(f).toString()),!0),u.onreadystatechange=()=>{u.readyState==4&&(E.info(`Game launch status: '${u.responseText.trim()}'`),u.status==200&&(a&&(U.rs3DebInstalledHash=a),d.close_after_launch&&!d.rs_plugin_loader&&fetch("/close")))},u.send(c)},o=new XMLHttpRequest,r=U.env.content_url,i=r.concat("dists/trusty/non-free/binary-amd64/Packages");o.open("GET",i,!0),o.onreadystatechange=()=>{if(o.readyState==4&&o.status==200){const a=Object.fromEntries(o.response.split(`
`).map(c=>c.split(": ")));if(!a.Filename||!a.Size){E.error(`Could not parse package data from URL: ${i}`),l();return}if(a.SHA256!==U.rs3DebInstalledHash){E.info("Downloading RS3 client...");const c=new XMLHttpRequest;c.open("GET",r.concat(a.Filename),!0),c.responseType="arraybuffer",c.onprogress=u=>{if(u.loaded){const f=(Math.round(1e3*u.loaded/u.total)/10).toFixed(1);E.updateLogAtIndex(0,`Downloading RS3 client... ${f}%`)}},c.onreadystatechange=()=>{c.readyState==4&&c.status==200&&l(a.SHA256,c.response)},c.onerror=()=>{E.error(`Error downloading game client: from ${i}: non-http error`),l()},c.send()}else E.info("Latest client is already installed"),l()}},o.onerror=()=>{E.error(`Error: from ${i}: non-http error`),l()},o.send()}function kn(t,e,n,l){se.saveConfig();const o=l?"/launch-runelite-jar-configure?":"/launch-runelite-jar?",r=ve(A.config),i=(f,d,m)=>{const g=new XMLHttpRequest,p={};f&&(p.id=f),m&&(p.jar_path=m),t&&(p.jx_session_id=t),e&&(p.jx_character_id=e),n&&(p.jx_display_name=n),r.runelite_launch_command&&r.runelite_launch_command!==""&&(p.launch_command=r.runelite_launch_command),r.flatpak_rich_presence&&(p.flatpak_rich_presence=""),g.open(d?"POST":"GET",o.concat(new URLSearchParams(p).toString()),!0),g.onreadystatechange=()=>{g.readyState==4&&(E.info(`Game launch status: '${g.responseText.trim()}'`),g.status==200&&(f&&(U.runeLiteInstalledId=f),r.close_after_launch&&!l&&fetch("/close")))},g.send(d)};if(r.runelite_use_custom_jar){i(null,null,r.runelite_custom_jar);return}const a=2*60*1e3;if(U.runeLiteInstalledId!==null){const f=ve($t);if(f!==null&&f+a>Date.now()){i();return}}const c=new XMLHttpRequest;c.open("GET","https://api.github.com/repos/runelite/launcher/releases",!0),c.onreadystatechange=()=>{if(c.readyState==4)if(c.status==200){const f=JSON.parse(c.responseText).map(d=>d.assets).flat().find(d=>d.name.toLowerCase()=="runelite.jar");if(f.id!=U.runeLiteInstalledId){E.info("Downloading RuneLite...");const d=new XMLHttpRequest;d.open("GET",f.browser_download_url,!0),d.responseType="arraybuffer",d.onreadystatechange=()=>{d.readyState==4&&(d.status==200?($t.set(Date.now()),i(f.id,d.response)):E.error(`Error downloading from ${f.url}: ${d.status}: ${d.responseText}`))},d.onprogress=m=>{if(m.loaded&&m.lengthComputable){const g=(Math.round(1e3*m.loaded/m.total)/10).toFixed(1);E.updateLogAtIndex(0,`Downloading RuneLite... ${g}%`)}},d.send()}else $t.set(Date.now()),i()}else E.error(`Failed to check for RuneLite updates: ${c.status}: ${c.responseText}`),i()},c.send()}function os(t,e,n){se.saveConfig();const l=ve(A.config),o=(a,c)=>{const u=new XMLHttpRequest,f={};a&&(f.version=a),t&&(f.jx_session_id=t),e&&(f.jx_character_id=e),n&&(f.jx_display_name=n),l.hdos_launch_command&&l.hdos_launch_command!==""&&(f.launch_command=l.hdos_launch_command),u.open("POST","/launch-hdos-jar?".concat(new URLSearchParams(f).toString()),!0),u.onreadystatechange=()=>{u.readyState==4&&(E.info(`Game launch status: '${u.responseText.trim()}'`),u.status==200&&(a&&(U.hdosInstalledVersion=a),l.close_after_launch&&fetch("/close")))},u.send(c)},r=new XMLHttpRequest,i="https://cdn.hdos.dev/client/getdown.txt";r.open("GET",i,!0),r.onreadystatechange=()=>{if(r.readyState==4)if(r.status==200){const a=r.responseText.match(/^launcher\.version *= *(.*?)$/m);if(a&&a.length>=2){const c=a[1];if(c!==U.hdosInstalledVersion){const u=`https://cdn.hdos.dev/launcher/v${c}/hdos-launcher.jar`;E.info("Downloading HDOS...");const f=new XMLHttpRequest;f.open("GET",u,!0),f.responseType="arraybuffer",f.onreadystatechange=()=>{if(f.readyState==4)if(f.status==200)o(c,f.response);else{const d=JSON.parse(r.responseText).map(m=>m.assets).flat().find(m=>m.name.toLowerCase()=="runelite.jar");E.error(`Error downloading from ${d.url}: ${f.status}: ${f.responseText}`)}},f.onprogress=d=>{if(d.loaded&&d.lengthComputable){const m=(Math.round(1e3*d.loaded/d.total)/10).toFixed(1);E.updateLogAtIndex(0,`Downloading HDOS... ${m}%`)}},f.send()}else E.info("Latest JAR is already installed"),o()}else E.info("Couldn't parse latest launcher version"),o()}else E.error(`Error from ${i}: ${r.status}: ${r.responseText}`)},r.send()}function St(){const t=new XMLHttpRequest;t.open("GET","/list-game-clients",!0),t.onreadystatechange=()=>{t.readyState==4&&t.status!=200&&E.error(`Error requesting client list: ${t.status}: ${t.responseText}`)},t.send()}async function jt(t,e,n,l,o){se.saveConfig();const r=`${e?"osrs":U.env.provider}-${t?"win":"mac"}`;let i=t?e?U.osrsExeInstalledHash:U.rs3ExeInstalledHash:e?U.osrsAppInstalledHash:U.rs3AppInstalledHash;const a=async($,H)=>{const x={},N=ve(A.config),ee=e?N.osrs_launch_command:N.rs_launch_command;$&&(x.hash=$),n&&(x.jx_session_id=n),l&&(x.jx_character_id=l),o&&(x.jx_display_name=o),ee&&ee!==""&&(x.launch_command=ee),e||(N.rs_plugin_loader&&(x.plugin_loader="1"),x.config_uri=N.use_custom_rs_config_uri&&N.rs_config_uri?N.rs_config_uri:U.env.default_config_uri);const Y=await fetch(`/launch-${e?"osrs":"rs3"}-${t?"exe":"app"}?${new URLSearchParams(x).toString()}`,{method:"POST",headers:{"Content-Type":"application/octet-stream"},body:await H});Y.text().then(W=>E.info(`Game launch status: '${W.trim()}'`)),Y.status==200&&($&&(i=$),N.close_after_launch&&(e||!N.rs_plugin_loader)&&fetch("/close"))},c=`${U.env.direct6_url}${r}/${r}.json`,u=await fetch(c,{method:"GET"}),f=await u.text();if(u.status!==200){E.error(`Error from ${c}: ${u.status}: ${f}`);return}const d=JSON.parse(atob(f.split(".")[1])).environments.production;if(i===d.id){E.info("Latest client is already installed"),a();return}E.info(`Downloading client version ${d.version}`);const m=`${U.env.direct6_url}${r}/catalog/${d.id}/catalog.json`,g=await fetch(m,{method:"GET"}),p=await g.text();if(g.status!==200){E.error(`Error from ${m}: ${g.status}: ${p}`);return}const y=JSON.parse(atob(p.split(".")[1])),b=$=>$.replace(/^http:\/\/(.{5})-akamai\.aws\.snxd\.com\//i,"https://$1.akamaized.net/").replace(/^http:/i,"https:"),R=b(y.metafile),C=await fetch(R,{method:"GET"}),D=await C.text();if(C.status!==200){E.error(`Error from ${R}: ${C.status}: ${D}`);return}const O=JSON.parse(atob(D.split(".")[1])),I=O.pieces.digests.map($=>{const H=atob($).split("").map(N=>N.charCodeAt(0).toString(16).padStart(2,"0")).join(""),x=b(y.config.remote.baseUrl).concat(y.config.remote.pieceFormat.replace("{SubString:0,2,{TargetDigest}}",H.substring(0,2)).replace("{TargetDigest}",H));return fetch(x,{method:"GET"}).then(N=>N.blob().then(ee=>{const Y=new DecompressionStream("gzip");return new Response(ee.slice(6).stream().pipeThrough(Y)).blob()}))});let P=0,S=null;for(let $=0;$<O.files.length;$+=1)if(t?O.files[$].name.endsWith(".exe"):O.files[$].name.includes(".app/Contents/MacOS/"))if(S!==null){E.error(`Error parsing ${R}: file list has multiple possibilities for main exe`);return}else S=O.files[$].size;else S===null&&(P+=O.files[$].size);if(S===null){E.error(`Error parsing ${R}: file list has no possibilities for main exe`);return}Promise.all(I).then($=>{const H=new Blob($).slice(P,P+S);a(O.id,H.arrayBuffer())})}function Mt(t,e,n){const l=t.slice();return l[48]=e[n],l}function At(t,e,n){const l=t.slice();return l[51]=e[n],l}function Dt(t,e,n){const l=t.slice();return l[54]=e[n][0],l[47]=e[n][1],l}function Bt(t,e,n){const l=t.slice();return l[48]=e[n],l}function rs(t){let e,n=ge(t[5]),l=[];for(let o=0;o<n.length;o+=1)l[o]=qt(Bt(t,n,o));return{c(){for(let o=0;o<l.length;o+=1)l[o].c();e=Pe()},m(o,r){for(let i=0;i<l.length;i+=1)l[i]&&l[i].m(o,r);v(o,e,r)},p(o,r){if(r[0]&14628){n=ge(o[5]);let i;for(i=0;i<n.length;i+=1){const a=Bt(o,n,i);l[i]?l[i].p(a,r):(l[i]=qt(a),l[i].c(),l[i].m(e.parentNode,e))}for(;i<l.length;i+=1)l[i].d(1);l.length=n.length}},d(o){o&&k(e),je(l,o)}}}function is(t){let e;return{c(){e=h("p"),e.textContent="(start an RS3 game client with plugins enabled and it will be listed here.)"},m(n,l){v(n,e,l)},p:B,d(n){n&&k(e)}}}function qt(t){let e,n=(t[48].identity||Kt)+"",l,o,r,i,a,c;function u(){return t[24](t[48])}return{c(){e=h("button"),l=F(n),r=L(),i=h("br"),_(e,"class",o="m-1 h-[28px] w-[95%] select-none rounded-lg border-2 "+(t[11]&&t[2]===t[48].uid?"border-black bg-blue-500 text-black":"border-blue-500 text-black dark:text-white")+" hover:opacity-75")},m(f,d){v(f,e,d),w(e,l),v(f,r,d),v(f,i,d),a||(c=M(e,"click",u),a=!0)},p(f,d){t=f,d[0]&32&&n!==(n=(t[48].identity||Kt)+"")&&pe(l,n),d[0]&2084&&o!==(o="m-1 h-[28px] w-[95%] select-none rounded-lg border-2 "+(t[11]&&t[2]===t[48].uid?"border-black bg-blue-500 text-black":"border-blue-500 text-black dark:text-white")+" hover:opacity-75")&&_(e,"class",o)},d(f){f&&(k(e),k(r),k(i)),a=!1,c()}}}function as(t){let e;return{c(){e=h("p"),e.textContent="error"},m(n,l){v(n,e,l)},p:B,d(n){n&&k(e)}}}function cs(t){let e,n,l,o,r,i=ge(Object.entries(t[0].pluginConfig)),a=[];for(let d=0;d<i.length;d+=1)a[d]=Gt(Dt(t,i,d));function c(d,m){return d[11]?us:ds}let u=c(t),f=u(t);return{c(){e=h("select");for(let d=0;d<a.length;d+=1)a[d].c();n=L(),f.c(),l=Pe(),_(e,"class","mx-auto mb-4 w-[min(280px,_45%)] cursor-pointer rounded-lg border-2 border-slate-300 bg-inherit p-2 text-inherit duration-200 hover:opacity-75 dark:border-slate-800"),t[1]===void 0&&ze(()=>t[25].call(e))},m(d,m){v(d,e,m);for(let g=0;g<a.length;g+=1)a[g]&&a[g].m(e,null);xe(e,t[1],!0),v(d,n,m),f.m(d,m),v(d,l,m),o||(r=[M(e,"change",t[25]),M(e,"change",t[26])],o=!0)},p(d,m){if(m[0]&1){i=ge(Object.entries(d[0].pluginConfig));let g;for(g=0;g<i.length;g+=1){const p=Dt(d,i,g);a[g]?a[g].p(p,m):(a[g]=Gt(p),a[g].c(),a[g].m(e,null))}for(;g<a.length;g+=1)a[g].d(1);a.length=i.length}m[0]&3&&xe(e,d[1]),u===(u=c(d))&&f?f.p(d,m):(f.d(1),f=u(d),f&&(f.c(),f.m(l.parentNode,l)))},d(d){d&&(k(e),k(n),k(l)),je(a,d),f.d(d),o=!1,re(r)}}}function Gt(t){let e,n=(t[47].name??Ve)+"",l,o;return{c(){e=h("option"),l=F(n),_(e,"class","dark:bg-slate-900"),e.__value=o=t[54],Q(e,e.__value)},m(r,i){v(r,e,i),w(e,l)},p(r,i){i[0]&1&&n!==(n=(r[47].name??Ve)+"")&&pe(l,n),i[0]&1&&o!==(o=r[54])&&(e.__value=o,Q(e,e.__value))},d(r){r&&k(e)}}}function us(t){let e,n,l,o,r={ctx:t,current:null,token:null,hasCatch:!0,pending:ks,then:ps,catch:fs,value:47};return ct(o=t[4],r),{c(){e=h("br"),n=L(),l=Pe(),r.block.c()},m(i,a){v(i,e,a),v(i,n,a),v(i,l,a),r.block.m(i,r.anchor=a),r.mount=()=>l.parentNode,r.anchor=l},p(i,a){t=i,r.ctx=t,a[0]&16&&o!==(o=t[4])&&ct(o,r)||hn(r,t,a)},d(i){i&&(k(e),k(n),k(l)),r.block.d(i),r.token=null,r=null}}}function ds(t){let e,n,l,o,r,i,a,c,u,f,d,m,g,p,y,b,R,C=t[12]&&Xt(t);function D(P,S){return S[0]&1&&(p=null),p==null&&(p=Object.entries(P[0].pluginConfig).length!==0),p?vs:ws}let O=D(t,[-1,-1]),I=O(t);return{c(){e=h("span"),n=h("button"),l=h("img"),i=L(),a=h("button"),c=h("img"),f=L(),d=h("br"),m=L(),C&&C.c(),g=L(),I.c(),y=Pe(),Rt(l.src,o="svgs/download-solid.svg")||_(l,"src",o),_(l,"alt","Install plugin from updater URL"),_(n,"class","mx-1 aspect-square w-9 select-none rounded-md bg-blue-500 p-1 text-[20px] font-bold duration-200 enabled:hover:opacity-75 disabled:bg-gray-500"),n.disabled=r=!t[0].hasLibArchive||t[10],_(n,"title","Install plugin from updater URL"),Rt(c.src,u="svgs/folder-solid.svg")||_(c,"src",u),_(c,"alt","Install plugin from local directory"),_(a,"class","aspect-square w-9 select-none rounded-md bg-blue-500 p-1 text-[20px] font-bold duration-200 enabled:hover:opacity-75 disabled:bg-gray-500"),a.disabled=t[10],_(a,"title","Install plugin from local directory"),_(e,"class","align-middle")},m(P,S){v(P,e,S),w(e,n),w(n,l),w(e,i),w(e,a),w(a,c),v(P,f,S),v(P,d,S),v(P,m,S),C&&C.m(P,S),v(P,g,S),I.m(P,S),v(P,y,S),b||(R=[M(n,"click",t[27]),M(a,"click",t[17])],b=!0)},p(P,S){S[0]&1025&&r!==(r=!P[0].hasLibArchive||P[10])&&(n.disabled=r),S[0]&1024&&(a.disabled=P[10]),P[12]?C?C.p(P,S):(C=Xt(P),C.c(),C.m(g.parentNode,g)):C&&(C.d(1),C=null),O===(O=D(P,S))&&I?I.p(P,S):(I.d(1),I=O(P),I&&(I.c(),I.m(y.parentNode,y)))},d(P){P&&(k(e),k(f),k(d),k(m),k(g),k(y)),C&&C.d(P),I.d(P),b=!1,re(R)}}}function fs(t){let e;return{c(){e=h("p"),e.textContent="error"},m(n,l){v(n,e,l)},p:B,d(n){n&&k(e)}}}function ps(t){let e,n,l,o,r,i,a,c,u,f;function d(b,R){return R[0]&19&&(e=null),R[0]&1&&(n=null),e==null&&(e=!!(b[47]&&b[47].main&&Object.keys(b[0].pluginConfig).includes(b[1]))),e?ms:(n==null&&(n=Object.entries(b[0].pluginConfig).length===0),n?gs:_s)}let m=d(t,[-1,-1]),g=m(t),p=ge(t[5]),y=[];for(let b=0;b<p.length;b+=1)y[b]=Wt(Mt(t,p,b));return{c(){g.c(),l=L(),o=h("br"),r=L(),i=h("br"),a=L(),c=h("hr"),u=L();for(let b=0;b<y.length;b+=1)y[b].c();f=Pe(),_(c,"class","p-1 dark:border-slate-700")},m(b,R){g.m(b,R),v(b,l,R),v(b,o,R),v(b,r,R),v(b,i,R),v(b,a,R),v(b,c,R),v(b,u,R);for(let C=0;C<y.length;C+=1)y[C]&&y[C].m(b,R);v(b,f,R)},p(b,R){if(m===(m=d(b,R))&&g?g.p(b,R):(g.d(1),g=m(b),g&&(g.c(),g.m(l.parentNode,l))),R[0]&524325){p=ge(b[5]);let C;for(C=0;C<p.length;C+=1){const D=Mt(b,p,C);y[C]?y[C].p(D,R):(y[C]=Wt(D),y[C].c(),y[C].m(f.parentNode,f))}for(;C<y.length;C+=1)y[C].d(1);y.length=p.length}},d(b){b&&(k(l),k(o),k(r),k(i),k(a),k(c),k(u),k(f)),g.d(b),je(y,b)}}}function _s(t){let e;return{c(){e=h("p"),e.textContent="can't start plugin: does not appear to be configured"},m(n,l){v(n,e,l)},p:B,d(n){n&&k(e)}}}function gs(t){let e;return{c(){e=h("p"),e.textContent="(no plugins installed)"},m(n,l){v(n,e,l)},p:B,d(n){n&&k(e)}}}function ms(t){let e,n,l=t[47].name+"",o,r,i;function a(){return t[35](t[47])}return{c(){e=h("button"),n=F("Start "),o=F(l),_(e,"class","mx-auto mb-1 w-auto select-none rounded-lg bg-emerald-500 p-2 font-bold text-black duration-200 hover:opacity-75")},m(c,u){v(c,e,u),w(e,n),w(e,o),r||(i=M(e,"click",a),r=!0)},p(c,u){t=c,u[0]&16&&l!==(l=t[47].name+"")&&pe(o,l)},d(c){c&&k(e),r=!1,i()}}}function Ft(t){let e,n=ge(t[48].plugins),l=[];for(let o=0;o<n.length;o+=1)l[o]=Jt(At(t,n,o));return{c(){for(let o=0;o<l.length;o+=1)l[o].c();e=Pe()},m(o,r){for(let i=0;i<l.length;i+=1)l[i]&&l[i].m(o,r);v(o,e,r)},p(o,r){if(r[0]&524325){n=ge(o[48].plugins);let i;for(i=0;i<n.length;i+=1){const a=At(o,n,i);l[i]?l[i].p(a,r):(l[i]=Jt(a),l[i].c(),l[i].m(e.parentNode,e))}for(;i<l.length;i+=1)l[i].d(1);l.length=n.length}},d(o){o&&k(e),je(l,o)}}}function hs(t){let e,n=t[51].id+"",l;return{c(){e=h("p"),l=F(n)},m(o,r){v(o,e,r),w(e,l)},p(o,r){r[0]&32&&n!==(n=o[51].id+"")&&pe(l,n)},d(o){o&&k(e)}}}function bs(t){let e,n=(t[0].pluginConfig[t[51].id].name??t[51].id)+"",l,o,r,i,a,c;function u(){return t[36](t[51])}return{c(){e=h("p"),l=F(n),o=L(),r=h("button"),r.innerHTML='<img src="svgs/xmark-solid.svg" class="h-4 w-4" alt="Close"/>',i=L(),_(r,"class","select-none rounded-sm bg-rose-500 shadow-lg hover:opacity-75")},m(f,d){v(f,e,d),w(e,l),w(e,o),w(e,r),w(e,i),a||(c=M(r,"click",u),a=!0)},p(f,d){t=f,d[0]&33&&n!==(n=(t[0].pluginConfig[t[51].id].name??t[51].id)+"")&&pe(l,n)},d(f){f&&k(e),a=!1,c()}}}function Jt(t){let e,n;function l(i,a){return a[0]&33&&(e=null),e==null&&(e=!!Object.keys(i[0].pluginConfig).includes(i[51].id)),e?bs:hs}let o=l(t,[-1,-1]),r=o(t);return{c(){r.c(),n=Pe()},m(i,a){r.m(i,a),v(i,n,a)},p(i,a){o===(o=l(i,a))&&r?r.p(i,a):(r.d(1),r=o(i),r&&(r.c(),r.m(n.parentNode,n)))},d(i){i&&k(n),r.d(i)}}}function Wt(t){let e,n=t[48].uid===t[2]&&Ft(t);return{c(){n&&n.c(),e=Pe()},m(l,o){n&&n.m(l,o),v(l,e,o)},p(l,o){l[48].uid===l[2]?n?n.p(l,o):(n=Ft(l),n.c(),n.m(e.parentNode,e)):n&&(n.d(1),n=null)},d(l){l&&k(e),n&&n.d(l)}}}function ks(t){let e;return{c(){e=h("p"),e.textContent="loading..."},m(n,l){v(n,e,l)},p:B,d(n){n&&k(e)}}}function Xt(t){let e,n,l,o,r,i,a,c,u,f,d,m;return{c(){e=h("label"),e.textContent="URL:",n=L(),l=h("textarea"),o=L(),r=h("button"),r.innerHTML='<img src="svgs/check-solid.svg" class="h-5 w-5" alt="Confirm"/>',i=L(),a=h("button"),a.innerHTML='<img src="svgs/xmark-solid.svg" class="h-5 w-5" alt="Close"/>',c=L(),u=h("br"),f=h("br"),_(e,"for","plugin-updater-url-input"),_(l,"rows","1"),_(l,"id","plugin-updater-url-input"),_(l,"class","w-[50%] max-w-[60%] resize-x rounded border-2 border-slate-300 bg-slate-100 text-slate-950 dark:border-slate-800"),_(r,"title","Confirm"),_(r,"class","select-none rounded-sm bg-emerald-500 hover:opacity-75"),_(a,"title","Close URL entry"),_(a,"class","select-none rounded-sm bg-rose-500 hover:opacity-75")},m(g,p){v(g,e,p),v(g,n,p),v(g,l,p),Q(l,t[13]),v(g,o,p),v(g,r,p),v(g,i,p),v(g,a,p),v(g,c,p),v(g,u,p),v(g,f,p),d||(m=[M(l,"input",t[28]),M(r,"click",t[29]),M(a,"click",t[30])],d=!0)},p(g,p){p[0]&8192&&Q(l,g[13])},d(g){g&&(k(e),k(n),k(l),k(o),k(r),k(i),k(a),k(c),k(u),k(f)),d=!1,re(m)}}}function ws(t){let e;return{c(){e=h("p"),e.textContent=`You have no plugins installed. You can install plugins either from an updater URL, or by
						downloading them onto your computer and selecting the "bolt.json" file.`},m(n,l){v(n,e,l)},p:B,d(n){n&&k(e)}}}function vs(t){let e=Object.keys(t[0].pluginConfig).includes(t[1])&&t[4]!==null,n,l=e&&zt(t);return{c(){l&&l.c(),n=Pe()},m(o,r){l&&l.m(o,r),v(o,n,r)},p(o,r){r[0]&19&&(e=Object.keys(o[0].pluginConfig).includes(o[1])&&o[4]!==null),e?l?l.p(o,r):(l=zt(o),l.c(),l.m(n.parentNode,n)):l&&(l.d(1),l=null)},d(o){o&&k(n),l&&l.d(o)}}}function zt(t){let e,n,l,o,r,i,a,c,u,f,d,m,g={ctx:t,current:null,token:null,hasCatch:!0,pending:Ss,then:$s,catch:ys,value:47};ct(e=t[4],g);let p=t[3].updaterURL&&Yt(t);return{c(){g.block.c(),n=L(),l=h("button"),l.textContent="Browse data",o=F(`
						 
						`),r=h("button"),r.textContent="Browse config",i=L(),a=h("br"),c=L(),p&&p.c(),u=L(),f=h("button"),f.textContent="Remove",_(l,"class","mx-auto mb-1 w-[min(144px,_25%)] select-none rounded-lg bg-blue-500 p-2 font-bold text-black duration-200 hover:opacity-75"),_(r,"class","mx-auto mb-1 w-[min(144px,_25%)] select-none rounded-lg bg-blue-500 p-2 font-bold text-black duration-200 hover:opacity-75"),_(f,"class","m-1 mx-auto w-[min(144px,_25%)] select-none rounded-lg p-2 font-bold text-black duration-200 enabled:bg-rose-500 enabled:hover:opacity-75 disabled:bg-gray-500")},m(y,b){g.block.m(y,g.anchor=b),g.mount=()=>n.parentNode,g.anchor=n,v(y,n,b),v(y,l,b),v(y,o,b),v(y,r,b),v(y,i,b),v(y,a,b),v(y,c,b),p&&p.m(y,b),v(y,u,b),v(y,f,b),d||(m=[M(l,"click",t[31]),M(r,"click",t[32]),M(f,"click",t[34])],d=!0)},p(y,b){t=y,g.ctx=t,b[0]&16&&e!==(e=t[4])&&ct(e,g)||hn(g,t,b),t[3].updaterURL?p?p.p(t,b):(p=Yt(t),p.c(),p.m(u.parentNode,u)):p&&(p.d(1),p=null)},d(y){y&&(k(n),k(l),k(o),k(r),k(i),k(a),k(c),k(u),k(f)),g.block.d(y),g.token=null,g=null,p&&p.d(y),d=!1,re(m)}}}function ys(t){let e,n,l;return{c(){e=h("p"),e.textContent="error",n=L(),l=h("br")},m(o,r){v(o,e,r),v(o,n,r),v(o,l,r)},p:B,d(o){o&&(k(e),k(n),k(l))}}}function $s(t){let e,n=(t[47].name??Ve)+"",l,o,r,i,a=(t[47].description??"no description")+"",c,u,f,d,m=t[47].version&&Vt(t);return{c(){e=h("p"),l=F(n),o=L(),m&&m.c(),r=L(),i=h("p"),c=F(a),f=L(),d=h("br"),_(e,"class","pb-4 text-xl font-bold"),_(i,"class",u=t[47].description?null:"italic")},m(g,p){v(g,e,p),w(e,l),w(e,o),m&&m.m(e,null),v(g,r,p),v(g,i,p),w(i,c),v(g,f,p),v(g,d,p)},p(g,p){p[0]&16&&n!==(n=(g[47].name??Ve)+"")&&pe(l,n),g[47].version?m?m.p(g,p):(m=Vt(g),m.c(),m.m(e,null)):m&&(m.d(1),m=null),p[0]&16&&a!==(a=(g[47].description??"no description")+"")&&pe(c,a),p[0]&16&&u!==(u=g[47].description?null:"italic")&&_(i,"class",u)},d(g){g&&(k(e),k(r),k(i),k(f),k(d)),m&&m.d()}}}function Vt(t){let e,n,l,o,r=t[47].version+"",i;return{c(){e=h("br"),n=L(),l=h("span"),o=F("v"),i=F(r),_(l,"class","pb-4 text-xl font-bold italic text-slate-600")},m(a,c){v(a,e,c),v(a,n,c),v(a,l,c),w(l,o),w(l,i)},p(a,c){c[0]&16&&r!==(r=a[47].version+"")&&pe(i,r)},d(a){a&&(k(e),k(n),k(l))}}}function Ss(t){let e;return{c(){e=h("p"),e.textContent="loading..."},m(n,l){v(n,e,l)},p:B,d(n){n&&k(e)}}}function Yt(t){let e,n,l,o;return{c(){e=h("button"),e.textContent="Check updates",n=F(`
							 `),_(e,"class","m-1 mx-auto w-[min(144px,_25%)] select-none rounded-lg p-2 font-bold text-black duration-200 enabled:bg-blue-500 enabled:hover:opacity-75 disabled:bg-gray-500")},m(r,i){v(r,e,i),v(r,n,i),l||(o=M(e,"click",t[33]),l=!0)},p:B,d(r){r&&(k(e),k(n)),l=!1,o()}}}function Zt(t){let e,n,l,o;function r(c,u){return c[9]?Ls:Cs}let i=r(t),a=i(t);return{c(){e=h("br"),n=h("br"),l=L(),a.c(),o=Pe()},m(c,u){v(c,e,u),v(c,n,u),v(c,l,u),a.m(c,u),v(c,o,u)},p(c,u){i===(i=r(c))&&a?a.p(c,u):(a.d(1),a=i(c),a&&(a.c(),a.m(o.parentNode,o)))},d(c){c&&(k(e),k(n),k(l),k(o)),a.d(c)}}}function Cs(t){let e,n,l;return{c(){e=h("p"),n=F("[info] "),l=F(t[8])},m(o,r){v(o,e,r),w(e,n),w(e,l)},p(o,r){r[0]&256&&pe(l,o[8])},d(o){o&&k(e)}}}function Ls(t){let e,n,l;return{c(){e=h("p"),n=F("[error] "),l=F(t[8]),_(e,"class","text-red-500")},m(o,r){v(o,e,r),w(e,n),w(e,l)},p(o,r){r[0]&256&&pe(l,o[8])},d(o){o&&k(e)}}}function Rs(t){let e,n,l,o,r,i,a,c,u,f,d,m,g,p,y;function b(S,$){return S[5].length==0?is:rs}let R=b(t),C=R(t);function D(S,$){return S[0].hasBoltPlugins?cs:as}let O=D(t),I=O(t),P=t[8]&&Zt(t);return{c(){e=h("div"),n=h("button"),l=F("Manage Plugins"),r=L(),i=h("hr"),a=L(),C.c(),c=L(),u=h("div"),I.c(),f=L(),P&&P.c(),d=L(),m=h("div"),g=h("button"),g.textContent="about plugins",_(n,"class",o="mx-auto mb-2 w-[95%] select-none rounded-lg border-2 "+(t[11]?"border-blue-500 text-black dark:text-white":"border-black bg-blue-500 text-black")+" p-2 font-bold hover:opacity-75"),_(i,"class","p-1 dark:border-slate-700"),_(e,"class","left-0 float-left h-full w-[min(180px,_50%)] overflow-hidden border-r-2 border-slate-300 pt-2 dark:border-slate-800"),_(u,"class","h-full pt-10"),_(g,"class","m-0 cursor-pointer select-none border-none bg-transparent p-0 text-sm text-gray-500 underline"),_(m,"class","absolute bottom-2 right-4")},m(S,$){v(S,e,$),w(e,n),w(n,l),w(e,r),w(e,i),w(e,a),C.m(e,null),v(S,c,$),v(S,u,$),I.m(u,null),w(u,f),P&&P.m(u,null),v(S,d,$),v(S,m,$),w(m,g),p||(y=[M(n,"click",t[23]),M(g,"click",t[21])],p=!0)},p(S,$){$[0]&2048&&o!==(o="mx-auto mb-2 w-[95%] select-none rounded-lg border-2 "+(S[11]?"border-blue-500 text-black dark:text-white":"border-black bg-blue-500 text-black")+" p-2 font-bold hover:opacity-75")&&_(n,"class",o),R===(R=b(S))&&C?C.p(S,$):(C.d(1),C=R(S),C&&(C.c(),C.m(e,null))),O===(O=D(S))&&I?I.p(S,$):(I.d(1),I=O(S),I&&(I.c(),I.m(u,f))),S[8]?P?P.p(S,$):(P=Zt(S),P.c(),P.m(u,null)):P&&(P.d(1),P=null)},d(S){S&&(k(e),k(c),k(u),k(d),k(m)),C.d(),I.d(),P&&P.d(),p=!1,re(y)}}}function Ps(t){let e,n,l={class:"h-[90%] w-[90%] text-center",$$slots:{default:[Rs]},$$scope:{ctx:t}};return e=new mt({props:l}),t[37](e),e.$on("close",t[38]),{c(){de(e.$$.fragment)},m(o,r){ie(e,o,r),n=!0},p(o,r){const i={};r[0]&32639|r[1]&268435456&&(i.$$scope={dirty:r,ctx:o}),e.$set(i)},i(o){n||(G(e.$$.fragment,o),n=!0)},o(o){J(e.$$.fragment,o),n=!1},d(o){t[37](null),ae(e,o)}}}const De="bolt.json",Ts="main.lua",Ve="(unnamed)",Kt="(new character)";function Us(t,e,n){let l,o,r,i;ke(t,Tt,T=>n(5,i=T));let a,c=null,u=!1;const f=U.platform==="windows"?"\\":"/",d=f.concat(De);function m(){n(12,W=!1),a.open()}const g=T=>{console.log(T),n(8,c=T),n(9,u=!1)},p=T=>{console.error(T),n(8,c=T),n(9,u=!0)},y=T=>new Promise((q,V)=>{const be=T.concat(T.endsWith(f)?De:d);var K=new XMLHttpRequest;K.onreadystatechange=()=>{K.readyState==4&&(K.status==200?q(JSON.parse(K.responseText)):V(K.responseText))},K.open("GET","/read-json-file?".concat(new URLSearchParams({path:be}).toString()),!0),K.send()}),b=T=>fetch("/get-plugindir-json?".concat(new URLSearchParams({id:T}).toString())).then(q=>q.ok?q.json():null),R=T=>{const V=U.pluginConfig[T];if(!V)return null;const be=V.path;return be?y(be):b(T)},C=()=>{const T=Object.keys(U.pluginConfig);let q;do q=crypto.randomUUID();while(T.includes(q));return q},D=(T,q)=>{y(T).then(V=>{n(1,x=C()),n(0,U.pluginConfig[x]={name:V.name??Ve,path:T,version:V.version},U),n(6,A.pluginConfigHasPendingChanges=!0,A)}).catch(V=>p(`config file '${q}' couldn't be fetched, reason: ${V}`))},O=T=>{g("downloading..."),fetch(T).then(async q=>{if(!q.ok){p(`can't install plugin: updater URL returned ${q.status}: ${q.statusText}`);return}const V=await q.json();if(V.url){const be=await fetch(V.url);if(!be.ok){p(`can't install plugin: remote download URL returned ${q.status}: ${q.statusText}`);return}const K=await be.arrayBuffer();if(V.sha256){const Ie=await crypto.subtle.digest("SHA-256",K),ht=Array.from(new Uint8Array(Ie)).map(bt=>bt.toString(16).padStart(2,"0")).join("");if(V.sha256!==ht){p("can't install plugin: incorrect file hash");return}}const we=C();if(!(await fetch("/install-plugin?".concat(new URLSearchParams({id:we}).toString()),{method:"POST",body:K})).ok){p(`can't install plugin: ${q.statusText}`);return}const Ee=await b(we);Ee?(n(1,x=we),n(0,U.pluginConfig[x]={name:Ee.name??Ve,version:Ee.version,updaterURL:T,sha256:V.sha256},U),n(6,A.pluginConfigHasPendingChanges=!0,A),g(`plugin '${Ee.name}' installed`)):p(`can't install plugin: ${De} not found`)}}).catch(()=>{p("can't install plugin: unhandled exception")})};let I=!1;const P=()=>{n(10,I=!0);var T=new XMLHttpRequest;T.onreadystatechange=()=>{if(T.readyState==4&&(n(10,I=!1),T.status==200))if(T.responseText.endsWith(d)){const q=T.responseText.substring(0,T.responseText.length-De.length);D(q,T.responseText)}else p(`selection '${T.responseText}' is not named ${De}; ignored`)},T.open("GET","/json-file-picker",!0),T.send()};St();const S=(T,q,V,be)=>{let K=null;if(V){const Te=U.platform==="windows"?V.replaceAll("\\","/"):V;K=Te.endsWith(f)?Te:Te.concat("/")}var we=new XMLHttpRequest;we.onreadystatechange=()=>{we.readyState==4&&(St(),E.info(`Start-plugin status: ${we.statusText.trim()}`))},K?we.open("GET","/start-plugin?".concat(new URLSearchParams({client:T.toString(),id:q,main:be,path:K}).toString()),!0):we.open("GET","/start-plugin?".concat(new URLSearchParams({client:T.toString(),id:q,main:be}).toString()),!0),we.send()},$=(T,q)=>{var V=new XMLHttpRequest;V.onreadystatechange=()=>{V.readyState==4&&(St(),E.info(`Stop-plugin status: ${V.statusText.trim()}`))},V.open("GET","/stop-plugin?".concat(new URLSearchParams({client:T.toString(),uid:q.toString()}).toString()),!0),V.send()},H=(T,q)=>{const V=T.updaterURL;fetch(V).then(async be=>{if(!be.ok){p(`can't update plugin: updater URL returned ${be.status}: ${be.statusText}`);return}let K=await be.json();if(!K.url){g(`can't update plugin '${T.name}': no remote download URL is configured`);return}let we=!1;if(K.sha256?T.sha256!==K.sha256&&(we=!0):K.version&&T.version!==K.version&&(we=!0),we){const Te=await fetch(K.url);if(!Te.ok){p(`can't update plugin: remote download URL returned ${Te.status}: ${Te.statusText}`);return}const Ee=await Te.arrayBuffer();if(K.sha256){const ht=await crypto.subtle.digest("SHA-256",Ee),bt=Array.from(new Uint8Array(ht)).map(yn=>yn.toString(16).padStart(2,"0")).join("");if(K.sha256!==bt){p(`can't update plugin '${T.name}': incorrect file hash`);return}}fetch("/install-plugin?".concat(new URLSearchParams({id:q}).toString()),{method:"POST",body:Ee});const Ie=await b(q);Ie?(K.sha256&&(T.sha256=K.sha256),Ie.name&&(T.name=Ie.name),Ie.version&&(T.version=Ie.version),n(6,A.pluginConfigHasPendingChanges=!0,A),g(`plugin '${Ie.name}' updated`)):p(`can't update plugin '${T.name}': ${De} not found`)}else g(`plugin '${T.name}' is already up-to-date`)})};var x;const N=()=>fetch("/open-external-url",{method:"POST",body:"https://bolt.adamcake.com/plugins"});var ee=!1,Y;let W=!1,te;const z=()=>n(11,ee=!1),le=T=>{n(2,Y=T.uid),n(11,ee=!0),n(12,W=!1),n(13,te=""),n(8,c=null)};function j(){x=Ut(this),n(1,x),n(0,U)}const ne=()=>n(8,c=null),Se=()=>{n(12,W=!W),n(13,te="")};function fe(){te=this.value,n(13,te)}const Oe=()=>{O(te),n(12,W=!1),n(13,te="")},ye=()=>{n(12,W=!1),n(13,te="")},Ye=()=>{const T=U.pluginConfig[x].path;fetch(T?"/browse-directory?".concat(new URLSearchParams({path:T}).toString()):"/browse-plugin-data?".concat(new URLSearchParams({id:x}).toString()))},nt=()=>fetch("/browse-plugin-config?".concat(new URLSearchParams({id:x}).toString())),X=()=>H(l,x),Z=()=>{n(4,r=null),n(6,A.pluginConfigHasPendingChanges=!0,A);let T=U.pluginConfig;const q=T[x];q&&(fetch("/uninstall-plugin?".concat(new URLSearchParams({id:x,delete_data_dir:typeof q.path=="string"?"0":"1"}).toString())),g(`plugin '${q.name}' uninstalled`),delete T[x],n(0,U.pluginConfig=T,U))},st=T=>S(Y,x,o??null,T.main??Ts),lt=T=>{$(Y,T.uid)};function wn(T){Le[T?"unshift":"push"](()=>{a=T,n(7,a)})}const vn=()=>se.savePluginConfig(!0);return t.$$.update=()=>{t.$$.dirty[0]&36&&(i.some(T=>T.uid===Y)||n(11,ee=!1)),t.$$.dirty[0]&3&&n(3,l=U.pluginConfig[x]),t.$$.dirty[0]&2&&n(4,r=R(x)),t.$$.dirty[0]&24&&r&&r.then(T=>{let q=!1;T.name!==l.name&&(n(3,l.name=T.name,l),q=!0),T.version!==l.version&&(n(3,l.version=T.version,l),q=!0),q&&(n(3,l),n(0,U),n(1,x),n(4,r),n(6,A.pluginConfigHasPendingChanges=!0,A))}),t.$$.dirty[0]&8&&n(14,o=l?l.path:null)},[U,x,Y,l,r,i,A,a,c,u,I,ee,W,te,o,g,O,P,S,$,H,N,m,z,le,j,ne,Se,fe,Oe,ye,Ye,nt,X,Z,st,lt,wn,vn]}class Is extends he{constructor(e){super(),me(this,e,Us,Ps,_e,{open:22},null,[-1,-1])}get open(){return this.$$.ctx[22]}}function Hs(t){let e,n,l,o,r,i,a,c,u,f,d,m,g;return{c(){e=h("div"),n=h("h2"),n.textContent="Game is offline",l=L(),o=h("br"),r=L(),i=h("p"),i.textContent="This game appears to be offline for maintenance or an update. Launch anyway?",a=L(),c=h("div"),u=h("button"),u.textContent="No",f=L(),d=h("button"),d.textContent="Yes",_(n,"class","text-3xl font-extrabold"),_(u,"class","mx-1 mb-2 mt-5 w-[45%] rounded-lg bg-blue-500 p-2 font-bold text-black duration-200 hover:opacity-75"),_(d,"class","mx-1 mb-2 mt-5 w-[45%] rounded-lg bg-emerald-500 p-2 font-bold text-black duration-200 hover:opacity-75"),_(c,"class","align-bottom")},m(p,y){v(p,e,y),w(e,n),w(e,l),w(e,o),w(e,r),w(e,i),w(e,a),w(e,c),w(c,u),w(c,f),w(c,d),m||(g=[M(u,"click",t[5]),M(d,"click",t[6])],m=!0)},p:B,d(p){p&&k(e),m=!1,re(g)}}}function xs(t){let e,n,l={class:"h-fit w-3/5 px-5 py-3 text-center",$$slots:{default:[Hs]},$$scope:{ctx:t}};return e=new mt({props:l}),t[7](e),{c(){de(e.$$.fragment)},m(o,r){ie(e,o,r),n=!0},p(o,[r]){const i={};r&271&&(i.$$scope={dirty:r,ctx:o}),e.$set(i)},i(o){n||(G(e.$$.fragment,o),n=!0)},o(o){J(e.$$.fragment,o),n=!1},d(o){t[7](null),ae(e,o)}}}function Os(t,e,n){let l,o,r,i;function a(d,m,g){n(3,i=d),n(1,o=m),n(2,r=g),l.open()}const c=()=>{l.close()},u=()=>{i(o,r),l.close()};function f(d){Le[d?"unshift":"push"](()=>{l=d,n(0,l)})}return[l,o,r,i,a,c,u,f]}class Es extends he{constructor(e){super(),me(this,e,Os,xs,_e,{open:4})}get open(){return this.$$.ctx[4]}}function Qt(t,e,n){const l=t.slice();return l[20]=e[n],l}function en(t,e,n){const l=t.slice();return l[23]=e[n],l}function Ns(t){let e,n,l={};return e=new Is({props:l}),t[16](e),{c(){de(e.$$.fragment)},m(o,r){ie(e,o,r),n=!0},p(o,r){const i={};e.$set(i)},i(o){n||(G(e.$$.fragment,o),n=!0)},o(o){J(e.$$.fragment,o),n=!1},d(o){t[16](null),ae(e,o)}}}function tn(t){let e,n;return{c(){e=h("div"),n=F(t[7]),_(e,"class","absolute left-[2%] w-[96%] rounded-lg bg-blue-400 px-2 text-black")},m(l,o){v(l,e,o),w(e,n)},p(l,o){o&128&&pe(n,l[7])},d(l){l&&k(e)}}}function js(t){let e,n,l;return{c(){e=h("button"),e.textContent="Plugin menu",e.disabled=!U.hasBoltPlugins,_(e,"title",U.hasBoltPlugins?null:"This feature is disabled"),_(e,"class","w-52 rounded-lg p-2 font-bold text-black duration-200 enabled:bg-blue-500 enabled:hover:opacity-75 disabled:bg-gray-500")},m(o,r){v(o,e,r),n||(l=M(e,"click",t[19]),n=!0)},p:B,d(o){o&&k(e),n=!1,l()}}}function Ms(t){let e,n,l,o,r,i,a=ge(Ht[t[1].selected.game]),c=[];for(let u=0;u<a.length;u+=1)c[u]=nn(en(t,a,u));return{c(){e=h("label"),n=h("span"),n.textContent="Game Client",l=L(),o=h("select");for(let u=0;u<c.length;u+=1)c[u].c();_(n,"class","text-sm"),_(o,"id","game_client_select"),_(o,"class","w-52 cursor-pointer rounded-lg border-2 border-slate-300 bg-inherit p-2 text-inherit duration-200 hover:opacity-75 dark:border-slate-800"),t[1].selected.client===void 0&&ze(()=>t[18].call(o)),_(e,"class","flex flex-col")},m(u,f){v(u,e,f),w(e,n),w(e,l),w(e,o);for(let d=0;d<c.length;d+=1)c[d]&&c[d].m(o,null);xe(o,t[1].selected.client,!0),r||(i=M(o,"change",t[18]),r=!0)},p(u,f){if(f&2){a=ge(Ht[u[1].selected.game]);let d;for(d=0;d<a.length;d+=1){const m=en(u,a,d);c[d]?c[d].p(m,f):(c[d]=nn(m),c[d].c(),c[d].m(o,null))}for(;d<c.length;d+=1)c[d].d(1);c.length=a.length}f&2&&xe(o,u[1].selected.client)},d(u){u&&k(e),je(c,u),r=!1,i()}}}function nn(t){let e,n=t[23]+"",l,o;return{c(){e=h("option"),l=F(n),_(e,"class","dark:bg-slate-900"),e.__value=o=t[23],Q(e,e.__value)},m(r,i){v(r,e,i),w(e,l)},p(r,i){i&2&&n!==(n=r[23]+"")&&pe(l,n),i&2&&o!==(o=r[23])&&(e.__value=o,Q(e,e.__value))},d(r){r&&k(e)}}}function sn(t){let e;return{c(){e=h("option"),e.textContent="No characters",_(e,"class","dark:bg-slate-900"),e.disabled=!0,e.selected=!0,e.__value="No characters",Q(e,e.__value)},m(n,l){v(n,e,l)},p:B,d(n){n&&k(e)}}}function As(t){let e;return{c(){e=F("New Character")},m(n,l){v(n,e,l)},p:B,d(n){n&&k(e)}}}function Ds(t){let e=t[20].displayName+"",n;return{c(){n=F(e)},m(l,o){v(l,n,o)},p(l,o){o&32&&e!==(e=l[20].displayName+"")&&pe(n,e)},d(l){l&&k(n)}}}function ln(t){let e,n,l;function o(a,c){return a[20].displayName?Ds:As}let r=o(t),i=r(t);return{c(){e=h("option"),i.c(),n=L(),e.__value=l=t[20].accountId,Q(e,e.__value),_(e,"class","dark:bg-slate-900")},m(a,c){v(a,e,c),i.m(e,null),w(e,n)},p(a,c){r===(r=o(a))&&i?i.p(a,c):(i.d(1),i=r(a),i&&(i.c(),i.m(e,n))),c&32&&l!==(l=a[20].accountId)&&(e.__value=l,Q(e,e.__value))},d(a){a&&k(e),i.d()}}}function Bs(t){let e,n,l,o,r,i,a,c,u,f,d,m,g,p,y,b,R,C,D,O,I,P,S,$,H={};e=new Es({props:H}),t[15](e);let x=U.hasBoltPlugins&&Ns(t),N=t[7]&&tn(t);function ee(j,ne){if(j[1].selected.game==ce.osrs)return Ms;if(j[1].selected.game===ce.rs3)return js}let Y=ee(t),W=Y&&Y(t),te=ge(t[5]),z=[];for(let j=0;j<te.length;j+=1)z[j]=ln(Qt(t,te,j));let le=null;return te.length||(le=sn()),{c(){de(e.$$.fragment),n=L(),x&&x.c(),l=L(),o=h("div"),N&&N.c(),r=L(),i=h("div"),a=h("img"),u=L(),f=h("button"),d=F("Play"),g=L(),W&&W.c(),p=L(),y=h("label"),b=h("span"),b.textContent="Character",R=L(),C=h("select"),D=h("option"),O=F("Select an account");for(let j=0;j<z.length;j+=1)z[j].c();le&&le.c(),Rt(a.src,c="svgs/rocket-solid.svg")||_(a,"src",c),_(a,"alt","Launch icon"),_(a,"class","mb-3 w-24 rounded-3xl bg-gradient-to-br from-rose-500 to-violet-500 p-5"),_(f,"class","w-52 rounded-lg bg-emerald-500 p-2 font-bold text-black duration-200 enabled:hover:opacity-75 disabled:bg-gray-500"),f.disabled=m=!t[8],_(b,"class","text-sm"),D.__value=void 0,Q(D,D.__value),D.disabled=!0,_(D,"class","dark:bg-slate-900"),_(C,"id","character_select"),_(C,"class","mx-auto w-52 cursor-pointer rounded-lg border-2 border-slate-300 bg-inherit p-2 text-inherit duration-200 hover:opacity-75 dark:border-slate-800"),C.disabled=I=!t[8]||t[1].selected.user_id===null,_(y,"class","flex flex-col"),_(i,"class","flex flex-col items-center gap-4"),_(o,"class","bg-grad flex h-full flex-col border-slate-300 p-5 duration-200 dark:border-slate-800")},m(j,ne){ie(e,j,ne),v(j,n,ne),x&&x.m(j,ne),v(j,l,ne),v(j,o,ne),N&&N.m(o,null),w(o,r),w(o,i),w(i,a),w(i,u),w(i,f),w(f,d),w(i,g),W&&W.m(i,null),w(i,p),w(i,y),w(y,b),w(y,R),w(y,C),w(C,D),w(D,O);for(let Se=0;Se<z.length;Se+=1)z[Se]&&z[Se].m(C,null);le&&le.m(C,null),xe(C,t[4]),P=!0,S||($=[M(f,"click",t[17]),M(C,"change",t[13])],S=!0)},p(j,[ne]){const Se={};if(e.$set(Se),U.hasBoltPlugins&&x.p(j,ne),j[7]?N?N.p(j,ne):(N=tn(j),N.c(),N.m(o,r)):N&&(N.d(1),N=null),(!P||ne&256&&m!==(m=!j[8]))&&(f.disabled=m),Y===(Y=ee(j))&&W?W.p(j,ne):(W&&W.d(1),W=Y&&Y(j),W&&(W.c(),W.m(i,p))),ne&32){te=ge(j[5]);let fe;for(fe=0;fe<te.length;fe+=1){const Oe=Qt(j,te,fe);z[fe]?z[fe].p(Oe,ne):(z[fe]=ln(Oe),z[fe].c(),z[fe].m(C,null))}for(;fe<z.length;fe+=1)z[fe].d(1);z.length=te.length,!te.length&&le?le.p(j,ne):te.length?le&&(le.d(1),le=null):(le=sn(),le.c(),le.m(C,null))}(!P||ne&258&&I!==(I=!j[8]||j[1].selected.user_id===null))&&(C.disabled=I),(!P||ne&48)&&xe(C,j[4])},i(j){P||(G(e.$$.fragment,j),G(x),P=!0)},o(j){J(e.$$.fragment,j),J(x),P=!1},d(j){j&&(k(n),k(l),k(o)),t[15](null),ae(e,j),x&&x.d(j),N&&N.d(),W&&W.d(),je(z,j),le&&le.d(),S=!1,re($)}}}function qs(t,e,n){let l,o,r,i,a,c,u,f,d,{config:m,initialized:g}=A;ke(t,m,S=>n(1,i=S)),ke(t,g,S=>n(8,u=S));let p=He(null);ke(t,p,S=>n(7,c=S));let y=He(!0);ke(t,y,S=>n(6,a=S));function b(S,$){if(!l)return E.warn("Please log in or select a user to play.");if(!o)return E.warn("Please select a character from the select menu.");const H=se.findSession(i.selected.user_id);if(!H)return E.warn("Unable to launch game, session was not found.");const{session_id:x}=H,N=se.findAccount(H.accounts,o);if(!N)return E.warn("Unable to launch game, account was not found.");const{accountId:ee,displayName:Y}=N,W=U.platform===Lt.Windows,te=U.platform===Lt.Linux;switch(S){case ce.osrs:switch($){case We.official:jt(W||te,!0,x,ee,Y);break;case We.runelite:kn(x,ee,Y,!1);break;case We.hdos:os(x,ee,Y);break}break;case ce.rs3:te?ls(x,ee,Y):jt(W,!1,x,ee,Y);break}}function R(S){const $=S.target.value;if(!l)return;const H=i.userDetails[l];H?(H.account_id=$,Re(m,i.userDetails[l]=H,i)):Re(m,i.userDetails[l]={account_id:$},i)}function C(S){Le[S?"unshift":"push"](()=>{f=S,n(2,f)})}function D(S){Le[S?"unshift":"push"](()=>{d=S,n(3,d)})}const O=()=>{a?b(i.selected.game,i.selected.client):f.open(b,i.selected.game,i.selected.client)};function I(){i.selected.client=Ut(this),m.set(i)}const P=()=>{d.open()};return t.$$.update=()=>{var S,$;if(t.$$.dirty&2&&n(14,l=i.selected.user_id),t.$$.dirty&16386&&n(4,o=(S=i.userDetails[l??""])==null?void 0:S.account_id),t.$$.dirty&2&&n(5,r=(($=se.findSession(i.selected.user_id))==null?void 0:$.accounts)??[]),t.$$.dirty&2)if(i.check_announcements){const H=i.selected.game==ce.osrs?"osrs":U.env.provider,x=`${U.env.psa_url}${H}/${H}.json`;fetch(x,{method:"GET",cache:"no-store"}).then(N=>N.json()).then(N=>{Re(p,c=N.psaEnabled&&N.psaMessage?N.psaMessage:null,c),Re(y,a=!(N.playDisabled??!1),a)})}else Re(p,c=null,c),Re(y,a=!0,a)},[b,i,f,d,o,r,a,c,u,m,g,p,y,R,l,C,D,O,I,P]}class Gs extends he{constructor(e){super(),me(this,e,qs,Bs,_e,{launch:0})}get launch(){return this.$$.ctx[0]}}function on(t,e,n){const l=t.slice();return l[1]=e[n].date,l[2]=e[n].severity,l[3]=e[n].content,l}function rn(t){var c;let e,n=((c=t[1])==null?void 0:c.toLocaleTimeString())+"",l,o,r=t[3]+"",i,a;return{c(){e=h("li"),l=F(n),o=F(`
				- `),i=F(r),a=L(),ue(e,"text-rose-500",t[2]===Ke.error),ue(e,"text-orange-700",t[2]===Ke.warn)},m(u,f){v(u,e,f),w(e,l),w(e,o),w(e,i),w(e,a)},p(u,f){var d;f&1&&n!==(n=((d=u[1])==null?void 0:d.toLocaleTimeString())+"")&&pe(l,n),f&1&&r!==(r=u[3]+"")&&pe(i,r),f&1&&ue(e,"text-rose-500",u[2]===Ke.error),f&1&&ue(e,"text-orange-700",u[2]===Ke.warn)},d(u){u&&k(e)}}}function Fs(t){let e,n,l,o,r=ge(t[0]),i=[];for(let a=0;a<r.length;a+=1)i[a]=rn(on(t,r,a));return{c(){e=h("div"),n=h("div"),n.innerHTML='<img src="svgs/circle-info-solid.svg" alt="Message list icon" class="h-7 w-7 rounded-full bg-blue-500 p-[3px] duration-200"/>',l=L(),o=h("ol");for(let a=0;a<i.length;a+=1)i[a].c();_(n,"class","absolute right-6 top-2"),_(o,"id","message_list"),_(o,"class","h-full list-inside list-disc overflow-y-auto pl-5 pt-1 marker:text-blue-500"),_(e,"class","fixed bottom-0 h-1/4 w-screen border-t-2 border-t-slate-300 bg-slate-100 duration-200 dark:border-t-slate-800 dark:bg-slate-900")},m(a,c){v(a,e,c),w(e,n),w(e,l),w(e,o);for(let u=0;u<i.length;u+=1)i[u]&&i[u].m(o,null)},p(a,[c]){if(c&1){r=ge(a[0]);let u;for(u=0;u<r.length;u+=1){const f=on(a,r,u);i[u]?i[u].p(f,c):(i[u]=rn(f),i[u].c(),i[u].m(o,null))}for(;u<i.length;u+=1)i[u].d(1);i.length=r.length}},i:B,o:B,d(a){a&&k(e),je(i,a)}}}function Js(t,e,n){let{logs:l}=e;return t.$$set=o=>{"logs"in o&&n(0,l=o.logs)},[l]}class Ws extends he{constructor(e){super(),me(this,e,Js,Fs,_e,{logs:0})}}function an(t,e,n){const l=t.slice();return l[7]=e[n],l}function cn(t,e){let n,l=e[7].user.displayName+"",o,r;return{key:t,first:null,c(){n=h("option"),o=F(l),n.__value=r=e[7].user.userId,Q(n,n.__value),_(n,"class","dark:bg-slate-900"),this.first=n},m(i,a){v(i,n,a),w(n,o)},p(i,a){e=i,a&2&&l!==(l=e[7].user.displayName+"")&&pe(o,l),a&2&&r!==(r=e[7].user.userId)&&(n.__value=r,Q(n,n.__value))},d(i){i&&k(n)}}}function Xs(t){let e,n,l=[],o=new Map,r,i,a,c,u,f,d,m,g,p=ge(t[1]);const y=b=>b[7].user.userId;for(let b=0;b<p.length;b+=1){let R=an(t,p,b),C=y(R);o.set(C,l[b]=cn(C,R))}return{c(){e=h("select"),n=h("option"),n.textContent="Select a user";for(let b=0;b<l.length;b+=1)l[b].c();r=L(),i=h("div"),a=h("button"),a.textContent="Log In",c=L(),u=h("button"),f=F("Log Out"),n.__value=null,Q(n,n.__value),n.disabled=!0,_(n,"class","dark:bg-slate-900"),_(e,"class","w-full cursor-pointer rounded-lg border-2 border-inherit bg-inherit p-2 text-center"),t[0].selected.user_id===void 0&&ze(()=>t[4].call(e)),_(a,"class","mx-auto mr-2 rounded-lg bg-blue-500 p-2 font-bold text-black duration-200 hover:opacity-75"),_(u,"class","mx-auto rounded-lg border-2 border-blue-500 p-2 font-bold duration-200 hover:opacity-75"),u.disabled=d=!t[0].selected.user_id,_(i,"class","mt-5 flex")},m(b,R){v(b,e,R),w(e,n);for(let C=0;C<l.length;C+=1)l[C]&&l[C].m(e,null);xe(e,t[0].selected.user_id,!0),v(b,r,R),v(b,i,R),w(i,a),w(i,c),w(i,u),w(u,f),m||(g=[M(e,"change",t[4]),M(a,"click",t[5]),M(u,"click",t[6])],m=!0)},p(b,[R]){R&2&&(p=ge(b[1]),l=An(l,R,y,1,b,p,o,e,Mn,cn,null,an)),R&3&&xe(e,b[0].selected.user_id),R&3&&d!==(d=!b[0].selected.user_id)&&(u.disabled=d)},i:B,o:B,d(b){b&&(k(e),k(r),k(i));for(let R=0;R<l.length;R+=1)l[R].d();m=!1,re(g)}}}function zs(t,e,n){let l,o;const{sessions:r,config:i}=A;ke(t,r,f=>n(1,o=f)),ke(t,i,f=>n(0,l=f));function a(){l.selected.user_id=Ut(this),i.set(l)}return[l,o,r,i,a,()=>{const{origin:f,redirect:d,clientid:m}=U.env;$e.openLoginWindow(f,d,m)},async()=>{l.selected.user_id&&(await se.logout(l.selected.user_id),se.saveCredentials())}]}class Vs extends he{constructor(e){super(),me(this,e,zs,Xs,_e,{})}}function Ys(t,{callback:e,ignore:n=[]}){const l=o=>{const r=n.some(i=>i.contains(o.target));t&&!t.contains(o.target)&&!o.defaultPrevented&&!r&&e()};return document.addEventListener("click",l,!0),document.addEventListener("contextmenu",l,!0),{destroy(){document.removeEventListener("click",l,!0),document.removeEventListener("contextmenu",l,!0)}}}const Zs=t=>({}),un=t=>({});function dn(t){let e,n,l,o,r,i;const a=t[9].content,c=dt(a,t,t[8],un);return{c(){e=h("div"),c&&c.c(),_(e,"class",n="dropdown-color absolute z-20 rounded-lg border-2 "+t[1]+" "+t[2]+" svelte-xifudk")},m(u,f){v(u,e,f),c&&c.m(e,null),o=!0,r||(i=Pn(l=Ys.call(null,e,{callback:t[3],ignore:[t[5]]})),r=!0)},p(u,f){c&&c.p&&(!o||f&256)&&pt(c,a,u,u[8],o?ft(a,u[8],f,Zs):_t(u[8]),un),(!o||f&6&&n!==(n="dropdown-color absolute z-20 rounded-lg border-2 "+u[1]+" "+u[2]+" svelte-xifudk"))&&_(e,"class",n),l&&ut(l.update)&&f&32&&l.update.call(null,{callback:u[3],ignore:[u[5]]})},i(u){o||(G(c,u),o=!0)},o(u){J(c,u),o=!1},d(u){u&&k(e),c&&c.d(u),r=!1,i()}}}function Ks(t){let e,n,l,o,r,i,a;const c=t[9].default,u=dt(c,t,t[8],null);let f=t[4]&&dn(t);return{c(){e=h("div"),n=h("button"),u&&u.c(),l=L(),f&&f.c(),_(e,"class",o="relative h-fit w-fit "+t[0]+" svelte-xifudk")},m(d,m){v(d,e,m),w(e,n),u&&u.m(n,null),t[10](n),w(e,l),f&&f.m(e,null),r=!0,i||(a=M(n,"click",t[6]),i=!0)},p(d,[m]){u&&u.p&&(!r||m&256)&&pt(u,c,d,d[8],r?ft(c,d[8],m,null):_t(d[8]),null),d[4]?f?(f.p(d,m),m&16&&G(f,1)):(f=dn(d),f.c(),G(f,1),f.m(e,null)):f&&(et(),J(f,1,1,()=>{f=null}),tt()),(!r||m&1&&o!==(o="relative h-fit w-fit "+d[0]+" svelte-xifudk"))&&_(e,"class",o)},i(d){r||(G(u,d),G(f),r=!0)},o(d){J(u,d),J(f),r=!1},d(d){d&&k(e),u&&u.d(d),t[10](null),f&&f.d(),i=!1,a()}}}function Qs(t,e,n){let{$$slots:l={},$$scope:o}=e,{class:r=""}=e,{position:i="bottom"}=e,{align:a="start"}=e,c=!1,u;function f(){n(4,c=!0)}function d(){n(4,c=!1)}function m(){c?d():f()}function g(p){Le[p?"unshift":"push"](()=>{u=p,n(5,u)})}return t.$$set=p=>{"class"in p&&n(0,r=p.class),"position"in p&&n(1,i=p.position),"align"in p&&n(2,a=p.align),"$$scope"in p&&n(8,o=p.$$scope)},[r,i,a,d,c,u,m,f,o,l,g]}class el extends he{constructor(e){super(),me(this,e,Qs,Ks,_e,{class:0,position:1,align:2,open:7,close:3})}get open(){return this.$$.ctx[7]}get close(){return this.$$.ctx[3]}}function tl(t){let e,n,l,o,r,i,a,c,u,f,d,m,g;return{c(){e=h("button"),e.innerHTML=`<div class="flex"><img src="svgs/database-solid.svg" alt="Browse app data" class="mr-2 h-7 w-7 rounded-lg bg-violet-500 p-1"/>
		Browse App Data</div>`,n=L(),l=h("div"),o=h("label"),o.textContent="Check game announcements:",r=L(),i=h("input"),a=L(),c=h("div"),u=h("label"),u.textContent="Close Bolt after launching a game:",f=L(),d=h("input"),_(e,"id","data_dir_button"),_(e,"class","p-2 hover:opacity-75"),_(o,"for","check_announcements"),_(i,"id","check_announcements"),_(i,"type","checkbox"),_(i,"class","ml-2"),_(l,"class","mx-auto p-2"),_(u,"for","close_after_launch"),_(d,"id","close_after_launch"),_(d,"type","checkbox"),_(d,"class","ml-2"),_(c,"class","mx-auto p-2")},m(p,y){v(p,e,y),v(p,n,y),v(p,l,y),w(l,o),w(l,r),w(l,i),i.checked=t[0].check_announcements,v(p,a,y),v(p,c,y),w(c,u),w(c,f),w(c,d),d.checked=t[0].close_after_launch,m||(g=[M(e,"click",t[3]),M(i,"change",t[4]),M(d,"change",t[5])],m=!0)},p(p,[y]){y&1&&(i.checked=p[0].check_announcements),y&1&&(d.checked=p[0].close_after_launch)},i:B,o:B,d(p){p&&(k(e),k(n),k(l),k(a),k(c)),m=!1,re(g)}}}function nl(t,e,n){let l;function o(){var u=new XMLHttpRequest;u.open("GET","/browse-data"),u.onreadystatechange=()=>{u.readyState==4&&E.info(`Browse status: '${u.responseText.trim()}'`)},u.send()}const{config:r}=A;ke(t,r,u=>n(0,l=u));const i=()=>{o()};function a(){l.check_announcements=this.checked,r.set(l)}function c(){l.close_after_launch=this.checked,r.set(l)}return[l,o,r,i,a,c]}class sl extends he{constructor(e){super(),me(this,e,nl,tl,_e,{})}}function ll(t){let e,n,l,o,r,i,a,c,u,f,d,m,g,p,y,b,R,C,D,O,I,P,S,$,H,x,N,ee,Y,W,te,z,le,j,ne,Se,fe,Oe,ye,Ye,nt;return{c(){var X,Z;e=h("button"),n=h("div"),n.innerHTML=`<img src="svgs/wrench-solid.svg" alt="Configure RuneLite" class="mr-2 h-7 w-7 rounded-lg bg-pink-500 p-1"/>
		Configure RuneLite`,o=L(),r=h("div"),i=h("label"),i.textContent="Use custom RuneLite JAR:",a=L(),c=h("input"),u=L(),f=h("div"),d=h("textarea"),g=L(),p=h("br"),y=L(),b=h("button"),R=F("Select File"),D=L(),O=h("div"),I=h("label"),I.textContent="OSRS launch command:",P=L(),S=h("br"),$=L(),H=h("textarea"),x=L(),N=h("div"),ee=h("label"),ee.textContent="RuneLite launch command:",Y=L(),W=h("br"),te=L(),z=h("textarea"),le=L(),j=h("div"),ne=h("label"),ne.textContent="HDOS launch command:",Se=L(),fe=h("br"),Oe=L(),ye=h("textarea"),_(n,"class","flex"),e.disabled=l=!((X=t[0])!=null&&X.session_id)||!((Z=t[3])!=null&&Z.accountId),_(e,"class","p-2 pb-5 hover:opacity-75"),_(i,"for","use_custom_jar"),_(c,"id","use_custom_jar"),_(c,"type","checkbox"),_(c,"class","ml-2"),_(r,"class","mx-auto border-t-2 border-slate-300 p-2 pt-5 dark:border-slate-800"),_(d,"class","h-10 rounded border-2 border-slate-300 bg-slate-100 text-slate-950 dark:border-slate-800 dark:bg-slate-900 dark:text-slate-50"),d.disabled=m=!t[1].runelite_use_custom_jar,_(b,"class","mt-1 rounded-lg border-2 border-blue-500 p-1 duration-200 enabled:hover:opacity-75"),b.disabled=C=t[2]||!t[1].runelite_use_custom_jar,_(f,"class","mx-auto p-2"),ue(f,"opacity-25",!t[1].runelite_use_custom_jar),_(I,"for","osrs_custom_launch_command"),_(H,"id","osrs_custom_launch_command"),_(H,"class","resize-x rounded border-2 border-slate-300 bg-slate-100 text-slate-950 disabled:opacity-50 dark:border-slate-800 dark:bg-slate-900 dark:text-slate-50"),_(H,"rows","1"),_(H,"cols","35"),_(H,"placeholder","%command%"),_(O,"class","p-2"),_(ee,"for","runelite_custom_launch_command"),_(z,"id","runelite_custom_launch_command"),_(z,"class","resize-x rounded border-2 border-slate-300 bg-slate-100 text-slate-950 disabled:opacity-50 dark:border-slate-800 dark:bg-slate-900 dark:text-slate-50"),_(z,"rows","1"),_(z,"cols","35"),_(z,"placeholder","%command%"),_(N,"class","p-2"),_(ne,"for","hdos_custom_launch_command"),_(ye,"id","hdos_custom_launch_command"),_(ye,"class","resize-x rounded border-2 border-slate-300 bg-slate-100 text-slate-950 disabled:opacity-50 dark:border-slate-800 dark:bg-slate-900 dark:text-slate-50"),_(ye,"rows","1"),_(ye,"cols","35"),_(ye,"placeholder","%command%"),_(j,"class","p-2")},m(X,Z){v(X,e,Z),w(e,n),v(X,o,Z),v(X,r,Z),w(r,i),w(r,a),w(r,c),c.checked=t[1].runelite_use_custom_jar,v(X,u,Z),v(X,f,Z),w(f,d),Q(d,t[1].runelite_custom_jar),w(f,g),w(f,p),w(f,y),w(f,b),w(b,R),v(X,D,Z),v(X,O,Z),w(O,I),w(O,P),w(O,S),w(O,$),w(O,H),Q(H,t[1].osrs_launch_command),v(X,x,Z),v(X,N,Z),w(N,ee),w(N,Y),w(N,W),w(N,te),w(N,z),Q(z,t[1].runelite_launch_command),v(X,le,Z),v(X,j,Z),w(j,ne),w(j,Se),w(j,fe),w(j,Oe),w(j,ye),Q(ye,t[1].hdos_launch_command),Ye||(nt=[M(e,"click",t[7]),M(c,"change",t[8]),M(d,"input",t[9]),M(b,"click",t[10]),M(H,"input",t[11]),M(z,"input",t[12]),M(ye,"input",t[13])],Ye=!0)},p(X,[Z]){var st,lt;Z&9&&l!==(l=!((st=X[0])!=null&&st.session_id)||!((lt=X[3])!=null&&lt.accountId))&&(e.disabled=l),Z&2&&(c.checked=X[1].runelite_use_custom_jar),Z&2&&m!==(m=!X[1].runelite_use_custom_jar)&&(d.disabled=m),Z&2&&Q(d,X[1].runelite_custom_jar),Z&6&&C!==(C=X[2]||!X[1].runelite_use_custom_jar)&&(b.disabled=C),Z&2&&ue(f,"opacity-25",!X[1].runelite_use_custom_jar),Z&2&&Q(H,X[1].osrs_launch_command),Z&2&&Q(z,X[1].runelite_launch_command),Z&2&&Q(ye,X[1].hdos_launch_command)},i:B,o:B,d(X){X&&(k(e),k(o),k(r),k(u),k(f),k(D),k(O),k(x),k(N),k(le),k(j)),Ye=!1,re(nt)}}}function ol(t,e,n){let l,o,r;const{config:i}=A;ke(t,i,R=>n(1,r=R));let a=!1;async function c(){n(2,a=!0),Re(i,r.runelite_custom_jar=await se.openFilePicker(),r),console.log("done picking"),n(2,a=!1)}function u(){!(l!=null&&l.session_id)||!(o!=null&&o.accountId)||!(o!=null&&o.displayName)||kn(l.session_id,o.accountId,o.displayName,!0)}const f=()=>u();function d(){r.runelite_use_custom_jar=this.checked,i.set(r)}function m(){r.runelite_custom_jar=this.value,i.set(r)}const g=()=>{c()};function p(){r.osrs_launch_command=this.value,i.set(r)}function y(){r.runelite_launch_command=this.value,i.set(r)}function b(){r.hdos_launch_command=this.value,i.set(r)}return t.$$.update=()=>{var R;t.$$.dirty&2&&n(0,l=se.findSession(r.selected.user_id)),t.$$.dirty&3&&n(3,o=se.findAccount((l==null?void 0:l.accounts)??[],(R=r.userDetails[r.selected.user_id??""])==null?void 0:R.account_id))},[l,r,a,o,i,c,u,f,d,m,g,p,y,b]}class rl extends he{constructor(e){super(),me(this,e,ol,ll,_e,{})}}function il(t){let e,n,l,o,r,i;return{c(){e=h("div"),n=h("label"),n.textContent="Enable Bolt plugin loader:",l=L(),o=h("input"),_(n,"for","enable_plugins"),_(o,"type","checkbox"),_(o,"name","enable_plugins"),_(o,"id","enable_plugins"),_(o,"class","ml-2"),_(e,"class","mx-auto p-2")},m(a,c){v(a,e,c),w(e,n),w(e,l),w(e,o),o.checked=t[0].rs_plugin_loader,r||(i=M(o,"change",t[2]),r=!0)},p(a,c){c&1&&(o.checked=a[0].rs_plugin_loader)},d(a){a&&k(e),r=!1,i()}}}function al(t){let e,n,l,o,r,i,a,c,u,f,d,m,g,p,y,b,R,C,D=U.hasBoltPlugins&&il(t);return{c(){D&&D.c(),e=L(),n=h("div"),l=h("label"),l.textContent="Use custom config URI:",o=L(),r=h("input"),i=L(),a=h("div"),c=h("textarea"),f=L(),d=h("div"),m=h("label"),m.textContent="Launch command:",g=L(),p=h("br"),y=L(),b=h("textarea"),_(l,"for","use_custom_uri"),_(r,"id","use_custom_uri"),_(r,"type","checkbox"),_(r,"class","ml-2"),_(n,"class","mx-auto p-2"),_(c,"class","rounded border-2 border-slate-300 bg-slate-100 text-slate-950 disabled:opacity-50 dark:border-slate-800 dark:bg-slate-900 dark:text-slate-50"),c.disabled=u=!t[0].use_custom_rs_config_uri,_(c,"rows","4"),_(c,"placeholder",U.env.default_config_uri),_(a,"class","p-2"),_(m,"for","rs_custom_launch_command"),_(b,"id","rs_custom_launch_command"),_(b,"class","resize-x rounded border-2 border-slate-300 bg-slate-100 text-slate-950 disabled:opacity-50 dark:border-slate-800 dark:bg-slate-900 dark:text-slate-50"),_(b,"rows","1"),_(b,"cols","35"),_(b,"placeholder","%command%"),_(d,"class","p-2")},m(O,I){D&&D.m(O,I),v(O,e,I),v(O,n,I),w(n,l),w(n,o),w(n,r),r.checked=t[0].use_custom_rs_config_uri,v(O,i,I),v(O,a,I),w(a,c),Q(c,t[0].rs_config_uri),v(O,f,I),v(O,d,I),w(d,m),w(d,g),w(d,p),w(d,y),w(d,b),Q(b,t[0].rs_launch_command),R||(C=[M(r,"change",t[3]),M(c,"input",t[4]),M(b,"input",t[5])],R=!0)},p(O,[I]){U.hasBoltPlugins&&D.p(O,I),I&1&&(r.checked=O[0].use_custom_rs_config_uri),I&1&&u!==(u=!O[0].use_custom_rs_config_uri)&&(c.disabled=u),I&1&&Q(c,O[0].rs_config_uri),I&1&&Q(b,O[0].rs_launch_command)},i:B,o:B,d(O){O&&(k(e),k(n),k(i),k(a),k(f),k(d)),D&&D.d(O),R=!1,re(C)}}}function cl(t,e,n){let l;const{config:o}=A;ke(t,o,u=>n(0,l=u));function r(){l.rs_plugin_loader=this.checked,o.set(l)}function i(){l.use_custom_rs_config_uri=this.checked,o.set(l)}function a(){l.rs_config_uri=this.value,o.set(l)}function c(){l.rs_launch_command=this.value,o.set(l)}return[l,o,r,i,a,c]}class ul extends he{constructor(e){super(),me(this,e,cl,al,_e,{})}}function dl(t){let e,n;return e=new ul({}),{c(){de(e.$$.fragment)},m(l,o){ie(e,l,o),n=!0},i(l){n||(G(e.$$.fragment,l),n=!0)},o(l){J(e.$$.fragment,l),n=!1},d(l){ae(e,l)}}}function fl(t){let e,n;return e=new rl({}),{c(){de(e.$$.fragment)},m(l,o){ie(e,l,o),n=!0},i(l){n||(G(e.$$.fragment,l),n=!0)},o(l){J(e.$$.fragment,l),n=!1},d(l){ae(e,l)}}}function pl(t){let e,n;return e=new sl({}),{c(){de(e.$$.fragment)},m(l,o){ie(e,l,o),n=!0},i(l){n||(G(e.$$.fragment,l),n=!0)},o(l){J(e.$$.fragment,l),n=!1},d(l){ae(e,l)}}}function _l(t){let e,n,l,o,r,i,a,c,u,f,d,m,g,p,y,b,R,C,D,O;const I=[pl,fl,dl],P=[];function S($,H){return $[1]==$[2].general?0:$[1]==$[2].osrs?1:$[1]==$[2].rs3?2:-1}return~(b=S(t))&&(R=P[b]=I[b](t)),{c(){e=h("div"),n=h("div"),l=h("button"),o=F("General"),i=L(),a=h("button"),c=F("OSRS"),f=L(),d=h("button"),m=F("RS3"),p=L(),y=h("div"),R&&R.c(),_(l,"class",r=t[1]===t[2].general?Be:qe),_(a,"class",u=t[1]===t[2].osrs?Be:qe),_(d,"class",g=t[1]===t[2].rs3?Be:qe),_(n,"class","flex flex-col items-center gap-2 border-r-2 border-slate-300 pt-10 dark:border-slate-800"),_(y,"class","col-span-3 p-5 pt-10 text-center"),_(e,"class","grid h-full grid-cols-4")},m($,H){v($,e,H),w(e,n),w(n,l),w(l,o),w(n,i),w(n,a),w(a,c),w(n,f),w(n,d),w(d,m),w(e,p),w(e,y),~b&&P[b].m(y,null),C=!0,D||(O=[M(l,"click",t[4]),M(a,"click",t[5]),M(d,"click",t[6])],D=!0)},p($,H){(!C||H&2&&r!==(r=$[1]===$[2].general?Be:qe))&&_(l,"class",r),(!C||H&2&&u!==(u=$[1]===$[2].osrs?Be:qe))&&_(a,"class",u),(!C||H&2&&g!==(g=$[1]===$[2].rs3?Be:qe))&&_(d,"class",g);let x=b;b=S($),b!==x&&(R&&(et(),J(P[x],1,1,()=>{P[x]=null}),tt()),~b?(R=P[b],R||(R=P[b]=I[b]($),R.c()),G(R,1),R.m(y,null)):R=null)},i($){C||(G(R),C=!0)},o($){J(R),C=!1},d($){$&&k(e),~b&&P[b].d(),D=!1,re(O)}}}function gl(t){let e,n,l={class:"h-3/4 w-3/4 select-none",$$slots:{default:[_l]},$$scope:{ctx:t}};return e=new mt({props:l}),t[7](e),{c(){de(e.$$.fragment)},m(o,r){ie(e,o,r),n=!0},p(o,[r]){const i={};r&258&&(i.$$scope={dirty:r,ctx:o}),e.$set(i)},i(o){n||(G(e.$$.fragment,o),n=!0)},o(o){J(e.$$.fragment,o),n=!1},d(o){t[7](null),ae(e,o)}}}let Be="border-2 border-blue-500 bg-blue-500 hover:opacity-75 font-bold text-black duration-200 rounded-lg p-1 w-3/4",qe="border-2 border-blue-500 hover:opacity-75 duration-200 rounded-lg p-1 w-3/4";function ml(t,e,n){let l;function o(){l.open()}var r=(d=>(d[d.general=0]="general",d[d.osrs=1]="osrs",d[d.rs3=2]="rs3",d))(r||{});let i=0;const a=()=>{n(1,i=r.general)},c=()=>{n(1,i=r.osrs)},u=()=>{n(1,i=r.rs3)};function f(d){Le[d?"unshift":"push"](()=>{l=d,n(0,l)})}return[l,i,r,o,a,c,u,f]}class hl extends he{constructor(e){super(),me(this,e,ml,gl,_e,{open:3})}get open(){return this.$$.ctx[3]}}function bl(t){const e=t.slice(),n=se.findSession(e[1].selected.user_id??"");return e[11]=n,e}function kl(t){let e,n,l;return{c(){e=h("button"),e.textContent="Login",_(e,"class","h-11 w-48 rounded-lg border-2 border-slate-300 bg-inherit p-2 text-center font-bold text-black duration-200 hover:opacity-75 dark:border-slate-800 dark:text-slate-50")},m(o,r){v(o,e,r),n||(l=M(e,"click",t[10]),n=!0)},p:B,i:B,o:B,d(o){o&&k(e),n=!1,l()}}}function wl(t){let e,n;return e=new el({props:{align:"center",$$slots:{content:[yl],default:[vl]},$$scope:{ctx:t}}}),{c(){de(e.$$.fragment)},m(l,o){ie(e,l,o),n=!0},p(l,o){const r={};o&4098&&(r.$$scope={dirty:o,ctx:l}),e.$set(r)},i(l){n||(G(e.$$.fragment,l),n=!0)},o(l){J(e.$$.fragment,l),n=!1},d(l){ae(e,l)}}}function vl(t){var o;let e,n=(((o=t[11])==null?void 0:o.user.displayName)??"No user selected")+"",l;return{c(){e=h("button"),l=F(n),_(e,"class","h-11 w-48 rounded-lg border-2 border-slate-300 bg-inherit text-center font-bold text-black duration-200 hover:opacity-75 dark:border-slate-800 dark:text-slate-50")},m(r,i){v(r,e,i),w(e,l)},p(r,i){var a;i&2&&n!==(n=(((a=r[11])==null?void 0:a.user.displayName)??"No user selected")+"")&&pe(l,n)},d(r){r&&k(e)}}}function yl(t){let e,n,l;return n=new Vs({}),{c(){e=h("div"),de(n.$$.fragment),_(e,"slot","content"),_(e,"class","w-40")},m(o,r){v(o,e,r),ie(n,e,null),l=!0},p:B,i(o){l||(G(n.$$.fragment,o),l=!0)},o(o){J(n.$$.fragment,o),l=!1},d(o){o&&k(e),ae(n)}}}function $l(t){let e,n,l,o,r,i,a,c,u,f,d,m,g,p,y,b,R,C,D={};e=new hl({props:D}),t[5](e);const O=[wl,kl],I=[];function P($,H){return $[2].length>0?0:1}function S($,H){return H===0?bl($):$}return p=P(t),y=I[p]=O[p](S(t,p)),{c(){de(e.$$.fragment),n=L(),l=h("div"),o=h("div"),r=h("button"),r.textContent="RS3",i=L(),a=h("button"),a.textContent="OSRS",c=L(),u=h("div"),f=h("button"),f.innerHTML='<img src="svgs/lightbulb-solid.svg" class="m-auto h-6 w-6" alt="Change Theme"/>',d=L(),m=h("button"),m.innerHTML='<img src="svgs/gear-solid.svg" class="m-auto h-6 w-6" alt="Settings"/>',g=L(),y.c(),_(r,"class","mx-1 w-20 rounded-lg border-2 border-blue-500 p-2 duration-200 hover:opacity-75"),ue(r,"text-black",t[1].selected.game===ce.rs3),ue(r,"bg-blue-500",t[1].selected.game===ce.rs3),_(a,"class","mx-1 w-20 rounded-lg border-2 border-blue-500 bg-blue-500 p-2 text-black duration-200 hover:opacity-75"),ue(a,"text-black",t[1].selected.game===ce.osrs),ue(a,"bg-blue-500",t[1].selected.game===ce.osrs),_(o,"class","m-3 ml-9 font-bold"),_(f,"class","h-10 w-10 rounded-full bg-blue-500 text-center duration-200 hover:rotate-45 hover:opacity-75"),_(m,"class","h-10 w-10 rounded-full bg-blue-500 text-center duration-200 hover:rotate-45 hover:opacity-75"),_(u,"class","m-2 ml-auto flex gap-2"),_(l,"class","fixed top-0 flex h-16 w-screen border-b-2 border-slate-300 bg-slate-100 duration-200 dark:border-slate-800 dark:bg-slate-900")},m($,H){ie(e,$,H),v($,n,H),v($,l,H),w(l,o),w(o,r),w(o,i),w(o,a),w(l,c),w(l,u),w(u,f),w(u,d),w(u,m),w(u,g),I[p].m(u,null),b=!0,R||(C=[M(r,"click",t[6]),M(a,"click",t[7]),M(f,"click",t[8]),M(m,"click",t[9])],R=!0)},p($,[H]){const x={};e.$set(x),(!b||H&2)&&ue(r,"text-black",$[1].selected.game===ce.rs3),(!b||H&2)&&ue(r,"bg-blue-500",$[1].selected.game===ce.rs3),(!b||H&2)&&ue(a,"text-black",$[1].selected.game===ce.osrs),(!b||H&2)&&ue(a,"bg-blue-500",$[1].selected.game===ce.osrs);let N=p;p=P($),p===N?I[p].p(S($,p),H):(et(),J(I[N],1,1,()=>{I[N]=null}),tt(),y=I[p],y?y.p(S($,p),H):(y=I[p]=O[p](S($,p)),y.c()),G(y,1),y.m(u,null))},i($){b||(G(e.$$.fragment,$),G(y),b=!0)},o($){J(e.$$.fragment,$),J(y),b=!1},d($){$&&(k(n),k(l)),t[5](null),ae(e,$),I[p].d(),R=!1,re(C)}}}function Sl(t,e,n){let l,o;const{config:r,sessions:i}=A;ke(t,r,p=>n(1,l=p)),ke(t,i,p=>n(2,o=p));let a;function c(p){Le[p?"unshift":"push"](()=>{a=p,n(0,a)})}return[a,l,o,r,i,c,()=>{Re(r,l.selected.game=ce.rs3,l)},()=>{Re(r,l.selected.game=ce.osrs,l)},()=>Re(r,l.use_dark_theme=!l.use_dark_theme,l),()=>a.open(),()=>{const{origin:p,redirect:y,clientid:b}=U.env;$e.openLoginWindow(p,y,b)}]}class Cl extends he{constructor(e){super(),me(this,e,Sl,$l,_e,{})}}function Ll(t){let e,n,l,o,r,i,a,c,u,f,d,m,g;return e=new ss({}),l=new Cl({}),c=new Gs({}),m=new Ws({props:{logs:t[0]}}),{c(){de(e.$$.fragment),n=L(),de(l.$$.fragment),o=L(),r=h("div"),i=h("div"),a=L(),de(c.$$.fragment),u=L(),f=h("div"),d=L(),de(m.$$.fragment),_(r,"class","mt-16 grid h-full grid-flow-col grid-cols-3")},m(p,y){ie(e,p,y),v(p,n,y),ie(l,p,y),v(p,o,y),v(p,r,y),w(r,i),w(r,a),ie(c,r,null),w(r,u),w(r,f),v(p,d,y),ie(m,p,y),g=!0},p(p,y){const b={};y&1&&(b.logs=p[0]),m.$set(b)},i(p){g||(G(e.$$.fragment,p),G(l.$$.fragment,p),G(c.$$.fragment,p),G(m.$$.fragment,p),g=!0)},o(p){J(e.$$.fragment,p),J(l.$$.fragment,p),J(c.$$.fragment,p),J(m.$$.fragment,p),g=!1},d(p){p&&(k(n),k(o),k(r),k(d)),ae(e,p),ae(l,p),ae(c),ae(m,p)}}}function Rl(t){let e,n,l,o;return e=new bn({props:{$$slots:{default:[Ll]},$$scope:{ctx:t}}}),{c(){de(e.$$.fragment)},m(r,i){ie(e,r,i),n=!0,l||(o=M(window,"beforeunload",t[2]),l=!0)},p(r,[i]){const a={};i&9&&(a.$$scope={dirty:i,ctx:r}),e.$set(a)},i(r){n||(G(e.$$.fragment,r),n=!0)},o(r){J(e.$$.fragment,r),n=!1},d(r){ae(e,r),l=!1,o()}}}function Pl(t,e,n){let l;const o=E.logs;return ke(t,o,i=>n(0,l=i)),[l,o,()=>{se.saveConfig(),U.hasBoltPlugins&&se.savePluginConfig(!0)}]}class Tl extends he{constructor(e){super(),me(this,e,Pl,Rl,_e,{})}}const fn={target:document.getElementById("app")};window.opener||window.location.search.includes("&id_token")?new Zn(fn):(Ul(),Jn(),Il(),Hl().finally(()=>{A.initialized.set(!0)}),new Tl(fn));function Ul(){const t=new URLSearchParams(window.location.search);U.platform=t.get("platform"),U.isFlathub=t.get("flathub")==="1",U.hasLibArchive=t.get("has_libarchive")==="1",U.rs3DebInstalledHash=t.get("rs3_deb_installed_hash"),U.rs3ExeInstalledHash=t.get("rs3_exe_installed_hash"),U.rs3AppInstalledHash=t.get("rs3_app_installed_hash"),U.osrsExeInstalledHash=t.get("osrs_exe_installed_hash"),U.osrsAppInstalledHash=t.get("osrs_app_installed_hash"),U.runeLiteInstalledId=t.get("runelite_installed_id"),U.hdosInstalledVersion=t.get("hdos_installed_version");const e=t.get("plugins");if(U.hasBoltPlugins=e!==null,e!==null)try{U.pluginConfig=JSON.parse(e)}catch{E.error("Unable to parse plugin list")}const n=t.get("credentials");if(n)try{const l=JSON.parse(n),o=l.every(r=>typeof r.session_id=="string"&&typeof r.tokens=="object"&&typeof r.accounts=="object"&&typeof r.user=="object");o?A.sessions.set(l):(A.sessions.set([]),se.saveCredentials(),E.warn("Credentials saved on disk are out of date. Please sign in again.")),A.sessions.set(o?l:[])}catch{A.sessions.set([]),se.saveCredentials(),E.error("Unable to parse saved credentials. Please sign in again.")}}function Il(){const{origin:t,origin_2fa:e}=U.env,n=[window.location.origin,t,e];let l=null;window.addEventListener("message",async o=>{var r;if(!n.includes(o.origin)){E.info(`discarding window message from origin ${o.origin}`);return}switch(o.data.type){case"authTokenUpdate":{l=o.data.tokens;break}case"authSessionUpdate":{if(l===null)return E.error("auth is null. Please try again.");const i=o.data.sessionId,a=await se.login(l,i);a.ok?E.info(`Added new user '${a.value.user.displayName}'`):E.error(`Unable to add new user. Please try again. ${a.error}`),se.saveCredentials(),$e.pendingLoginWindow=null,l=null;break}case"authFailed":{E.error(`Unable to authenticate: ${o.data.reason}`),$e.pendingLoginWindow=null,l=null;break}case"externalUrl":{const i=new XMLHttpRequest;i.onreadystatechange=()=>{i.readyState==4&&E.info(`External URL status: '${i.responseText.trim()}'`)},i.open("POST","/open-external-url",!0),i.send(o.data.url);break}case"gameClientList":ve(A.config).close_after_launch&&o.data.clients.length>ve(Tt).length?fetch("/close"):Tt.set(o.data.clients);break;default:{const i=((r=o.data)==null?void 0:r.type)??"no type provided";E.info(`Unknown message type: ${i}`);break}}})}async function Hl(){const t=ve(A.sessions),e=[];t.length>0&&E.info("Logging in...");const n=t.map(r=>({promise:$e.refreshOAuthToken(r.tokens),session:r})),l=[];for(const r of n){const i=r.session,a=await r.promise;if(!a.ok){a.error===0?E.error(`Unable to verify saved login, status: ${a.error}. Do you have an internet connection? Please relaunch Bolt to try again.`):(E.error(`Discarding expired login, status: ${a.error}. Please sign in again.`),e.push(i.tokens.sub));continue}const c=a.value;i.tokens=c,l.push({promise:se.login(c,i.session_id),session:i})}for(const r of l){const i=r.session,a=await r.promise;a.ok?E.info(`Signed into saved user '${a.value.user.displayName}'`):(E.error(`Unable to sign into saved user '${i.user.displayName}' - please sign in again. ${a.error}`),e.push(i.tokens.sub))}const o=e.map(se.logout);for(const r of o)await r;A.sessions.set(t),await se.saveCredentials()}
